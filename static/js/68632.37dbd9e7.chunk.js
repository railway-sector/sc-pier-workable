"use strict";(self.webpackChunksc_pier_workable=self.webpackChunksc_pier_workable||[]).push([[68632],{3663:(e,t,i)=>{i.d(t,{O:()=>n});var s=i(18690),r=i(19276),a=i(85632);function n(e){if(!e)return[];let t=(0,a.DU)(e)?[e]:r.A.isCollection(e)?e.toArray():Array.isArray(e)?e:[];return t=t?.filter(s.Ru),0===(t?.length??0)?[]:t}},4722:(e,t,i)=>{i.d(t,{r:()=>m});var s=i(6326),r=i(69539),a=i(91967),n=i(18690),h=i(54901),l=i(68134),o=i(46053),d=(i(81806),i(76460),i(87990)),p=i(56611),u=i(64519),g=i(86875),c=i(7246),w=i(76940),y=i(3663);let m=class extends a.A{get updating(){return this.graphicsView?.updating??!1}constructor(e){super(e),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new u.Y,this.graphicsView=null,this.suspended=!1;const t=new r.A([255,255,255,1/255]);this._symbols=new Map([["point",new w.A({size:"2px",style:"square",color:t})],["polyline",new c.A({width:"2px",color:t})],["polygon",new g.A({outline:null,color:t})]])}highlight(e,t){const i=(0,y.O)(e);if(0===i.length)return(0,h.hA)();let s,r=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then(e=>{let[i,a]=e;!r&&a&&(s=this._addHighlightGraphics(a,i,t))})),(0,h.hA)(()=>{r=!0,s?.remove()})}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(e,t,i){for(const r of t)this._highlightCounts.set(r,(this._highlightCounts.get(r)??0)+1);this.graphics.addMany(t);const s=e.highlight(t,i);return(0,h.hA)(()=>{this._removeHighlightGraphics(t),s.remove()})}_removeHighlightGraphics(e){this.graphics.removeMany(e.filter(e=>{const t=Math.max(0,(this._highlightCounts.get(e)??0)-1);return 0===t?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,t),!1)}))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=Promise.all([i.e(73263),i.e(53046),i.e(14207)]).then(i.bind(i,14207)));const{default:e}=await this._graphicsViewLoader;if(this.destroyed)return null;const t=new e({view:this.view,layer:{type:"graphics-view-3d-dummy",id:this.layer.id,uid:this.layer.uid,elevationInfo:{mode:"on-the-ground"}},getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",t),this.addHandles([(0,h.DQ)(this.graphicsView),(0,l.wB)(()=>this.suspended,e=>{t.suspended=e},l.pc)]),t}async _createHighlightGraphics(e){const t=e.map(e=>{let{geometry:t}=e;return t?.spatialReference}).filter(n.Ru).reduce((e,t)=>(0!==e.length&&e.at(-1)?.equals(t)||e.push(t),e),[]),i=this.view.spatialReference,s=t.map(e=>({source:e,dest:i}));try{await(0,p.initializeProjection)(s)}catch{return[]}return e.map(e=>{const{geometry:t}=e;try{const s=t?(0,p.project)(t,i):null,r=e.cloneShallow();return r.geometry=s,r.symbol=this._symbols.get(s?.type),r}catch{return e}})}};(0,s.Cg)([(0,o.MZ)()],m.prototype,"graphics",void 0),(0,s.Cg)([(0,o.MZ)()],m.prototype,"graphicsView",void 0),(0,s.Cg)([(0,o.MZ)()],m.prototype,"view",void 0),(0,s.Cg)([(0,o.MZ)()],m.prototype,"layer",void 0),(0,s.Cg)([(0,o.MZ)()],m.prototype,"updatingHandles",void 0),(0,s.Cg)([(0,o.MZ)()],m.prototype,"suspended",void 0),(0,s.Cg)([(0,o.MZ)()],m.prototype,"updating",null),m=(0,s.Cg)([(0,d.$)("esri.views.3d.layers.support.ImageHighlightHelper3D")],m)},17214:(e,t,i)=>{i.d(t,{A:()=>w});var s=i(6326),r=i(50076),a=i(50346),n=i(46053),h=(i(81806),i(76460),i(47249),i(87990)),l=i(19247),o=i(1900),d=i(51939),p=i(31516),u=i(59844),g=i(97015),c=i(2257);const w=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.view=null}get timeExtent(){return(0,p.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,t){const{layer:i}=this;if(!e)throw new r.A("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:s}=i,n=(0,c.D8)(i,t);if(!s||null==n)return[];const h=await n.getRequiredFields(null,{index:new o.A(i.rasterFields),partitions:new Map([["$pixel",i.rasterFields.filter(e=>e.name.startsWith(d.ER)).map(e=>e.name)],["$imageCollectionItem",i.fields.map(e=>e.name)]])});(0,a.Te)(t);const p=new g.A;p.timeExtent=this.timeExtent,p.geometry=e,p.outFields=h,p.outSpatialReference=e.spatialReference;const{resolution:u,spatialReference:w}=this.view,y="2d"===this.view.type?new l.A(u,u,w):new l.A(.5*u,.5*u,w),{returnTopmostRaster:m,showNoDataRecords:v}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},f={returnDomainValues:!0,returnTopmostRaster:m,pixelSize:y,showNoDataRecords:v,signal:t?.signal};return i.queryVisibleRasters(p,f)}async getSourceScale(){return await(0,u.Hh)(),await this.layer.load(),(0,u.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,s.Cg)([(0,n.MZ)()],i.prototype,"layer",void 0),(0,s.Cg)([(0,n.MZ)()],i.prototype,"suspended",void 0),(0,s.Cg)([(0,n.MZ)({readOnly:!0})],i.prototype,"timeExtent",null),(0,s.Cg)([(0,n.MZ)()],i.prototype,"view",void 0),i=(0,s.Cg)([(0,h.$)("esri.views.layers.ImageryLayerView")],i),i}},68632:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var s=i(6326),r=i(54901),a=i(68134),n=i(46053),h=(i(81806),i(76460),i(47249),i(87990)),l=i(98774),o=i(50346),d=(i(50076),i(44882));let p=class extends d.A{constructor(e){super(e),this.redrawDebounced=(0,o.sg)(async e=>{this.redraw((e,t)=>this._redrawImage(e,t),e)},2e3)}initialize(){this.addHandles([(0,a.z7)(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this.updatingHandles.addPromise(this.redrawDebounced()))])}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}async processResult(e,t,i){t.imageOrCanvasElement?e.image=t.imageOrCanvasElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,i))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||null==e.pixelData)throw new Error;const i=e.image,s=i.getContext("2d"),r=await this.layer.applyRenderer(e.pixelData,{signal:t}),a=this.layer.applyFilter(r).pixelBlock;if(null==a)throw new Error;i.width=a.width,i.height=a.height;const n=s.createImageData(a.width,a.height);n.data.set(a.getAsRGBA()),s.putImageData(n,0,0)}};p=(0,s.Cg)([(0,h.$)("esri.views.3d.layers.ImagerySubView3D")],p);var u=i(4722),g=i(46533),c=i(89214);let w=class extends c.A{constructor(e){super(e)}initialize(){this.updatingHandles.add(()=>this.renderedTiles,()=>this.triggerLoad()),this.updatingHandles.add(()=>this.elevationInfo.mode,e=>this._updatePopupDrapeSource(e),{initial:!0})}_updatePopupDrapeSource(e){if("on-the-ground"===e)return void this.removeHandles(y);if(this.hasHandles(y))return;const t={destroyed:!1,drapeSourceType:2,updatePolicy:0,layer:this.layer},i=this.layerView.view.overlayManager;i.registerGeometryDrapeSource(t),this.addHandles((0,r.hA)(()=>i.unregisterDrapeSource(t)),y)}async fetchDataAndGenerateStreamlines(e,t){const{needsMagnitude:i,workerHandle:s}=this,r=this.getSimulationSettings(e),{size:a,extent:n,timeExtent:h}=e;if(null==r||null==s)return;const l=await(0,g.pH)(this.layer,n,a[0],a[1],h,t);if(null==l)return null;const o={simulationSettings:r,flowExtentInfo:e.flowExtentInfo,flowData:l,needsMagnitude:i,startPositions:this.startPositions(e)},{streamlines:d}=await s.generateStreamlines(o,t);return d}};w=(0,s.Cg)([(0,h.$)("esri.views.3d.support.flow.FlowSubViewExtent3D")],w);const y=Symbol("popupDrapeSource");var m=i(17214);let v=class extends((0,m.A)(l.A)){constructor(){super(...arguments),this.type="imagery-3d"}get highlightOptions(){return null}get pixelData(){return null}initialize(){const e=()=>this._updatingHandles.addPromise(this.refreshDebounced());this._updatingHandles.add(()=>this.layer?.exportImageServiceParameters?.version,e),this._updatingHandles.add(()=>this.layer?.renderer,e),this._updatingHandles.add(()=>this.timeExtent,e),this._highlightHelper=new u.r({view:this.view,layer:this.layer,updatingHandles:this._updatingHandles}),this.addHandles([(0,r.DQ)(this._highlightHelper),(0,a.wB)(()=>this.suspended,e=>this._highlightHelper.suspended=e,a.pc)])}_initSubView(){this.addHandles([(0,a.wB)(()=>this.layer.renderer,e=>this._recreateSubView(e),a.Vh)])}_recreateSubView(e){const t="flow"===e?.type,i="flow"===this.subView?.type,s=this.subView;s&&t===i||(this.subView=t?new w({layerView:this}):new p({layerView:this}),s?.destroy())}getFetchOptions(){return{timeExtent:this.timeExtent}}highlight(e,t){return this._highlightHelper.highlight(e,t)}isUpdating(){return super.isUpdating()||this._highlightHelper.updating}};(0,s.Cg)([(0,n.MZ)()],v.prototype,"highlightOptions",null),(0,s.Cg)([(0,n.MZ)()],v.prototype,"pixelData",null),v=(0,s.Cg)([(0,h.$)("esri.views.3d.layers.ImageryLayerView3D")],v);const f=v}}]);
//# sourceMappingURL=68632.37dbd9e7.chunk.js.map