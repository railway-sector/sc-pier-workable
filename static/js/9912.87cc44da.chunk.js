"use strict";(self.webpackChunksc_pier_workable=self.webpackChunksc_pier_workable||[]).push([[9912],{9912:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>X,createFieldInfoMap:()=>B,findRelatedLayer:()=>fe,findUtilityNetwork:()=>de,fixTokens:()=>D,formatAttributes:()=>te,formatEditInfo:()=>Y,formatValueToFieldInfo:()=>V,getAllFieldInfos:()=>K,getFieldFormat:()=>q,getFieldInfo:()=>P,getFieldInfoLabel:()=>Z,getFixedFieldName:()=>E,getFixedFieldNames:()=>R,getSourceLayer:()=>L,graphicCallback:()=>v,htmlEntities:()=>W,isAssociatedFeatureSupportedLayer:()=>_,isExpressionField:()=>k,isFeatureSupportedLayer:()=>z,isGraphicForRelatableFeatureSupportedLayer:()=>Q,isRelatableFeatureSupportedLayer:()=>H,isRelatableLayer:()=>G,isRelatedField:()=>ie,isSupportedContext:()=>A,preLayerQueryCallback:()=>ue,preRequestCallback:()=>se,querySourceLayer:()=>ne,queryUpdatedFeature:()=>re,shouldOpenInNewTab:()=>x,substituteAttributes:()=>S,substituteFieldsInLinksAndAttributes:()=>M});var r=n(81806),i=n(76460),l=n(88685),a=n(65256),o=n(50265),u=n(94890),s=n(53430),f=n(31933),d=n(42633),c=n(76386),p=n(67478);const y=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),m=/href=(""|'')/gi,g=/(\{([^{\r\n]+)\})/g,b=/'/g,I=/^\s*expression\//i,h=/(\n)/gi,F=/[\u00A0-\u9999<>&]/gim,w=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,T=/^(?:mailto:|tel:)/,N="relationships/",C=(0,a.J2)("short-date-short-time");function L(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function v(e){let{type:t,value:n,event:r}=e;try{return"function"==typeof n?n(r):await n}catch(i){return void y().error("error",`An error occurred when calling the "${t}" function`,{error:i,graphic:r.graphic,value:n})}}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!T.test(e.trim().toLowerCase())}function k(e){return!!e&&I.test(e)}function A(e){let{fieldInfo:t,graphic:n}=e;return!(!t?.fieldName||k(t.fieldName)||ie(t.fieldName)||n?.isAggregate||n?.popupTemplate)}function Z(e){let{expressionInfos:t,fieldInfo:n,graphic:r,isContentFieldInfos:i,layer:l}=e;if(!n?.fieldName)return null;const a=function(e,t){if(!t||!k(t)||!e)return;const n=t.replace(I,"").toLowerCase();return e.find(e=>{let{name:t}=e;return t.toLowerCase()===n})}(t,n.fieldName);if(a)return a.title||null;if((0,f.jy)(l)&&A({fieldInfo:n,graphic:r})){const e=l.getFieldAlias(n.fieldName);return i?n.label||e||n.fieldName:e||n.fieldName}return n.label||n.fieldName}function q(e){let{fieldInfo:t,isContentFieldInfos:n,layer:r}=e;if(!t?.fieldName)return null;if((0,f.jy)(r)){const e=r.popupTemplate||r.fieldConfigurations?r.getFieldConfiguration(t.fieldName)?.fieldFormat:(0,u.iu)(t,r.getField(t.fieldName));return n&&t.fieldFormat||e}return null}function E(e,t){const n=j(t,e);return n?n.name:e}function R(e,t){return e&&e.map(e=>E(e,t))}function j(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function U(e){return`${e}`.trim()}function M(e){let{attributes:t,globalAttributes:n,layer:r,text:i,expressionAttributes:l,fieldInfoMap:a}=e;return i?S({formattedAttributes:n,template:O(i,{...n,...l,...t},r),fieldInfoMap:a}):""}function S(e){let{formattedAttributes:t,template:n,fieldInfoMap:r}=e;return U(function(e){return e.replaceAll(m,"")}((0,l.HC)((0,l.HC)(n,e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,r)),t)))}function $(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t[e];if("string"==typeof r){const i="%27",l=(n?encodeURIComponent(r):r).replaceAll(b,i);t[e]=l}}(e,n,t)),n}function D(e,t){return e.replaceAll(g,(e,n,r)=>{const i=j(t,r);return i?`{${i.name}}`:n})}function O(e,t,n){const r=D(e,n);return r?r.replaceAll(w,(e,n,r)=>function(e,t,n){const r=(t=U(t))&&!t.startsWith("{");return(0,l.HC)(e,$(n,r||!1))}(e,n||r,t)):r}function z(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function G(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function H(e){return z(e)&&G(e)}function _(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function Q(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&H(e.sourceLayer)}function V(e,t){const{fieldInfos:n,fieldName:r,graphic:i,isContentFieldInfos:l,layer:a,preventPlacesFormatting:u,timeZone:c}=t,p=P(n,r),y=j(a,r),m=(0,f.jy)(a)&&A({fieldInfo:p,graphic:i}),g=m?null:p?.format,b=m?q({fieldInfo:p,layer:a,isContentFieldInfos:l}):null,I="number"===b?.type;if(p&&!(0,s.JL)(r)){const t=y?.type,n="date-time"===b?.type,r=g?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n||r)return(0,d.i0)(e,{format:n?void 0:r,fieldFormat:n?b:void 0,fieldType:t,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:c,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}})}if("string"==typeof e&&(0,s.JL)(r)&&g)return function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?J(e,",",", ",t):e.includes(";")?J(e,";","; ",t):e.includes(" ")?J(e," "," ",t):(0,o.ZV)(Number(e),(0,o.yx)(t))}(e,g);if("string"==typeof(e=function(e,t){const n="number"===t?.fieldFormat?.type||t?.format&&null==t.format.dateFormat&&(null!=t.format.places||null!=t.format.digitSeparator);if("string"==typeof e&&n){const t=Number(e);if(!isNaN(t))return t}return e}(e,{format:I?void 0:g,fieldFormat:I?b:void 0}))||null==e||null==g&&null==b)return X(e);const h=I?(0,o.Up)(b):g?(0,o.yx)(g):void 0;return(0,o.ZV)(e,u?{...h,minimumFractionDigits:0,maximumFractionDigits:20}:h)}function J(e,t,n,r){return e.trim().split(t).map(e=>(0,o.ZV)(Number(e),(0,o.yx)(r))).join(n)}function P(e,t){if(e?.length&&t)return e.find(e=>e.fieldName?.toLowerCase()===t.toLowerCase())}function Y(e,t,n,r){const{creatorField:i,creationDateField:l,editorField:o,editDateField:u}=e;if(!t)return;const s=(0,p.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,n,C,"date"),f={...C,...s},d=t[u];if("number"==typeof d){const e=t[o];return{type:"edit",date:(0,a.Yq)(d,f),user:e}}const c=t[l];if("number"==typeof c){const e=t[i];return{type:"create",date:(0,a.Yq)(c,f),user:e}}return null}function B(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=E(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function K(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach(e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}}),t):t}function W(e){return e.replaceAll(F,e=>`&#${e.charCodeAt(0)};`)}function X(e){return"string"==typeof e?e.replaceAll(h,'<br class="esri-text-new-line" />'):e}function ee(e){const{fieldInfoMap:t,fieldInfos:n,fieldName:i,graphic:l,isContentFieldInfos:a,layer:o,timeZone:u,value:f}=e;if(null==f)return"";const c=function(e){let{fieldName:t,value:n,graphic:i,layer:l}=e;if(ie(t))return null;if(!l||"function"!=typeof l.getFieldDomain)return null;const a=i&&l.getFieldDomain(t,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(n):null}({fieldName:i,value:f,graphic:l,layer:o});if(c)return c;const p=function(e){let{fieldName:t,graphic:n,layer:r}=e;if(ie(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const l=r.getFeatureType(n);return l?l.name:null}({fieldName:i,graphic:l,layer:o});if(p)return p;if(t.get(i.toLowerCase()))return V(f,{fieldInfos:n||Array.from(t.values()),fieldName:i,graphic:l,isContentFieldInfos:a,layer:o,timeZone:u});const y=o?.fieldsIndex?.get(i);return y&&((0,d.fs)(y)||(0,s.OH)(y))?(0,d.i0)(f,{fieldType:y.type,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:u,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}}):X(f)}function te(e){let{attributes:t,fieldInfoMap:n,fieldInfos:r,graphic:i,isContentFieldInfos:l,layer:a,relatedInfos:o,timeZone:u}=e;const s={};return o?.forEach(e=>function(e){let{attributes:t,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:a}=e;t&&n&&(n.relatedFeatures?.forEach(e=>le({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:a})),n.relatedStatsFeatures?.forEach(e=>le({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:a})))}({attributes:s,relatedInfo:e,fieldInfoMap:n,fieldInfos:r,layer:a,timeZone:u})),t&&Object.keys(t).forEach(e=>{const o=t[e];s[e]=ee({fieldInfoMap:n,fieldInfos:r,fieldName:e,graphic:i,isContentFieldInfos:l,layer:a,timeZone:u,value:o})}),s}async function ne(e,t){const{layer:n,graphic:r,outFields:i,objectIds:l,returnGeometry:a,spatialReference:o}=e,u=l[0];if("number"!=typeof u&&"string"!=typeof u){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:r,objectId:u,requiredFields:i};return y().warn(e,t),null}if(!(0,f.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:r,requiredFields:i,returnGeometry:a};return y().warn(e,t),null}const s=n.createQuery();return s.objectIds=l,s.outFields=i?.length?i:[n.objectIdField],s.returnGeometry=!!a,s.returnZ=!!a,s.returnM=!!a,s.outSpatialReference=o,(await n.queryFeatures(s,t)).features[0]}async function re(e,t){let{graphic:n,popupTemplate:r,layer:i,spatialReference:l}=e;if(!i||!r)return;if("function"==typeof i.load&&await i.load(t),!n.attributes)return;const a=i.objectIdField,o=n.attributes[a];if(null==o)return;const u=[o],f=new Set(await r.getRequiredFields(i.fieldsIndex));null==i.timeInfo?.trackIdField||f.has(i.timeInfo.trackIdField)||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.l)(),{arcadeUtils:{requiresTrack:n}}=t;return n(e)}(r)&&f.add(i.timeInfo.trackIdField);const d=(0,s.Kl)(n,f),p=d?[]:f.has(a)?[...f]:[...f,a],y=r.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.l)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(r);if(d&&!y)return;const m=await ne({layer:i,graphic:n,outFields:p,objectIds:u,returnGeometry:y,spatialReference:l},t);m&&(m.geometry&&(n.geometry=m.geometry),m.attributes&&(n.attributes={...n.attributes,...m.attributes}))}function ie(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(N)}function le(e){let{attributes:t,graphic:n,relatedInfo:r,fieldInfos:i,fieldInfoMap:l,layer:a,timeZone:o}=e;t&&n&&r&&Object.keys(n.attributes).forEach(e=>{const u=function(e){return e?`${N}${e.layerId}/${e.fieldName}`:""}({layerId:r.relation.id.toString(),fieldName:e}),s=n.attributes[e];t[u]=ee({fieldName:u,fieldInfos:i,fieldInfoMap:l,layer:a,value:s,graphic:n,timeZone:o})})}const ae=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},oe=e=>{let{layer:t,method:n,query:r,definitionExpression:i}=e;if(!t.capabilities?.query?.supportsCacheHint||"attachments"===n)return;const l=null!=r.where?r.where:null,a=null!=r.geometry?r.geometry:null;ae(i)||ae(l)||"extent"===a?.type||"tile"===r.resultType||(r.cacheHint=!0)},ue=e=>{let{query:t,layer:n,method:r}=e;oe({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})},se=e=>{let{queryPayload:t,layer:n,method:r}=e;oe({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})};function fe(e,t,n){return e&&t&&n?"sublayer"===t.type?pe({layers:t.layer?.allSublayers,map:e,relatedLayer:t,relationship:n})||pe({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):pe({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||pe({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function de(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find(e=>e.isUtilityLayer(t)):null}function ce(e,t){return e?.allTables.find(e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url)}function pe(e){let{map:t,relationship:n,relationship:{relatedTableId:r},relatedLayer:i,layers:l}=e;if(!l)return null;for(const a of l){if("map-image"===a.type){const e=pe({layers:a.sublayers,map:t,relatedLayer:i,relationship:n})||pe({layers:a.subtables,map:t,relatedLayer:i,relationship:n});if(e)return e;continue}if(!H(a))continue;if("sublayer"===i.type){if(a!==i&&a.id===r)return a.isTable?ce(t,a):a;continue}const e="scene"===i.type&&i.associatedLayer?i.associatedLayer.url:i.url;if(!e)return null;if("sublayer"!==a.type){if(a!==i&&a.url===e&&a.layerId===r)return a}else if(a!==i&&a.layer?.url===e&&a.id===r)return a.isTable?ce(t,a):a}return null}}}]);
//# sourceMappingURL=9912.87cc44da.chunk.js.map