"use strict";(self.webpackChunksc_pier_workable=self.webpackChunksc_pier_workable||[]).push([[1509,53154,58067,68707],{10294:(e,t,r)=>{r.d(t,{S:()=>c});var s=r(15941),i=r(31633),n=r(20664),o=r(5568),a=r(13927);function c(e,t,r){const c=function(e,t,r,s){const o=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],c=s?(0,i.GA)(s)/(0,i.G9)(s):1;return(0,a.lU)(e,(e,t)=>(0,n.i)(e,o(t,0)*c,o(t,1)*c,o(t,2)),r)}(l,e,t,r)?(0,a.Qj)(l):[0,0,1];return Math.abs(c[2])>Math.cos((0,s.kU)(80))?o._.Z:Math.abs(c[1])>Math.abs(c[0])?o._.Y:o._.X}const l=(0,a.vt)()},38983:(e,t,r)=>{function s(e,t,r){r=r||2;var s,n,a,c,l,u,d,p=t&&t.length,f=p?t[0]*r:e.length,_=i(e,0,f,r,!0),m=[];if(!_||_.next===_.prev)return m;if(p&&(_=h(e,t,_,r)),e.length>80*r){s=a=e[0],n=c=e[1];for(var y=r;y<f;y+=r)(l=e[y])<s&&(s=l),(u=e[y+1])<n&&(n=u),l>a&&(a=l),u>c&&(c=u);d=0!==(d=Math.max(a-s,c-n))?1/d:0}return o(_,m,r,s,n,d),m}function i(e,t,r,s,i){var n,o;if(i===D(e,t,r,s)>0)for(n=t;n<r;n+=s)o=G(n,e[n],e[n+1],o);else for(n=r-s;n>=t;n-=s)o=G(n,e[n],e[n+1],o);if(o&&R(o,o.next)){var a=o.next;E(o),o=a}return o}function n(e,t){if(!e)return e;t||(t=e);var r,s=e;do{if(r=!1,s.steiner||!R(s,s.next)&&0!==w(s.prev,s,s.next))s=s.next;else{var i=s.prev;if(E(s),(s=t=i)===s.next)break;r=!0}}while(r||s!==t);return t}function o(e,t,r,s,i,h,d){if(e){!d&&h&&m(e,s,i,h);for(var p,f,_=e;e.prev!==e.next;)if(p=e.prev,f=e.next,h?c(e,s,i,h):a(e))t.push(p.i/r),t.push(e.i/r),t.push(f.i/r),E(e),e=f.next,_=f.next;else if((e=f)===_){d?1===d?o(e=l(n(e),t,r),t,r,s,i,h,2):2===d&&u(e,t,r,s,i,h):o(n(e),t,r,s,i,h,1);break}}}function a(e){var t=e.prev,r=e,s=e.next;if(w(t,r,s)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(v(t.x,t.y,r.x,r.y,s.x,s.y,i.x,i.y)&&w(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function c(e,t,r,s){var i=e.prev,n=e,o=e.next;if(w(i,n,o)>=0)return!1;for(var a=i.x<n.x?i.x<o.x?i.x:o.x:n.x<o.x?n.x:o.x,c=i.y<n.y?i.y<o.y?i.y:o.y:n.y<o.y?n.y:o.y,l=i.x>n.x?i.x>o.x?i.x:o.x:n.x>o.x?n.x:o.x,u=i.y>n.y?i.y>o.y?i.y:o.y:n.y>o.y?n.y:o.y,h=y(a,c,t,r,s),d=y(l,u,t,r,s),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&v(i.x,i.y,n.x,n.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&v(i.x,i.y,n.x,n.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&v(i.x,i.y,n.x,n.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&v(i.x,i.y,n.x,n.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function l(e,t,r){var s=e;do{var i=s.prev,o=s.next.next;!R(i,o)&&A(i,s,s.next,o)&&M(i,o)&&M(o,i)&&(t.push(i.i/r),t.push(s.i/r),t.push(o.i/r),E(s),E(s.next),s=e=o),s=s.next}while(s!==e);return n(s)}function u(e,t,r,s,i,a){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&x(c,l)){var u=O(c,l);return c=n(c,c.next),u=n(u,u.next),o(c,t,r,s,i,a),void o(u,t,r,s,i,a)}l=l.next}c=c.next}while(c!==e)}function h(e,t,r,s){var o,a,c,l=[];for(o=0,a=t.length;o<a;o++)(c=i(e,t[o]*s,o<a-1?t[o+1]*s:e.length,s,!1))===c.next&&(c.steiner=!0),l.push(g(c));for(l.sort(d),o=0;o<l.length;o++)r=n(r=f(l[o],r),r.next);return r}function d(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function f(e,t){var r=function(e,t){var r,s=t,i=e.x,n=e.y,o=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var a=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=i&&a>o){if(o=a,a===i){if(n===s.y)return s;if(n===s.next.y)return s.next}r=s.x<s.next.x?s:s.next}}s=s.next}while(s!==t);if(!r)return null;if(i===o)return r;var c,l=r,u=r.x,h=r.y,d=1/0;s=r;do{i>=s.x&&s.x>=u&&i!==s.x&&v(n<h?i:o,n,u,h,n<h?o:i,n,s.x,s.y)&&(c=Math.abs(n-s.y)/(i-s.x),M(s,e)&&(c<d||c===d&&(s.x>r.x||s.x===r.x&&_(r,s)))&&(r=s,d=c)),s=s.next}while(s!==l);return r}(e,t);if(!r)return t;var s=O(r,e),i=n(r,r.next);let o=p(s);return n(o,o.next),i=p(i),p(t===r?i:t)}function _(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function m(e,t,r,s){var i=e;do{null===i.z&&(i.z=y(i.x,i.y,t,r,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,s,i,n,o,a,c,l=1;do{for(r=e,e=null,n=null,o=0;r;){for(o++,s=r,a=0,t=0;t<l&&(a++,s=s.nextZ);t++);for(c=l;a>0||c>0&&s;)0!==a&&(0===c||!s||r.z<=s.z)?(i=r,r=r.nextZ,a--):(i=s,s=s.nextZ,c--),n?n.nextZ=i:e=i,i.prevZ=n,n=i;r=s}n.nextZ=null,l*=2}while(o>1)}(i)}function y(e,t,r,s,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function v(e,t,r,s,i,n,o,a){return(i-o)*(t-a)-(e-o)*(n-a)>=0&&(e-o)*(s-a)-(r-o)*(t-a)>=0&&(r-o)*(n-a)-(i-o)*(s-a)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&A(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){var r=e,s=!1,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next}while(r!==e);return s}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||R(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function R(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,r,s){var i=C(w(e,t,r)),n=C(w(e,t,s)),o=C(w(r,s,e)),a=C(w(r,s,t));return i!==n&&o!==a||!(0!==i||!b(e,r,t))||!(0!==n||!b(e,s,t))||!(0!==o||!b(r,e,s))||!(0!==a||!b(r,t,s))}function b(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function C(e){return e>0?1:e<0?-1:0}function M(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function O(e,t){var r=new P(e.i,e.x,e.y),s=new P(t.i,t.x,t.y),i=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,s.next=r,r.prev=s,n.next=s,s.prev=n,s}function G(e,t,r,s){var i=new P(e,t,r);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(e,t,r,s){for(var i=0,n=t,o=r-s;n<r;n+=s)i+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return i}r.d(t,{e:()=>s}),s.deviation=function(e,t,r,s){var i=t&&t.length,n=i?t[0]*r:e.length,o=Math.abs(D(e,0,n,r));if(i)for(var a=0,c=t.length;a<c;a++){var l=t[a]*r,u=a<c-1?t[a+1]*r:e.length;o-=Math.abs(D(e,l,u,r))}var h=0;for(a=0;a<s.length;a+=3){var d=s[a]*r,p=s[a+1]*r,f=s[a+2]*r;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},s.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},s=0,i=0;i<e.length;i++){for(var n=0;n<e[i].length;n++)for(var o=0;o<t;o++)r.vertices.push(e[i][n][o]);i>0&&(s+=e[i-1].length,r.holes.push(s))}return r}},40366:(e,t,r)=>{r.d(t,{F:()=>d,a:()=>_,b:()=>p});var s=r(34761),i=r(13191),n=r(9392),o=r(86955),a=r(23687),c=r(12216),l=r(66470),u=r(31432),h=r(2687);class d extends u.Y{constructor(){super(...arguments),this.origin=n.uY}}function p(){const e=new h.N5;return e.attributes.add(l.r.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new a.F("proj",e=>e.camera.projectionMatrix),new c.S("view",(e,t)=>(0,s.Tl)(f,t.camera.viewMatrix,e.origin))).main.add(o.H`gl_Position = proj * view * vec4(position, 1.0);
gl_Position.z = min(gl_Position.z, gl_Position.w);`),e.fragment.main.add(o.H`fragColor = vec4(1., 0., 0., 0.);`),e}const f=(0,i.vt)(),_=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:d,build:p},Symbol.toStringTag,{value:"Module"}))},50360:(e,t,r)=>{r.d(t,{Pg:()=>c,fz:()=>l,g7:()=>o,zo:()=>a});var s=r(68707),i=(r(97799),r(63331),r(82103));r(91523);const n=new i.O;function o(e,t,r){return n.execute(e,t,r,null)}function a(e,t,r){const i=n.executeMany(new s.S(e),t,r,null);return Array.from(i)}function c(e,t,r){return n.isSimpleAsFeature(e,t,r,null,null)}function l(){return n.supportsCurves()}},58067:(e,t,r)=>{r.r(t),r.d(t,{fromExtent:()=>v,fromGeometry:()=>g,fromMultipoint:()=>x,fromPoint:()=>w,fromPolygon:()=>R,fromPolyline:()=>A,fromSpatialReference:()=>b,getSpatialReference:()=>y,toExtent:()=>M,toGeometry:()=>C,toMultipoint:()=>O,toPoint:()=>G,toPolygon:()=>E,toPolyline:()=>P});var s=r(26871),i=(r(21557),r(97799)),n=r(91523),o=r(63331),a=r(82103),c=r(76797),l=r(66388),u=r(19247),h=r(65215),d=r(23701),p=(r(59739),r(48045));const f="_gxVersion",_=2,m=1;function y(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference}function g(e){switch(e.type){case"point":return w(e);case"multipoint":return x(e);case"polyline":return A(e);case"polygon":return R(e);case"extent":return v(e);default:throw new Error(`Unsupported geometry type: ${e.type}`)}}function v(e){if(!e.getCacheValue(f)){const t=new n.E;t.setCoords(e.xmin,e.ymin,e.xmax,e.ymax),e.hasM&&t.setInterval(_,0,e.mmin,e.mmax),e.hasZ&&t.setInterval(m,0,e.zmin,e.zmax),e.setCacheValue(f,t)}return e.getCacheValue(f)}function x(e){if(!e.getCacheValue(f)){const t=new o.M,r=new n.P,s=e.points,i=e.hasM,a=e.hasZ,c=a?3:2;for(let e=0,n=s.length;e<n;e++){const n=s[e];r.setXYCoords(n[0],n[1]),a&&r.setZ(n[2]??0),i&&r.setM(n[c]??NaN),t.add(r)}e.setCacheValue(f,t)}return e.getCacheValue(f)}function w(e){if(!e.getCacheValue(f)){const t=new n.P;t.setXYCoords(e.x,e.y),e.hasM&&t.setM(e.m),e.hasZ&&t.setZ(e.z),e.setCacheValue(f,t)}return e.getCacheValue(f)}function R(e){if(!e.getCacheValue(f)){const{curveRings:t,hasM:r,hasZ:s,rings:i}=e,n=(0,p.fromGeometryToGXGeometry)({curveRings:t,hasM:r,hasZ:s,rings:i});e.setCacheValue(f,n)}return e.getCacheValue(f)}function A(e){if(!e.getCacheValue(f)){const{curvePaths:t,hasM:r,hasZ:s,paths:i}=e,n=(0,p.fromGeometryToGXGeometry)({curvePaths:t,hasM:r,hasZ:s,paths:i});e.setCacheValue(f,n)}return e.getCacheValue(f)}function b(e){if(e.wkid)return(0,a.c)(e.wkid);const t=e.wkt2||e.wkt;return t?(0,a.a)(t):null}function C(e,t){if(e)switch(e.getGeometryType()){case i.G.enumPoint:return G(e,t);case i.G.enumEnvelope:return M(e,t);case i.G.enumMultiPoint:return O(e,t);case i.G.enumPolyline:return P(e,t);case i.G.enumPolygon:return E(e,t)}return null}function M(e,t){if(e.isEmpty())return null;const r=new c.A({xmin:e.getXMin(),ymin:e.getYMin(),xmax:e.getXMax(),ymax:e.getYMax(),spatialReference:t}),s=e.getDescription();if(s.hasM()){const t=e.queryInterval(_,0);r.mmin=t.vmin,r.mmax=t.vmax}if(s.hasZ()){const t=e.queryInterval(m,0);r.zmin=t.vmin,r.zmax=t.vmax}return r.setCacheValue(f,e),r}function O(e,t){if(e.isEmpty())return null;const r=e.getDescription(),s=r.hasM(),i=r.hasZ(),o=[],a=new n.P;for(let n=0,l=e.getPointCount();n<l;n++){e.getPointByVal(n,a);const t=[a.getX(),a.getY()];i&&t.push(a.getZ()),s&&t.push(a.getM()),o.push(t)}const c=new l.A({hasM:s,hasZ:i,points:o,spatialReference:t});return c.setCacheValue(f,e),c}function G(e,t){if(e instanceof s.P)return new u.A({x:e.x,y:e.y,spatialReference:t});if(e.isEmpty())return null;const r=new u.A({x:e.getX(),y:e.getY(),spatialReference:t}),i=e.getDescription();return i.hasM()&&(r.m=e.getM()),i.hasZ()&&(r.z=e.getZ()),r.setCacheValue(f,e),r}function E(e,t){if(e.isEmpty())return null;const r=h.A.fromJSON({spatialReference:t,...(0,p.toGeometry)(e,null)});return r.setCacheValue(f,e),r}function P(e,t){if(e.isEmpty())return null;const r=d.A.fromJSON({spatialReference:t,...(0,p.toGeometry)(e,null)});return r.setCacheValue(f,e),r}},59499:(e,t,r)=>{var s;r.d(t,{t:()=>s}),function(e){e[e.BRIGHT=0]="BRIGHT",e[e.DARK=1]="DARK"}(s||(s={}))},68707:(e,t,r)=>{r.d(t,{G:()=>s,S:()=>i});class s{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}class i extends s{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}},69230:(e,t,r)=>{r.d(t,{B:()=>i});r(81806);var s=r(68134);class i{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this.forEachMaterial(t=>t?.setParameters({isDecoration:e}))}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,s.wB)(()=>e.view.ready,e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProperties(e){let t=!1;for(const r in e)r in this&&("attached"===r?t=!!e[r]:this[r]=e[r]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view.stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},73074:(e,t,r)=>{r.d(t,{P:()=>A});var s=r(54099),i=r(20664),n=r(9392),o=r(43047),a=r(55855),c=r(45308),l=r(42294),u=r(44815),h=r(18117),d=r(12482),p=r(731),f=r(85746),_=r(1307),m=r(49296),y=r(70667),g=r(29889),v=r(45463),x=r(442),w=r(66470),R=r(425);class A extends f.X{constructor(e){super(e),this._attachmentOrigin=(0,h.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new s.A,this._geometry=null,this._width=1,this._color=(0,a.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,a.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=v.m$.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new _.o({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:b,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:b,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){const t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,o.a)(e,this._color)||((0,o.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,o.a)(e,this._innerColor)||((0,o.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,o.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,a.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,i.i)(M,0,0,0);let t=0;for(const r of e)r.computeAttachmentOrigin(C)&&((0,i.f)(M,M,C),t++);return 0===t?null:((0,i.g)(M,M,1/t),this.view.renderCoordsHelper.fromRenderCoords(M,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===v.m$.OccludeAndTransparentStencil?v.m$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const s of r)e.addGeometry(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new R.W(this._materialParameters),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r}}_createDrapedResources(){const e=new R.W(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,s=r.basemapTerrain.spatialReference;return null==t||null==s?[]:(0,g.A)(t,s).lines.map(t=>{let{position:i}=t;const n={overlayInfo:{spatialReference:s,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:i},removeDuplicateStartEnd:this._isClosed};return new x.$((0,y.t)(e,n))})}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const s=r.attributes.get(w.r.POSITION),i=(0,u.jh)(s.data.length);(0,c.projectBuffer)(s.data,t.spatialReference,0,i,this.view.spatialReference,0),(0,l.Hq)(e,i)}return!0}_createRenderGeometries(e,t){const r=this.geometry;if(null==r)return;const s=(0,g.C)(r,this.view.elevationProvider,this.view.renderCoordsHelper,m.F.fromElevationInfo(this.elevationInfo??new p.A({mode:(0,d.w7)(r,null)}))),i=new Array;for(const{position:n,mapPositions:o}of s.lines){const r={mapPositions:o,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push((0,y.t)(e,r)),i.push(n)}this._laserline.pathVerticalPlane=i}}function b(e){e.geometries=[]}const C=(0,n.vt)(),M=(0,n.vt)()},77176:(e,t,r)=>{r.d(t,{b:()=>n});var s=r(15941),i=r(38496);function n(e,t,r){const n=Array.isArray(e),u=n?e.length/t:e.byteLength/(4*t),h=n?e:new Uint32Array(e,0,u*t),d=r?.minReduction??0,p=r?.originalIndices||null,f=p?p.length:0,_=r?.componentOffsets||null;let m=0;if(_)for(let s=0;s<_.length-1;s++){const e=_[s+1]-_[s];e>m&&(m=e)}else m=u;const y=Math.floor(1.1*m)+1;(null==l||l.length<2*y)&&(l=new Uint32Array((0,s.cU)(2*y)));for(let s=0;s<2*y;s++)l[s]=0;let g=0;const v=!!_&&!!p,x=v?f:u;let w=(0,i.my)(u);const R=new Uint32Array(f),A=1.96;let b=0!==d?Math.ceil(4*A*A/(d*d)*d*(1-d)):x,C=1,M=_?_[1]:x;for(let s=0;s<x;s++){if(s===b){const e=1-g/s;if(e+A*Math.sqrt(e*(1-e)/s)<d)return null;b*=2}if(s===M){for(let e=0;e<2*y;e++)l[e]=0;if(p)for(let e=_[C-1];e<_[C];e++)R[e]=w[p[e]];M=_[++C]}const e=v?p[s]:s,r=e*t,i=c(h,r,t);let n=i%y,a=g;for(;0!==l[2*n+1];){if(l[2*n]===i){const e=l[2*n+1]-1;if(o(h,r,e*t,t)){a=w[e];break}}n++,n>=y&&(n-=y)}a===g&&(l[2*n]=i,l[2*n+1]=e+1,g++),w[e]=a}if(0!==d&&1-g/u<d)return null;if(v){for(let e=_[C-1];e<R.length;e++)R[e]=w[p[e]];w=(0,i.uW)(R)}const O=n?new Array(g):new Uint32Array(g*t);g=0;for(let s=0;s<x;s++)w[s]===g&&(a(h,(v?p[s]:s)*t,O,g*t,t),g++);if(p&&!v){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=w[p[t]];w=(0,i.uW)(e)}return{buffer:Array.isArray(O)?O:O.buffer,indices:w,uniqueCount:g}}function o(e,t,r,s){for(let i=0;i<s;i++)if(e[t+i]!==e[r+i])return!1;return!0}function a(e,t,r,s,i){for(let n=0;n<i;n++)r[s+n]=e[t+n]}function c(e,t,r){let s=0;for(let i=0;i<r;i++)s=e[t+i]+s|0,s=s+(s<<11)+(s>>>2)|0;return s>>>0}let l=null},80069:(e,t,r)=>{r.d(t,{F:()=>u,a:()=>d,b:()=>h});var s=r(73398),i=r(86955),n=r(72790),o=r(70367),a=r(59499),c=r(31432),l=r(2687);class u extends c.Y{constructor(){super(...arguments),this.effect=a.t.BRIGHT}}function h(){const e=new l.N5;return e.include(s.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new o.N("colorTexture",e=>e.color),new o.N("focusArea",e=>e.focusArea),new n.c("focusAreaEffectMode",e=>e.effect)).main.add(i.H`
      float mask = texture( focusArea, uv, 0.0 ).r;
      vec4 color = texture( colorTexture, uv, 0.0 );
      vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
      if (focusAreaEffectMode == ${i.H.int(a.t.BRIGHT)}) {
        fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
      } else {
        fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
      }
  `),e}const d=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},83457:(e,t,r)=>{r.d(t,{fz:()=>a,g7:()=>n,zo:()=>o});var s=r(68707);const i=new(r(20265).O);function n(e,t,r,s){return i.execute(e,t,r,s,null)}function o(e,t,r,n){const o=i.executeMany(new s.S(e),t,r,n,null);return Array.from(o)}function a(){return i.supportsCurves()}},85746:(e,t,r)=>{r.d(t,{X:()=>g});var s=r(35143),i=r(91967),n=r(5632),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),c=r(57662),l=r(57824),u=r(44513);class h{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=c.O7.Outline}destroy(){this._destroyResources()}get resources(){return this._resources?.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new d({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,l.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,l.q.UPDATE),this._resources.geometriesAdded=!0))}}let d=class extends(n.A.IdentifiableMixin(i.A)){constructor(e){super(e),this.drapeSourceType=c.Om.Features,this.updatePolicy=u.q.SYNC,this.renderGroup=c.O7.Outline}};(0,s._)([(0,o.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],d.prototype,"drapeSourceType",void 0),(0,s._)([(0,o.MZ)()],d.prototype,"renderGroup",void 0),d=(0,s._)([(0,a.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],d);var p=r(69230),f=r(68134),_=r(37046),m=r(8918);class y{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view.stage;if(null==this._resources||!e)return;const t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,r=t.stage;if(!r)return;const s=new m.x(r,{pickable:!1,updatePolicy:u.q.SYNC}),i=new _.B({castShadow:!1}),n=e.createResources(i,s);s.add(i);const o=e.cameraChanged,a=o?(0,f.wB)(()=>t.state.camera,e=>o(e),f.Vh):null;this._resources={layer:s,object:i,external:n,cameraHandle:a},this._syncVisible()}_destroyResources(){null!=this._resources&&(this._resources.layer.destroy(),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class g extends p.B{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new y(this.createObject3DResourceFactory(e.view)),this.drapedResources=new h(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){this.object3dResources?.forEachMaterial(e),this.drapedResources?.forEachMaterial(e)}}},94522:(e,t,r)=>{r.r(t),r.d(t,{FocusAreasView:()=>ne});var s=r(35143),i=r(91967),n=r(18690),o=r(19276),a=r(50076),c=r(76460),l=r(43927),u=r(30726),h=r(68134),d=r(31633),p=r(46053),f=(r(81806),r(85842)),_=r(38983),m=r(13191),y=r(9392),g=r(34111),v=r(19247),x=r(9956),w=r(83457),R=r(50360),A=r(58067),b=r(5809),C=r(44815),M=r(14556),O=r(38496),G=r(45136),E=r(64465),P=r(49296),D=r(16266),S=r(36423),Z=r(87925),V=(r(47249),r(90364)),T=r(36451),F=r(16506),I=r(59246),N=r(80069),j=r(57162);class k extends I.w{constructor(e,t){super(e,t,new F.$(N.a,()=>r.e(75915).then(r.bind(r,75915))))}initializePipeline(){return(0,j.Ey)({colorWrite:j.kn})}}var z=r(59499),W=r(93345);let H=class extends T.A{constructor(e){super({...e,view:e.focusAreasView.view}),this.consumes={required:[V.OG.FOCUSAREA_COLOR,V.OG.FOCUSAREA]},this.produces=V.OG.FOCUSAREA_COLOR,this._passParameters=new N.F}precompile(){this.techniques.precompile(k)}render(e){const t=this.techniques.get(k),r=e.find(e=>{let{name:t}=e;return t===this.produces});if(!t.compiled)return this.requestRender(),r;const s=this.focusAreasView.style,i=this.bindParameters,n=i.camera,o=n.fullViewport[2],a=n.fullViewport[3],c=e.find(e=>{let{name:t}=e;return t===V.OG.FOCUSAREA}),l=this.fboCache.acquire(o,a,this.produces),u=this.renderingContext;return u.bindFramebuffer(l.fbo),this._passParameters.color=r.getTexture(),this._passParameters.focusArea=c.getTexture(),this._passParameters.effect=q[s],u.bindTechnique(t,i,this._passParameters),u.screen.draw(),l.attachDepth(r.getAttachment(W.nI)),l}};(0,s._)([(0,p.MZ)()],H.prototype,"consumes",void 0),(0,s._)([(0,p.MZ)()],H.prototype,"produces",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],H.prototype,"focusAreasView",void 0),H=(0,s._)([(0,f.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],H);const q={bright:z.t.BRIGHT,dark:z.t.DARK};var U=r(74957),B=r(40366);class L extends I.w{constructor(e,t){super(e,t,new F.$(B.a,()=>r.e(47144).then(r.bind(r,47144))))}initializePipeline(){return(0,j.Ey)({colorWrite:j.kn,depthTest:{func:W.MT.LEQUAL}})}}var $=r(32119),Y=r(11850),X=r(69008),K=r(76718),Q=r(31432);let J=class extends T.A{constructor(e){super({...e,view:e.focusAreasView.view}),this.consumes={required:[V.hM.TRANSPARENT]},this.produces=V.OG.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new B.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(L)}render(e){const t=this.techniques.get(L),r=this.bindParameters,s=r.camera,i=s.fullViewport[2],n=s.fullViewport[3];if(!t.compiled||!this._vaos)return void this.requestRender();const o=e.find(e=>{let{name:t}=e;return t===V.hM.TRANSPARENT}),a=this.renderingContext,c=this.fboCache.acquire(i,n,V.OG.FOCUSAREA,U.NV.RG8UNORM);this.view.stage.renderer.occludedRequiresStencil?(c.acquireDepth(U.zd.DEPTH24_STENCIL8),a.blitFramebuffer(o.fbo,c.fbo,W.NV.DEPTH)):c.attachDepth(o.getAttachment(W.nI)),a.bindFramebuffer(c.fbo),a.setClearColor(0,0,0,1),a.clear(W.NV.COLOR|W.NV.STENCIL),a.setViewport(0,0,i,n);const l=a.bindTechnique(t,r);a.setFaceCullingEnabled(!1),a.setStencilTestEnabled(!0),a.setStencilOpSeparate(W.Y7.FRONT,W.eA.KEEP,W.eA.INCR_WRAP,W.eA.KEEP),a.setStencilOpSeparate(W.Y7.BACK,W.eA.KEEP,W.eA.DECR_WRAP,W.eA.KEEP),a.setDepthWriteEnabled(!1);for(let u=0;u<this._vaos.length;u++){const e=this._vaos[u],t=this._counts[u];this._maskParameters.origin=this._origins[u],l.bindDraw(r,Q.m,this._maskParameters),a.bindVAO(e),a.setDepthTestEnabled(!0),a.setStencilWriteMask(255),a.setStencilFunction(W.MT.ALWAYS,0,255),a.setColorMask(!1,!1,!1,!1),a.drawArrays(W.WR.TRIANGLES,0,t),a.setDepthTestEnabled(!1),a.setStencilWriteMask(0),a.setStencilFunction(W.MT.NOTEQUAL,0,255),a.setColorMask(!0,!0,!0,!0),a.drawArrays(W.WR.TRIANGLES,0,t)}return c}updateGeometries(){this.view.stage&&(this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0,this.focusAreasView.volumes.forEach(e=>e.forEach(e=>{const t=new Array,r=e.indicesBottom;for(let n=0;n<r.length;n++)t.push(e.positions[3*(r[n]-1)]),t.push(e.positions[3*(r[n]-1)+1]),t.push(e.positions[3*(r[n]-1)+2]);const s=e.indicesExtruded;for(let n=0;n<s.length;n++)t.push(e.positions[3*s[n]]),t.push(e.positions[3*s[n]+1]),t.push(e.positions[3*s[n]+2]);const i=new X.Z(this.renderingContext,$.D,new Map([["geometry",Y.SL]]),new Map([["geometry",K.g.createVertex(this.renderingContext,W._U.STATIC_DRAW,new Float32Array(t))]]));this._vaos.push(i),this._counts.push(r.length+s.length),this._origins.push(e.origin)})),this.requestRender())}};(0,s._)([(0,p.MZ)()],J.prototype,"consumes",void 0),(0,s._)([(0,p.MZ)()],J.prototype,"produces",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],J.prototype,"focusAreasView",void 0),J=(0,s._)([(0,f.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],J);class ee{constructor(e,t,r,s,i){this.positions=e,this.indicesBottom=t,this.indicesExtruded=r,this.height=s,this.origin=i}}var te=r(69539),re=r(73074),se=r(45463);let ie=class extends i.A{constructor(e){super(e)}initialize(){this.addHandles([(0,h.wB)(()=>this.area.enabled,()=>this._ensureElement(),h.Vh),(0,h.wB)(()=>this.area.outline?.color,e=>this._updateColor(e),h.Vh),(0,h.wB)(()=>this.area.geometries,e=>this._updateGeometries(e),h.Vh)])}destroy(){this.removeAllHandles(),this._outlineElement=(0,u.pR)(this._outlineElement)}_ensureElement(){this.area.enabled&&this.area.outline?.color?this._outlineElement??=new re.P({view:this.view,geometry:this._mergePolygons(this.area.geometries),isDraped:!0,attached:!0,isDecoration:!1,color:te.A.toUnitRGBA(this.area.outline?.color),renderOccluded:se.m$.OccludeAndTransparent,width:3}):this._outlineElement=(0,u.pR)(this._outlineElement)}_updateGeometries(e){this._ensureElement(),this._outlineElement&&(this._outlineElement.geometry=this._mergePolygons(e))}_updateColor(e){this._ensureElement(),this._outlineElement&&e&&(this._outlineElement.color=te.A.toUnitRGBA(e))}_mergePolygons(e){if(!e||0===e.length)return null;const t=e.at(0).clone();return e.forEach(e=>{t.rings.push(...e.rings)}),t}};(0,s._)([(0,p.MZ)({constructOnly:!0})],ie.prototype,"view",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],ie.prototype,"area",void 0),ie=(0,s._)([(0,f.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaOutlineItem")],ie);let ne=class extends i.A{constructor(e){super(e),this._volumes=new Map,this._elevationContext=new P.F,this._outlineMap=new o.A}initialize(){this.addHandles([(0,h.wB)(()=>this.polygons,e=>this._updateVolumes(e),h.pc)]),this._outlineMap=(0,l.L)(()=>this.areas?.areas,e=>new ie({area:e,view:this.view}),{recycleItems:!0})}destroy(){this.removeAllHandles(),this._outlineMap.destroy()}get areas(){return this.view.map?.focusAreas}get enabledAreas(){return this.areas?.areas.toArray().filter(e=>{let{enabled:t}=e;return t})??[]}get style(){return this.areas?.style??"bright"}get polygons(){return this.enabledAreas.reduce((e,t)=>e.concat(t.geometries.toArray()),new Array)}containsGeometry(e){if(0===this.polygons.length)return!0;const t=new v.A(e);return this.polygons.some(e=>e.contains(t))}_updateVolumes(e){this._extrude(e),this._ensureRenderNodes()}_extrude(e){if(!this.view.renderCoordsHelper||(0,n.aI)(Array.from(this._volumes.keys()),e))return;const t=this.view.renderCoordsHelper,r=(0,y.vt)(),s=t.viewingMode===E.RT.Global,i=(0,m.vt)(),o=(0,m.vt)(),l=this.view.spatialReference,u=(0,A.fromSpatialReference)(l),h=(0,g.tO)(l).radius/M.$O.radius,p=(0,d.UW)(5e5*h,"meters",l,!0);s||t.worldUpAtPosition([0,0,0],r);const f=new Map;for(const n of e){const e=this._volumes.get(n);if(e)f.set(n,e);else try{const e=l.equals(n.spatialReference)?n:(0,x.project)(n,l),a=Math.max(e.extent.width,e.extent.height),c=(0,d.PQ)(a,l,"meters",!0),m=Math.max(5*c,2e4*h),y=s?h/10:h,g=this._reduceGeometryHeight(e,m,y),v=(0,S.W$)(g);if(null==v)continue;const M=(0,A.fromPolygon)(g),E=(0,R.g7)(M,u,!1)??M,P=(0,w.g7)(E,p,0,0),V=(0,A.toPolygon)(P,l);if(null==V)continue;(0,b.l)(l,[v.x,v.y,0],i,t.spatialReference),o[12]=-i[12],o[13]=-i[13],o[14]=-i[14];const T=(0,Z.C8)(V,this.view.elevationProvider,t,this._elevationContext),{polygons:F,mapPositions:I,position:N}=T,j=new Array;for(const t of F){const e=t.count,n=(0,_.e)(t.mapPositions,t.holeIndices,3);if(0===n.length)continue;const a=n.length,c=6*e,l=c+a,u=(0,C.jh)(3*c),h=(0,O.my)(l),d=(0,O.my)(a);(0,D.K)(N,I,n,t,u,null,null,null,h,d,m,r,s),(0,G.t)(u,u,o);const p=new ee(u,d,h,m,[i[12],i[13],i[14]]);j.push(p)}f.set(n,j)}catch(v){c.A.getLogger(this).error(new a.A("focusareasview:projection-failed","Failed to project focus area geometry to view spatial reference",{geometry:n,error:v}))}}this._volumes=f,this._maskRenderNode?.updateGeometries()}_ensureRenderNodes(){this.view.stage&&(0===this.volumes.size?(this._maskRenderNode=(0,u.pR)(this._maskRenderNode),this._colorRenderNode=(0,u.pR)(this._colorRenderNode)):(this._maskRenderNode??=new J({focusAreasView:this}),this._colorRenderNode??=new H({focusAreasView:this}),this.view.stage.renderView.requestRender()))}_reduceGeometryHeight(e,t,r){const s=-12e5*r,i=Math.max(-t/2,s),n=e.rings.map(e=>e.map(e=>[e[0],e[1],i])),o=e.clone();return o.rings=n,o.hasZ=!0,o}get volumes(){return this._volumes}};(0,s._)([(0,p.MZ)()],ne.prototype,"_volumes",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],ne.prototype,"view",void 0),ne=(0,s._)([(0,f.$)("esri.views.3d.FocusAreasView")],ne)},99785:(e,t,r)=>{r.d(t,{Wq:()=>s,lO:()=>d,oR:()=>p});var s,i,n=r(38983),o=r(5568),a=r(5262),c=r(44815),l=r(38496),u=r(10294),h=r(77176);function d(e){const t=p(e.rings,e.hasZ,s.CCW_IS_HOLE,e.spatialReference),r=new Array;let i=0,o=0;for(const s of t.polygons){const e=s.count,a=s.index,u=(0,c.l5)(t.position,3*a,3*e),h=s.holeIndices.map(e=>e-a),d=(0,l.uW)((0,n.e)(u,h,3));r.push({position:u,faces:d}),i+=u.length,o+=d.length}const a=function(e,t,r){if(1===e.length)return e[0];const s=(0,c.jh)(t),i=new Array(r);let n=0,o=0,a=0;for(const c of e){for(let e=0;e<c.position.length;e++)s[n++]=c.position[e];for(const e of c.faces)i[o++]=e+a;a=n/3}return{position:s,faces:(0,l.uW)(i)}}(r,i,o),u=Array.isArray(a.position)?(0,h.b)(a.position,3,{originalIndices:a.faces}):(0,h.b)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,c.xm)(new Float64Array(u.buffer)),a.faces=u.indices,a}function p(e,t,r,i){const n=e.length,o=new Array(n),a=new Array(n),l=new Array(n);let u=0;for(let s=0;s<n;++s)u+=e[s].length;let h=0,d=0,p=0;const m=(0,c.jh)(3*u);let y=0;for(let c=n-1;c>=0;c--){const u=e[c],g=r===s.CCW_IS_HOLE&&_(u,t,i);if(g&&1!==n)o[h++]=u;else{let e=u.length;for(let t=0;t<h;++t)e+=o[t].length;const r={index:y,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};r.pathLengths[0]=u.length,u.length>0&&(l[p++]={index:y,count:u.length}),y=g?f(u,u.length-1,-1,m,y,u.length,t):f(u,0,1,m,y,u.length,t);for(let s=0;s<h;++s){const e=o[s];r.holeIndices[s]=y,r.pathLengths[s+1]=e.length,e.length>0&&(l[p++]={index:y,count:e.length}),y=f(e,0,1,m,y,e.length,t)}h=0,r.count>0&&(a[d++]=r)}}for(let s=0;s<h;++s){const e=o[s];e.length>0&&(l[p++]={index:y,count:e.length}),y=f(e,0,1,m,y,e.length,t)}return a.length=d,l.length=p,{position:m,polygons:a,outlines:l}}function f(e,t,r,s,i,n,o){i*=3;for(let a=0;a<n;++a){const n=e[t];s[i++]=n[0],s[i++]=n[1],s[i++]=o&&n[2]?n[2]:0,t+=r}return i/3}function _(e,t,r){if(!t)return!(0,a.$3)(e);const s=e.length-1;switch((0,u.S)(e,s,r)){case o._.X:return!(0,a.$3)(e,o._.Y,o._.Z);case o._.Y:return!(0,a.$3)(e,o._.X,o._.Z);case o._.Z:return!(0,a.$3)(e,o._.X,o._.Y)}}(i=s||(s={}))[i.NONE=0]="NONE",i[i.CCW_IS_HOLE=1]="CCW_IS_HOLE"}}]);
//# sourceMappingURL=53154.e44377f6.chunk.js.map