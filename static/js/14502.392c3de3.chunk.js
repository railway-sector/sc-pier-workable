"use strict";(self.webpackChunksc_pier_workable=self.webpackChunksc_pier_workable||[]).push([[14502],{14502:(e,r,t)=>{t.d(r,{Feature3DPipeline:()=>Z});var n=t(6326),s=t(50076),i=t(54901),a=t(30726),o=t(91291),d=t(68134),l=t(46053),u=(t(81806),t(76460),t(47249),t(87990)),c=t(14672),h=t(12016),p=t(76797),y=t(2413),g=t(37875),f=t(80424),m=t(77725),w=t(49296),_=t(54662);let v=class extends o.Z{constructor(e){super(e),this.schedule=null,this._workerUpdating=!0}get updating(){return this._workerUpdating}get _graphicOrigin(){const e=this.layer.graphicOrigin;if(!(0,g.v)(e))throw new s.A("featurelayerview3d:invalid-graphic-origin","Layer's graphic origin is not a FeatureGraphicOrigin");return e}initialize(){const{layer:e,layerView:r,viewSpatialReference:t,renderSpatialReference:n}=this,s=e.elevationInfo;this._elevationContext=w.F.fromElevationInfo(s),this._workerHandle=new R(this.schedule,{createTexture:async e=>{let{data:r,parameters:t}=e;return{result:await this.renderer.createTexture(r,t),transferList:[]}},releaseTexture:async e=>{let{uid:r}=e;return await this.renderer.releaseTexture(r),I},createMaterial:async e=>{let{materialJSON:r}=e;return await this.renderer.createMaterial(r),I},destroyMaterial:async e=>{let{materialId:r}=e;return await this.renderer.destroyMaterial(r),I},createDirectRenderer:async e=>{let{materialId:r}=e;return await this.renderer.createDirectRenderer(r),I},destroyDirectRenderer:async e=>{let{materialId:r}=e;return await this.renderer.destroyDirectRenderer(r),I},createLoDRenderer:async(e,r)=>{let{rendererId:t,lodRenderGeometry:n}=e;return await this.renderer.createLoDRenderer(t,n,r?.signal??void 0),I},destroyLoDRenderer:async(e,r)=>{let{rendererId:t}=e;return await this.renderer.destroyLoDRenderer(t,r?.signal??void 0),I},dispatchRenderCommands:async e=>{let{commands:r}=e;return await this.renderer.executeRenderCommands(r),I},applyElevationAlignment:async e=>{let{mapPoints:r}=e;const{viewSpatialReference:t,elevationProvider:n,renderCoordsHelper:s}=this,i=(0,_.x)(r,t,this._elevationContext,n,s);return{result:i,transferList:[i.buffer]}},setBaseInstance:async e=>{let{rendererId:r,baseInstance:t}=e;return this.renderer.setBaseInstance(r,t),I}}),this.addResolvingPromise((async()=>{await e.load();const i={url:e.parsedUrl?.path??"",baseQuery:e.createQuery().toJSON(),objectIdField:e.objectIdField,capabilities:e.capabilities,fieldIndex:e.fieldsIndex.toJSON(),timeInfo:e.timeInfo?.toJSON(),elevationInfo:s?.toJSON(),fullExtent:e.fullExtent?.toJSON(),renderer:e.renderer?.toJSON()},a={fullOpacity:r.fullOpacity};await this._workerHandle.invokeMethod("setup",{viewSpatialReference:t.toJSON(),renderSpatialReference:n.toJSON(),viewingMode:this.viewingMode,layerInfo:i,layerViewInfo:a})})()),this.addHandles(this._workerHandle.on("notify-updating",e=>{let{updating:r}=e;this._workerUpdating=r}))}onTileTreeChange(e){this._workerHandle.invokeMethod("onTileTreeChange",{tiles:e.items.map(b)})}onElevationChange(e){this._workerHandle.invokeMethod("onElevationChange",{context:e.context,spatialReference:e.spatialReference?.toJSON(),extent:(0,y.o8)(e.extent)})}onLayerViewOpacityChange(e){this._workerHandle.invokeMethod("onLayerViewOpacityChange",e)}onRendererChange(e){const r=e?.toJSON();this._workerHandle.invokeMethod("onRendererChange",r)}async executeQuery(e,r){const t=await this._workerHandle.invokeMethod("executeQuery",e?.toJSON(),r),n=m.A.fromJSON(t);return this._ensureLayerOnFeatures(n),n}async executeQueryForIds(e,r){return await this._workerHandle.invokeMethod("executeQueryForIds",e?.toJSON(),r)}async executeQueryForCount(e,r){return await this._workerHandle.invokeMethod("executeQueryForCount",e?.toJSON(),r)}async executeQueryForExtent(e,r){const{count:t,extent:n}=await this._workerHandle.invokeMethod("executeQueryForExtent",e?.toJSON(),r);return{count:t,extent:p.A.fromJSON(n)}}async executeQueryForLatestObservations(e,r){const t=await this._workerHandle.invokeMethod("executeQueryForLatestObservations",e?.toJSON(),r),n=m.A.fromJSON(t);return this._ensureLayerOnFeatures(n),n}async executeAttributeBinsQuery(e,r){const t=await this._workerHandle.invokeMethod("executeAttributeBinsQuery",e.toJSON(),r);return f.A.fromJSON(t)}_ensureLayerOnFeatures(e){const{layer:r,_graphicOrigin:t}=this;for(const n of e.features)n.layer=r,n.sourceLayer=r,n.origin=t}};(0,n.Cg)([(0,l.MZ)()],v.prototype,"updating",null),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"schedule",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"layer",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"layerView",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"viewSpatialReference",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"renderSpatialReference",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"viewingMode",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"renderer",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"elevationProvider",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],v.prototype,"renderCoordsHelper",void 0),(0,n.Cg)([(0,l.MZ)()],v.prototype,"_workerUpdating",void 0),(0,n.Cg)([(0,l.MZ)()],v.prototype,"_graphicOrigin",null),v=(0,n.Cg)([(0,u.$)("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorkerHandle")],v);class R extends h.B{constructor(e,r){super("Feature3DPipelineWorker","setup",{},e,{strategy:"dedicated",client:r})}}function b(e){let{id:r,lij:t,extent:n}=e;return{id:r,lij:t,extent:n}}const I={result:void 0};var x=t(91967),C=t(50346),M=(t(9392),t(55855),t(90632)),F=t(57481),O=t(60586),k=t(50255),T=t(37046),V=t(69008),G=t(16699),H=t(84248),S=t(27207),E=t(9243);let L=class extends O.RW{constructor(e){super(e),this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._renderContext=null,this._drawParameters=new G.P,this._bufferWriter=null,this._baseInstance=null,this.slicePlaneEnabled=!1,this.isGround=!1,this.type=e.material instanceof H.R?1:4,this.layerViewUid=e.layerViewUid}get produces(){return this._produces}get numFeatures(){let e=0;return this._renderGeometries.forEach(r=>e+=r.numElements),e}get usedMemory(){let e=0;return this._renderGeometries.forEach(r=>{e+=r.vao.usedMemory}),e}intersect(e,r,t,n){const{material:s,_bufferWriter:i,layerViewUid:a,_renderGeometries:o}=this;null!=i.intersect&&o.forEach(r=>{let{buffer:o,localOrigin:d,items:l}=r;return i.intersect(o.data,s.parameters,d,e,t,n,(r,t,n,i)=>{if(!l.visibilities[n])return;const o=l.objectIds[n];e.handleObjectIntersection({object:{id:M.M,graphicUid:o,layerViewUid:a,boundingVolumeWorldSpace:new T.j,geometries:[{material:s}]},geometryId:0,primitiveIndex:n},r,t,null,i)})})}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach((e,r)=>{this._produces.set(r,r=>9!==r&&5!==r&&e(r))})}destroy(){this._glMaterials.dispose();const e=this._renderGeometries.keys();for(const r of e)this.removeRenderGeometryBuffer(r);this._baseInstance?.vbo.dispose(),this._baseInstance=null}acquireTechniques(e){const r=this.material;if(!r.shouldRender(e))return null;const{output:t,bind:n}=e,s=r.produces.get(n.slot);if(!s?.(t))return null;if(9===t||5===t)return null;const i=this._glMaterials.load(e.rctx,n.slot,t);return i?.beginSlot(n)}render(e,r){const t=this._renderGeometries;if(0===t.size)return;const{bind:n}=e,s=10===n.slot||11===n.slot?n.slot:null,i=e.rctx;i.runAppleAmdDriverHelper(),i.bindTechnique(r,n,this.material.parameters);const a=r.program,{_baseInstance:o}=this,d=null==o?e=>{i.drawArrays(r.primitiveType,e.start,e.count)}:(e,t)=>{(0,S.yu)(i,t.locations,t.buffer("instances"),e.start),i.drawArraysInstanced(r.primitiveType,0,o.buffer.elementCount,e.count)};for(const[l,u]of t){const{vao:e,localOrigin:t,drawCalls:o}=u;this._drawParameters.origin=t,a.bindDraw(n,this.material.parameters,this._drawParameters),r.ensureAttributeLocations(e),i.bindVAO(e),i.setPipelineState(r.getPipeline(!1,s));for(const r of o)d(r,e)}}initializeRenderContext(e){this._glMaterials=new k.c(this.material,e.materials),this._renderContext=e.renderContext}uninitializeRenderContext(){}addRenderGeometryBuffer(e,r,t,n){this.removeRenderGeometryBuffer(e);const{data:s,elementCount:i}=r,{_baseInstance:a,_bufferWriter:o,_renderContext:{rctx:d}}=this,l=null==a?o.layout:o.instanceLayout;if(!l)throw new Error("Cannot create instance buffer for non-instanced material");const u=new E.R(d,(0,F.U)(l,null==a?0:1),s);let c;c=new V.Z(d,null==a?new Map([["geometry",u]]):new Map([["geometry",a.vbo],["instances",u]]));const h={localOrigin:n,numElements:i,buffer:r,items:t,vao:c,drawCalls:this._produceDrawCalls(t)};this._renderGeometries.set(e,h)}updateRenderGeometryBuffer(e,r,t,n){const{data:s,elementCount:i}=r,a=this._renderGeometries.get(e);if(null==a)return;const o=a.vao.buffer(null==this._baseInstance?"geometry":"instances");o?.setSize(s.byteLength),o?.setSubData(new Uint8Array(s),0,0,s.byteLength),a.localOrigin=n,a.numElements=i,a.buffer=r,a.items=t,a.drawCalls=this._produceDrawCalls(t)}removeRenderGeometryBuffer(e){const r=this._renderGeometries.get(e);null!=r&&(this._baseInstance?(r.vao.buffer("instances")?.dispose(),r.vao.disposeVAOOnly()):r.vao.dispose(),this._renderGeometries.delete(e))}updateVisibility(e,r){const t=this._renderGeometries.get(e);if(null==t)return;const{items:n}=t;if(n.visibilities.length!==r.length)throw new Error("Unexpected mismatch between old and new visibility flag buffer length.");n.visibilities=r,t.drawCalls=this._produceDrawCalls(n)}setBaseInstance(e){if(this._baseInstance?.vbo.dispose(),null==e)return void(this._baseInstance=null);const{data:r}=e,t=new E.R(this._renderContext.rctx,(0,F.U)(this._bufferWriter.layout),r);this._baseInstance={buffer:e,vbo:t}}hasHighlight(){return!1}_produceDrawCalls(e){const{visibilities:r,ranges:t}=e,n=[];if(function(e){return"numItems"in e}(t)){if(0===t.numItems)return[];const e=t.numVertices;let s=null;for(let i=0;i<t.numItems;++i)r[i]?null==s?(s={start:i*e,count:e},n.push(s)):s.count+=e:s=null}else{const e=t.counts,s=e.length;if(0===s)return[];let i=null,a=0;for(let t=0;t<s;++t){const s=r[t],o=e[t];s?null==i?(i={start:a,count:o},n.push(i)):i.count+=o:i=null,a+=o}}return n}};(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],L.prototype,"material",void 0),L=(0,n.Cg)([(0,u.$)("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],L);var B=t(4375),D=t(12062);let A=class{constructor(e){this._instanceGroupToIndices=new Map,this._instanceIndexToFeatureId=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this._numFeatures=0,this.layerViewUid=e.layerViewUid,this.view=e.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}get numFeatures(){return this._numFeatures}get usedMemory(){const e=this._lodRendererResources?.lodRenderer,r=e?.symbol;return(r?.computeUsedMemory()??0)+16*this._instanceIndexToFeatureId.size}destroy(){this._disposeResourceHandles.forEach(e=>e())}async doLoad(e,r,t){const n=function(e,r){const t=r.levels.map(r=>{const t=r.components.map(r=>{const t=e(r.materialId);if(!function(e){return null!=e&&"materialType"in e&&"default"===e.materialType}(t))throw new Error("LodRenderer only supports DefaultMaterial");const n=new D.Rn(t,r.renderGeometryBuffer.data,r.renderGeometryBuffer.elementCount,r.boundingInfo);return new D.iC(n)});return new D.hr(t,r.minScreenSpaceRadius)});return new D.Fe(t)}(e=>r(e),e),s=this.view.stage,i=n.getMaterials(),a=n.getTextures();s.addTextures(a),this._addDisposeResource(()=>{a.forEach(e=>e.unload()),s.removeTextures(a)}),await Promise.all(a.map(e=>this.view.stage.schedule(()=>e.load(s.renderView.renderingContext),t))),(0,C.Te)(t);const o=await this._createLodRenderer(n,t);this._lodRendererResources={lodRenderer:o,materials:i,textures:a}}addInstances(e,r){const t=this._lodRendererResources;if(null==t)return;const n=t.lodRenderer;if(null==n)return;const{featureIds:s,localTransforms:i,globalTransforms:a,visibility:o}=r,d=new Array,l=n.instanceData,u=s.length,c=this._instanceIndexToFeatureId;for(let h=0;h<u;++h){const e=s[h],r=l.addInstance(),t=l.view,n=16*h;t.localTransform.copyFromTypedBuffer(r,i,n),t.globalTransform.copyFromTypedBuffer(r,a,n),l.updateModelTransform(r),l.setVisible(r,Boolean(o[h])),d.push(r),c.set(r,e)}this._instanceGroupToIndices.set(e,d),this._numFeatures+=u}removeInstances(e){const r=this._instanceGroupToIndices.get(e);if(null==r)return;const t=this._lodRendererResources;if(null==t)return;const n=t.lodRenderer.instanceData,s=this._instanceIndexToFeatureId;for(const i of r)n.removeInstance(i),s.delete(i);this._numFeatures-=r.length,this._instanceGroupToIndices.delete(e)}updateVisibility(e,r){const t=this._instanceGroupToIndices.get(e);if(null==t)return;const n=this._lodRendererResources;if(null==n)return;const s=t.length;if(s!==r.length)throw new Error("Unexpected mismatch instance count and visibility flag buffer length.");const i=n.lodRenderer.instanceData;for(let a=0;a<s;++a)i.setVisible(t[a],Boolean(r[a]))}updateGlobalTransforms(e,r){const t=this._instanceGroupToIndices.get(e);if(null==t)return;const n=this._lodRendererResources;if(null==n)return;const s=t.length;if(16*s!==r.length)throw new Error("Unexpected mismatch instance count and visibility flag buffer length.");const i=n.lodRenderer.instanceData,a=i.view;for(let o=0;o<s;++o){const e=t[o],n=16*o;a.globalTransform.copyFromTypedBuffer(e,r,n),i.updateModelTransform(e)}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createLodRenderer(e,r){const t=this.view.stage,n={layerViewUid:this.layerViewUid,graphicUid:e=>this._instanceIndexToFeatureId.get(e)??-1,notifyGraphicGeometryChanged:e=>1,notifyGraphicVisibilityChanged:e=>1},s=new B.L({symbol:e,metadata:n,shaderTransformation:null},this.scheduler);return s.slicePlaneEnabled=!1,this._addDisposeResource(()=>{t.removeRenderPlugin(s),s.destroy()}),await t.addRenderPlugin(s,r),s}};A=(0,n.Cg)([(0,u.$)("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],A);var U=t(96897),P=t(61895);t(78992);let N=class extends x.A{constructor(e){super(),this.view=null,this.layerViewUid=null,this._stage=null,this._materials=new Map,this._textures=new Map,this._directRenderers=new Map,this._lodRenderers=new Map,this.totalFeatures=0,this.view=e.view,this.layerViewUid=e.layerViewUid}initialize(){this._stage=this.view.stage}destroy(){this.removeAllHandles(),this._lodRenderers.forEach(e=>e.destroy())}async createTexture(e,r){const{_textures:t,_stage:n}=this,s=new U.g(e,r);return t.set(s.id,s),n&&(s.load(n.renderView.renderingContext),n.addTexture(s)),s.id}async releaseTexture(e){const{_textures:r,_stage:t}=this,n=r.get(e);n&&(t&&(n.unload(),t.removeTexture(n)),r.delete(e))}_destroyTexture(e){const{_textures:r,_stage:t}=this,n=r.get(e);n&&(t&&(n.unload(),t.removeTexture(n)),r.delete(e))}async createMaterial(e){const{view:r}=this,t=1===r.state.viewingMode;let n=null;switch(e.type){case"default":{const r=e.parameters,s=new P.$U(r,{spherical:t});s.setParameters({cullFace:s.transparent?0:2}),n=s;break}case"hud":{const r=e.parameters;n=new H.R(r,t)}}this._materials.set(e.materialId,n)}async destroyMaterial(e){this._materials.delete(e)}async updateMaterial(e){}async createDirectRenderer(e){if(this._directRenderers.has(e))return;const r=this._materials.get(e);if(null==r)throw new Error(`material not found ${e}`);const{view:t}=this,n=new L({material:r,layerViewUid:this.layerViewUid});this._directRenderers.set(e,n),t.stage.addRenderPlugin(n),t.stage.renderView.renderer.updateHasFlags()}setBaseInstance(e,r){const t=this._directRenderers.get(e);if(null==t)throw new Error(`renderer not found ${e}`);t.setBaseInstance(r)}async destroyDirectRenderer(e){const r=this._directRenderers.get(e);if(null==r)return;const t=this.view;t.stage.removeRenderPlugin(r),this._directRenderers.delete(e),t.stage.renderView.renderer.updateHasFlags()}async createLoDRenderer(e,r,t){const n=new A({view:this.view,layerViewUid:this.layerViewUid});if(await n.doLoad(r,e=>this._materials.get(e),t),t?.aborted)throw n.destroy(),(0,C.NK)();this._lodRenderers.set(e,n)}async destroyLoDRenderer(e,r){const t=this._lodRenderers.get(e);null!=t&&(t.destroy(),this._lodRenderers.delete(e))}_destroyLodRenderer(e){let{rendererId:r}=e;const t=this._lodRenderers.get(r);null!=t&&(t.destroy(),this._lodRenderers.delete(r))}async executeRenderCommands(e){for(const r of e)switch(r.id){case"destroy-texture":this._destroyTexture(r.textureId);break;case"update-material":this._updateMaterial(r);break;case"destroy-material":this._destroyMaterial(r);break;case"add-direct-renderer-geometry-buffer":this._addDirectRendererGeometryBuffer(r);break;case"update-direct-renderer-geometry-buffer":this._updateDirectRendererGeometryBuffer(r);break;case"remove-direct-renderer-geometry-buffer":this._removeDirectRendererGeometryBuffer(r);break;case"destroy-lod-renderer":this._destroyLodRenderer(r);break;case"add-lod-instances":this._addLodInstances(r);break;case"remove-lod-instances":this._removeLodInstances(r);break;case"update-lod-instance-data":this._updateLodInstanceData(r);break;case"update-visibility":this._updateVisibility(r)}e.length>0&&this._updateFeatureCount()}_updateFeatureCount(){let e=0;for(const r of this._directRenderers.values())e+=r.numFeatures;for(const r of this._lodRenderers.values())e+=r.numFeatures;this._set("totalFeatures",e)}get usedMemory(){let e=0;for(const r of this._directRenderers.values())e+=r.usedMemory;for(const r of this._lodRenderers.values())e+=r.usedMemory;return e}_updateMaterial(e){let{materialId:r,parameters:t}=e;const n=this._materials.get(r);null!=n?n.setParameters(t):console.error("material not found")}_destroyMaterial(e){let{materialId:r}=e;null!=this._materials.get(r)?this._materials.delete(r):console.error("material not found")}_addDirectRendererGeometryBuffer(e){let{groupId:r,rendererId:t,renderGeometryBuffer:n,renderGeometryBufferItems:s,localOrigin:i}=e;const a=this._directRenderers.get(t);null!=a?(a.addRenderGeometryBuffer(r,n,s,i),this.view.stage.renderView.requestRender()):console.error("no renderer assigned to provided material")}_updateDirectRendererGeometryBuffer(e){let{groupId:r,rendererId:t,renderGeometryBuffer:n,renderGeometryBufferItems:s,localOrigin:i}=e;const a=this._directRenderers.get(t);null!=a?(a.updateRenderGeometryBuffer(r,n,s,i),this.view.stage.renderView.requestRender()):console.error("no renderer assigned to provided material")}_removeDirectRendererGeometryBuffer(e){let{groupId:r,rendererId:t}=e;const n=this._directRenderers.get(t);null!=n?(n.removeRenderGeometryBuffer(r),this.view.stage.renderView.requestRender()):console.error("no renderer assigned to provided material")}_addLodInstances(e){let{rendererId:r,groupId:t,data:n}=e;const s=this._lodRenderers.get(r);if(null==s)throw new Error("no lod renderer assigned to provided lod renderer Id");s.addInstances(t,n),this.view.stage.renderView.requestRender()}_removeLodInstances(e){let{rendererId:r,groupId:t}=e;const n=this._lodRenderers.get(r);if(null==n)throw new Error("no lod renderer assigned to provided lod renderer Id");n.removeInstances(t),this.view.stage.renderView.requestRender()}_updateLodInstanceData(e){let{rendererId:r,groupId:t,globalTransforms:n}=e;const s=this._lodRenderers.get(r);if(null==s)throw new Error("No renderer found with the provided id");null!=n&&s.updateGlobalTransforms(t,n),this.view.stage.renderView.requestRender()}_updateVisibility(e){let{rendererId:r,groupId:t,visibility:n}=e;const s=this._directRenderers.get(r)??this._lodRenderers.get(r);if(null==s)throw new Error("No renderer found with the provided id");s.updateVisibility(t,n),this.view.stage.renderView.requestRender()}};(0,n.Cg)([(0,l.MZ)({readOnly:!0})],N.prototype,"totalFeatures",void 0),N=(0,n.Cg)([(0,u.$)("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],N);var Q=t(42123),J=t(65768);let Z=class extends o.Z{constructor(e){super(e),this._renderer=null,this.graphicsQuery={queryForSymbologySnapping:(e,r)=>{throw new s.A("featurelayer:unsupported-symbology-snapping","Symbology snapping not supported")},executeQuery:async(e,r)=>await this._workerHandle.executeQuery(e,r),executeQueryForIds:async(e,r)=>await this._workerHandle.executeQueryForIds(e,r),executeQueryForCount:async(e,r)=>await this._workerHandle.executeQueryForCount(e,r),executeQueryForExtent:async(e,r)=>await this._workerHandle.executeQueryForExtent(e,r),executeQueryForLatestObservations:async(e,r)=>await this._workerHandle.executeQueryForLatestObservations(e,r),executeAttributeBinsQuery:async(e,r)=>this._workerHandle.executeAttributeBinsQuery(e,r)},this.maximumNumberOfFeatures=1e3}initialize(){if("point"!==this.layerView.layer.geometryType)throw new s.A("featurelayer:unsupported-geometry-type",`${this.layerView.layer.geometryType} is not supported`);this.addResolvingPromise(this.setup())}destroy(){this.removeAllHandles(),this._workerHandle.destroy(),(0,a.pR)(this._renderer)}async setup(){const e=this.layerView,{layer:r,view:t,uid:n}=e,{spatialReference:i,renderSpatialReference:a,resourceController:o,renderCoordsHelper:l,elevationProvider:u}=t,c=t.state.viewingMode;if(this._renderer=new N({view:t,layerViewUid:n}),"feature"!==r.type)throw new s.A("featurelayer:unsupported-layertype","Only FeatureLayer is supported");const h=new v({schedule:e=>o.immediate.schedule(e),layer:r,layerView:e,viewSpatialReference:i,renderSpatialReference:a,viewingMode:c,renderer:this._renderer,elevationProvider:u,renderCoordsHelper:l});this._workerHandle=await h.when(),this.addHandles([this.layerView.view.enableFeatureTiles(),(0,d.on)(()=>this.layerView.view.featureTiles?.tiles,"change",e=>{this._workerHandle.onTileTreeChange(e.target)},{onListenerAdd:e=>this._workerHandle.onTileTreeChange(e),onListenerRemove:e=>this._workerHandle.onTileTreeChange(e)}),t.elevationProvider.on("elevation-change",e=>this._workerHandle.onElevationChange(e)),(0,d.wB)(()=>this.layerView.fullOpacity,e=>this._workerHandle.onLayerViewOpacityChange(e),{sync:!1}),(0,d.wB)(()=>r.renderer,e=>this._workerHandle.onRendererChange(e),{sync:!1})])}get legendEnabled(){return!1}get hasAllFeatures(){return!1}get hasAllFeaturesInView(){return!1}get hasFullGeometries(){return!1}get symbologySnappingSupported(){return!1}get scaleVisibilitySuspended(){return!1}get snappingComplexityExceeded(){return!1}get suspendInfo(){return{}}get updating(){return this._workerHandle.updating}get dataUpdating(){return!1}get updatePolicy(){return 0}get maximumNumberOfFeaturesExceeded(){return!1}get updatingProgressValue(){return 1}get usedMemory(){return this._renderer?.usedMemory??0}get unloadedMemory(){return 0}get ignoresMemoryFactor(){return!0}get totalFeatures(){return this._renderer?.totalFeatures??0}get performanceInfo(){const e=this.totalFeatures;return new c.X(new J.P(this.usedMemory,e,e,this.maximumNumberOfFeatures,0,null),e,e,this.maximumNumberOfFeaturesExceeded,"tiles","n/a")}get suspendResumeExtentMode(){return"computed"}forEachGraphic(e){}findGraphic(e){return null}highlightByObjectIds(e,r){return Q.Wg}highlightByGraphics(e,r){return Q.Wg}maskOccludee(e){return(0,i.hA)()}async whenGraphicBounds(e,r){return null}computeAttachmentOrigin(e,r){return null}elevationAlignPointsInFeatures(e,r){throw new s.A("featurelayer:unsupported-elevation-alignment","Elevation alignment not supported")}async doRefresh(e){}setVisibility(e,r){}getMissingAttributesForFeature(e){return null}getHydratedGeometry(e){return null}};(0,n.Cg)([(0,l.MZ)()],Z.prototype,"layerView",void 0),(0,n.Cg)([(0,l.MZ)()],Z.prototype,"updating",null),(0,n.Cg)([(0,l.MZ)()],Z.prototype,"totalFeatures",null),Z=(0,n.Cg)([(0,u.$)("esri.views.3d.layers.graphics.pipeline.Feature3DPipeline")],Z)},54662:(e,r,t)=>{t.d(r,{$:()=>i,x:()=>a});var n=t(90632),s=t(482);function i(){return`${arguments.length>0&&void 0!==arguments[0]?arguments[0]:""}${(0,n.c)()}`}function a(e,r,t,n,i){const a=n.spatialReference,d=(0,s.jd)(r,a);if(null==d)return e;let l=r=>[e[r],e[r+1],e[r+2]];d!==s.pO&&(l=r=>(d(e,r,o,0),[o[0],o[1],o[2]]));const u=e.length/3,c=t.mode;switch(t.mode){case"on-the-ground":for(let r=0;r<u;++r){const t=3*r,[s,i]=l(t);e[t+2]=n.getElevation(s,i,0,n.spatialReference,"ground")??0}break;case"relative-to-ground":case"relative-to-scene":{const r="relative-to-ground"===c?"ground":"scene";for(let s=0;s<u;++s){const a=3*s,[o,d,u]=l(a),c=t.calculateOffsetRenderUnits(i),h=n.getElevation(o,d,0,n.spatialReference,r)??0;e[a+2]=u+c+h}}break;case"absolute-height":for(let r=0;r<u;++r){const n=3*r,s=e[n+2],a=t.calculateOffsetRenderUnits(i);e[n+2]=s+a}}return e}const o=new Float64Array(3)}}]);
//# sourceMappingURL=14502.392c3de3.chunk.js.map