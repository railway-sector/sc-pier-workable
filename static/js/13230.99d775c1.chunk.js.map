{"version":3,"file":"static/js/13230.99d775c1.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/3d/layers/support/SublayerPopupHighlightHelper3D.js","../node_modules/@arcgis/core/views/3d/layers/support/ImageHighlightHelper3D.js","../node_modules/@arcgis/core/views/3d/layers/MapImageLayerView3D.js","../node_modules/@arcgis/core/layers/support/timeSupport.js","../node_modules/@arcgis/core/support/timeUtils.js","../node_modules/@arcgis/core/views/layers/MapImageLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/Accessor.js\";import{destroyHandle as r}from\"../../../../core/handleUtils.js\";import{when as t,watch as s,initial as p,syncAndInitial as o}from\"../../../../core/reactiveUtils.js\";import{property as h}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{ImageHighlightHelper3D as l}from\"./ImageHighlightHelper3D.js\";import{MapServiceLayerViewHelper as c}from\"../../../layers/support/MapServiceLayerViewHelper.js\";import{createQueryGeometry as g}from\"../../../support/drapedUtils.js\";let d=class extends i{constructor(e){super(e)}initialize(){this._highlightHelper=new l({layer:this.layerView.layer,view:this.view,updatingHandles:this.updatingHandles}),this._mapServiceLayerViewHelper=new c({createFetchPopupFeaturesQueryGeometry:(e,i)=>g(e,i,this.view),layerView:this.layerView,updatingHandles:this.updatingHandles,highlightGraphics:this._highlightHelper.graphics,highlightGraphicUpdated:e=>this._highlightHelper.graphicsView?.graphicChanged(e)}),this.addHandles([r(this._mapServiceLayerViewHelper),t((()=>this.view?.stationary),(()=>this._mapServiceLayerViewHelper.updateHighlightedFeatures(this.view.resolution)),p),s((()=>this.layerView.suspended),(e=>this._highlightHelper.suspended=e),o)])}fetchPopupFeaturesAtLocation(e,i){return this._highlightHelper.preload(),this._mapServiceLayerViewHelper.fetchPopupFeaturesAtLocation(e,i)}highlight(e,i){return this._highlightHelper.highlight(e,i)}};e([h()],d.prototype,\"view\",void 0),e([h()],d.prototype,\"layerView\",void 0),e([h()],d.prototype,\"updatingHandles\",void 0),d=e([a(\"esri.views.3d.layers.support.SublayerPopupHighlightHelper3D\")],d);export{d as SublayerPopupHighlightHelper3D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Color.js\";import i from\"../../../../core/Accessor.js\";import{isSome as s}from\"../../../../core/arrayUtils.js\";import{makeHandle as r,destroyHandle as o}from\"../../../../core/handleUtils.js\";import{watch as h,syncAndInitial as p}from\"../../../../core/reactiveUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{initializeProjection as c,project as n}from\"../../../../geometry/projectionUtils.js\";import{GraphicsCollection as g}from\"../../../../support/GraphicsCollection.js\";import m from\"../../../../symbols/SimpleFillSymbol.js\";import u from\"../../../../symbols/SimpleLineSymbol.js\";import d from\"../../../../symbols/SimpleMarkerSymbol.js\";import{getHighlightGraphics as y}from\"../../../layers/support/highlightUtils.js\";let w=class extends i{get updating(){return this.graphicsView?.updating??!1}constructor(t){super(t),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new g,this.graphicsView=null,this.suspended=!1;const i=new e([255,255,255,1/255]);this._symbols=new Map([[\"point\",new d({size:\"2px\",style:\"square\",color:i})],[\"polyline\",new u({width:\"2px\",color:i})],[\"polygon\",new m({outline:null,color:i})]])}highlight(t,e){const i=y(t);if(0===i.length)return r();let s,o=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then((([t,i])=>{!o&&i&&(s=this._addHighlightGraphics(i,t,e))}))),r((()=>{o=!0,s?.remove()}))}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(t,e,i){for(const r of e)this._highlightCounts.set(r,(this._highlightCounts.get(r)??0)+1);this.graphics.addMany(e);const s=t.highlight(e,i);return r((()=>{this._removeHighlightGraphics(e),s.remove()}))}_removeHighlightGraphics(t){this.graphics.removeMany(t.filter((t=>{const e=Math.max(0,(this._highlightCounts.get(t)??0)-1);return 0===e?(this._highlightCounts.delete(t),!0):(this._highlightCounts.set(t,e),!1)})))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=import(\"../GraphicsView3D.js\"));const{default:t}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new t({view:this.view,layer:this.layer,getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set(\"graphicsView\",e),this.addHandles([o(this.graphicsView),h((()=>this.suspended),(t=>{e.suspended=t}),p)]),e}async _createHighlightGraphics(t){const e=t.map((({geometry:t})=>t?.spatialReference)).filter(s).reduce(((t,e)=>(0!==t.length&&t.at(-1)?.equals(e)||t.push(e),t)),[]),i=this.view.spatialReference,r=e.map((t=>({source:t,dest:i})));try{await c(r)}catch{return[]}return t.map((t=>{const{geometry:e}=t;try{const s=e?n(e,i):null,r=t.cloneShallow();return r.geometry=s,r.symbol=this._symbols.get(s?.type),r}catch{return t}}))}};t([a()],w.prototype,\"graphics\",void 0),t([a()],w.prototype,\"graphicsView\",void 0),t([a()],w.prototype,\"view\",void 0),t([a()],w.prototype,\"layer\",void 0),t([a()],w.prototype,\"updatingHandles\",void 0),t([a()],w.prototype,\"suspended\",void 0),t([a()],w.prototype,\"updating\",null),w=t([l(\"esri.views.3d.layers.support.ImageHighlightHelper3D\")],w);export{w as ImageHighlightHelper3D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{destroyHandle as t}from\"../../../core/handleUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import\"../../../core/Error.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"./DynamicLayerView3D.js\";import{SublayerPopupHighlightHelper3D as s}from\"./support/SublayerPopupHighlightHelper3D.js\";import o from\"../../layers/MapImageLayerView.js\";let p=class extends(o(r)){constructor(){super(...arguments),this.type=\"map-image-3d\"}initialize(){this._updatingHandles.add((()=>this.exportImageVersion),(()=>this._updatingHandles.addPromise(this.refreshDebounced()))),this._popupHighlightHelper=new s({view:this.view,layerView:this,updatingHandles:this._updatingHandles}),this.addHandles(t(this._popupHighlightHelper))}fetchPopupFeaturesAtLocation(e,t){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,t)}highlight(e,t){return this._popupHighlightHelper.highlight(e,t)}getFetchOptions(){return{timeExtent:this.timeExtent}}};p=e([i(\"esri.views.3d.layers.MapImageLayerView3D\")],p);const a=p;export{a as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{toLocalTimeExtent as e,toUTCTimeExtent as t}from\"../../support/timeUtils.js\";function i(i,n,s){if(null==i?.timeInfo)return null;const{datesInUnknownTimezone:l=!1,timeOffset:o,useViewTime:m}=i;let u=i.timeExtent;l&&(u=e(u));let r=m?n&&u?n.intersection(u):n||u:u;return!r||r.isEmpty||r.isAllTime?r:(o&&(r=r.offset(-o.value,o.unit)),l&&(r=t(r)),r.equals(s)?s:r)}export{i as combineTimeExtent};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../core/arrayUtils.js\";import{clone as e}from\"../core/lang.js\";import{offsetDate as n}from\"../core/timeUtils.js\";import{T as i}from\"../chunks/TimeExtent.js\";import{isWebMap as r}from\"../webmap/utils.js\";import{isWebScene as l}from\"../webscene/utils.js\";function s(t){return void 0!==t.timeInfo}async function u(t,e){return t.widgets?.timeSlider?.fullTimeExtent??a(t.allLayers,e)}function o(t){const e=t.numThumbs??2,n=t.currentTimeExtent;if(n){const{start:t,end:i}=n;return null!=t&&null!=i&&t.getTime()===i.getTime()?\"instant\":2===e?\"time-window\":null==t||0===t.getTime()?\"cumulative-from-start\":\"cumulative-from-end\"}return 2===e?\"time-window\":\"cumulative-from-start\"}function m(t){const{numStops:n,stopInterval:i,stops:r}=t;return r?{dates:e(r)}:i?{interval:i.clone()}:{count:n??5}}async function a(e,n){if(0===e.length)return i.allTime;await Promise.all(e.map((t=>t.load({signal:n}))));const r=e.filter(s),l=e.filter((t=>!s(t)&&null!=t.visibilityTimeExtent));if(0===r.length&&0===l.length)return i.allTime;const u=[],o=[];for(const t of r)\"feature\"!==t?.type&&\"map-image\"!==t?.type||!t.timeInfo?.hasLiveData?o.push(t):u.push(t);const m=t=>null==t||t.isAllTime,a=[...o.map((t=>{const e=t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=t;return e?.intersection(n)??n})),...l.map((t=>t.visibilityTimeExtent))];if(a.some(m))return i.allTime;const f=u.map((async t=>{const e=(await t.fetchRecomputedExtents({signal:n}))?.timeExtent??t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=t;return e?.intersection(i)??i})),c=(await Promise.allSettled(f)).map((t=>\"fulfilled\"===t.status?t.value:null));if(c.some(m))return i.allTime;const d=[...c,...a].filter(t);if(0===d.length)return i.allTime;return d.reduce(((t,e)=>t.union(e)))}function f(t,e){const n=t.currentTimeExtent;if(!n)return null;const{start:r,end:l}=n,s=r??l??null;switch(e){case\"time-window\":return new i({start:r,end:l});case\"cumulative-from-start\":return new i({start:null,end:s});case\"cumulative-from-end\":return new i({start:s,end:null});case\"instant\":return new i({start:s,end:s})}}async function c(t,e){if(!r(t)&&!l(t))return null;await t.load({signal:e});const n=t?.widgets?.timeSlider;if(!n)return null;const i=await u(t,e),s=n.loop,a=o(n);return{fullTimeExtent:i,loop:s,mode:a,playRate:n.stopDelay??2e3,stops:m(n),timeExtent:f(n,a)}}function d(t){if(!t)return t;const{start:e,end:r}=t;return new i({start:null!=e?n(e,-e.getTimezoneOffset(),\"minutes\"):e,end:null!=r?n(r,-r.getTimezoneOffset(),\"minutes\"):r})}function p(t){if(!t)return t;const{start:e,end:r}=t;return new i({start:null!=e?n(e,e.getTimezoneOffset(),\"minutes\"):e,end:null!=r?n(r,r.getTimezoneOffset(),\"minutes\"):r})}export{a as getTimeExtentFromLayers,c as getTimeSliderSettingsFromWebDocument,p as toLocalTimeExtent,d as toUTCTimeExtent};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import{ExportImageParameters as o}from\"../../layers/support/ExportImageParameters.js\";import{combineTimeExtent as s}from\"../../layers/support/timeSupport.js\";const i=i=>{let p=class extends i{initialize(){this.exportImageParameters=new o({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),this.commitProperty(\"floors\"),(this._get(\"exportImageVersion\")||0)+1}get timeExtent(){return s(this.layer,this.view?.timeExtent,this._get(\"timeExtent\"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e([t()],p.prototype,\"exportImageParameters\",void 0),e([t({readOnly:!0})],p.prototype,\"floors\",null),e([t({readOnly:!0})],p.prototype,\"exportImageVersion\",null),e([t()],p.prototype,\"layer\",void 0),e([t()],p.prototype,\"suspended\",void 0),e([t({readOnly:!0})],p.prototype,\"timeExtent\",null),p=e([r(\"esri.views.layers.MapImageLayerView\")],p),p};export{i as default};\n"],"names":["d","i","constructor","e","super","initialize","this","_highlightHelper","l","layer","layerView","view","updatingHandles","_mapServiceLayerViewHelper","c","createFetchPopupFeaturesQueryGeometry","g","highlightGraphics","graphics","highlightGraphicUpdated","graphicsView","graphicChanged","addHandles","r","t","stationary","updateHighlightedFeatures","resolution","p","s","suspended","o","fetchPopupFeaturesAtLocation","preload","highlight","h","prototype","a","w","updating","_highlightCounts","Map","_graphicsViewLoader","_symbols","size","style","color","u","width","m","outline","y","length","addPromise","Promise","all","_createHighlightGraphics","_ensureGraphicsView3D","then","_ref","_addHighlightGraphics","remove","set","get","addMany","_removeHighlightGraphics","removeMany","filter","Math","max","delete","default","destroyed","getGraphics","drapeSourcePriorityOffset","_set","map","_ref2","geometry","spatialReference","reduce","at","equals","push","source","dest","n","cloneShallow","symbol","type","arguments","_updatingHandles","add","exportImageVersion","refreshDebounced","_popupHighlightHelper","getFetchOptions","timeExtent","timeInfo","datesInUnknownTimezone","timeOffset","useViewTime","start","end","getTimezoneOffset","intersection","isEmpty","isAllTime","offset","value","unit","exportImageParameters","destroy","floors","commitProperty","_get","canResume","readOnly"],"sourceRoot":""}