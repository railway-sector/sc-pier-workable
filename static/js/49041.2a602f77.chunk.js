"use strict";(self.webpackChunksc_pier_workable=self.webpackChunksc_pier_workable||[]).push([[49041],{2144:(e,t,i)=>{i.d(t,{b:()=>a});var r=i(18690),s=i(54901),o=i(50346),n=i(75540);class a{constructor(){this._currentOperationSignal=(0,n.v)(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(e,t,i){const n=this._currentOperationSignal.value;n?.stop();const a=new AbortController,l=i?.signal,c=AbortSignal.any([a.signal,l].filter(r.Ru)),h=(0,o.Tw)();let u=!1;const d=()=>{u||(u=!0,h.reject((0,o.NK)()))},p={type:e,resolve:e=>{u||(u=!0,h.resolve(e))},reject:d,promise:h.promise,stop:()=>a.abort(),handles:[]};this._currentOperationSignal.value=p,p.handles.push((0,o.u7)(l,()=>{a.abort()}),(0,o.u7)(c,()=>{(0,s.a0)(p.handles),u||d()}));try{return n&&(await n.promise.catch(()=>{}),(0,o.Te)(c)),await t(p,c),await h.promise}finally{(0,s.a0)(p.handles),this._currentOperationSignal.value===p&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}}},2522:(e,t,i)=>{i.d(t,{P:()=>n});var r=i(6326),s=(i(76460),i(81806),i(47249),i(50076),i(87990)),o=i(49853);let n=class extends o.a{};n=(0,r.Cg)([(0,s.$)("esri.views.3d.analysis.AnalysisView3D")],n)},5512:(e,t,i)=>{i.d(t,{Am:()=>P,Gk:()=>f,Ku:()=>x,S3:()=>C,fL:()=>V,em:()=>S,LJ:()=>b,Y3:()=>w,dy:()=>R,qP:()=>M,fr:()=>v,Hw:()=>A,uf:()=>F});var r=i(24648),s=i(69077),o=i(6326),n=i(91967),a=i(49723),l=i(46053),c=(i(81806),i(76460),i(47249),i(87990));let h=class extends n.A{constructor(e){super(e),this.actual=null,this.lockable=!0,this.id=(0,a.lk)(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(e){this.lockable&&this._set("committed",e)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(e){this.inputValue=e,this.invalid=!1}onCommit(e,t,i){this.lockable?this._onCommitLockable(e,i):this._onCommitNonLockable(i),this.invalid&&"commit-and-exit"===e||i.onCommit(t,e)}_onCommitLockable(e,t){const{inputValue:i,locked:r}=this;r&&u(i)?this.unlock():("commit-and-exit"===e&&!r||null!=i)&&this._parseInputAndLock(t)}_onCommitNonLockable(e){const{inputValue:t}=this;u(t)?this.lockable?this.setActual(null):this.clearInputValue():null!=t&&this._parseInputAndSetActual(e)}applyValue(e){this.lockable?this.lock(e):this.setActual(e)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(e){this.actual=e,this.clearInputValue()}lock(e){this.lockable&&(this.committed=e??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(e){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(e))}getSuffix(e){const{suffix:t}=this;return"function"==typeof t?t(e):t}getFormattedValue(e){const{actual:t,committed:i,format:r}=this;return null!=i?r(i,e):null!=t?r(t,e):null}getRawDisplayValue(e){const{actual:t,committed:i,inputValue:r}=this;return null!=r?r:this.lockable&&null!=i?this.formatForInputMode(i,e):null!=t?this.formatForInputMode(t,e):null}_parseInputAndSetActual(e){const{inputValue:t}=this;if(null==t||u(t))return this.setActual(null);const i=this.parse(t,e);null!=i?this.setActual(i):this.invalid=!0}_parseInputAndLock(e){const{inputValue:t,actual:i}=this;if(u(t))return this.unlock();if(null==t)return this.lock(i);const r=this.parse(t,e);null!=r?this.lock(r):this.invalid=!0}};function u(e){return null!=e&&""===e.trim()}(0,o.Cg)([(0,l.MZ)()],h.prototype,"actual",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"committed",null),(0,o.Cg)([(0,l.MZ)()],h.prototype,"dirty",null),(0,o.Cg)([(0,l.MZ)()],h.prototype,"format",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"formatForInputMode",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"lockable",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"locked",null),(0,o.Cg)([(0,l.MZ)()],h.prototype,"id",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"inputValue",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"name",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"parse",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"readOnly",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"suffix",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"title",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"visible",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"invalid",void 0),(0,o.Cg)([(0,l.MZ)()],h.prototype,"unlockOnVertexPlacement",void 0),h=(0,o.Cg)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipField")],h);let d=class extends h{constructor(e){super(e),this.showAsZ=!1}normalizeCtorArgs(e){const t=e=>e.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:r.r7,parse:(0,s.hw)({createQuantity:(e,i)=>(0,r.d_)(e,t(i))}),format:(e,t)=>t.formatters.verticalLength(e),formatForInputMode:(e,i)=>i.formatters.scalar((0,r.kM)(e,t(i))),suffix:e=>e.inputUnitInfos.verticalLength.abbreviation,title:e=>e.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...e}}};(0,o.Cg)([(0,l.MZ)()],d.prototype,"showAsZ",void 0),d=(0,o.Cg)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],d);var p=i(11113),g=i(89646);let m=class extends h{constructor(e){super(e),this.precision=1}normalizeCtorArgs(e){return{name:"orientation",actual:null,parse:(0,s.hw)({createQuantity:(e,t)=>(0,r.Wq)(e,(e=>e.inputUnitInfos.angle.unit)(t),"geographic"),sanitize:s.D5}),format:e=>{const t=(0,g.P1)(e);return(0,p.Nk)(t,"geographic",this.precision)},formatForInputMode:(e,t)=>{const i=(0,g.P1)(e);return t.formatters.scalar(i)},suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.orientation,...e}}};(0,o.Cg)([(0,l.MZ)()],m.prototype,"precision",void 0),m=(0,o.Cg)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],m);let _=class extends h{constructor(e){super(e),this.precision=null}normalizeCtorArgs(e){const t=e=>e.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:(0,s.hw)({createQuantity:(e,i)=>(0,r.d_)(e,t(i))}),format:(e,t)=>t.formatters.length(e),formatForInputMode:(e,i)=>i.formatters.scalar((0,r.kM)(e,t(i))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.size,...e}}};function f(e){const t=e=>e.inputUnitInfos.angle.unit,i=e=>e.sketchOptions.values.effectiveDirectionMode;return new h({name:"direction",actual:r.IV,parse:(0,s.hw)({createQuantity:(e,i)=>(0,r.Wq)(e,t(i),"geographic"),sanitize:s.D5}),format:(e,t)=>{const r=i(t),s=(0,g.jQ)(e,r);switch(r){case"absolute":return t.formatters.direction(s);case"relative":return t.formatters.directionRelative(s);case"relative-bilateral":return t.formatters.directionRelativeBilateral(s)}},formatForInputMode:(e,s)=>{const o=(0,g.jQ)(e,i(s));return s.formatters.scalar((0,r.kM)(o,t(s)))},suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>{const t=i(e),{absolute:r,relative:s}=e.messages.sketch.direction;switch(t){case"absolute":return r;case"relative":case"relative-bilateral":return s}},...e})}function y(e){const t=e=>e.inputUnitInfos.length.unit;return new h({name:"distance",actual:r.r7,parse:(0,s.hw)({createQuantity:(e,i)=>(0,r.d_)(Math.max(e,0),t(i))}),format:(e,t)=>t.formatters.length(e),formatForInputMode:(e,i)=>i.formatters.scalar((0,r.kM)(e,t(i))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.distance,...e})}function v(e){return y({format:(e,t)=>t.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0,...e})}function x(e){return y({...e})}function w(e){return y({...e,parse:(0,s.hw)({createQuantity:(e,t)=>(0,r.d_)(e,(e=>e.inputUnitInfos.length.unit)(t))}),format:(e,t)=>t.formatters.lengthRelative(e)})}function C(e){return new d(e)}function b(e){return new m(e)}function M(e){return new _(e)}function R(e){return G("scale",{name:"scale",actual:null,parse:(0,s.hw)({createQuantity:e=>(0,r.LF)(Math.abs(e))}),...e})}function P(e){const t=e=>e.inputUnitInfos.area.unit;return new h({name:"area",actual:r.iT,parse:(0,s.hw)({createQuantity:(e,i)=>(0,r.gT)(e,t(i))}),format:(e,t)=>t.formatters.area(e),formatForInputMode:(e,i)=>i.formatters.scalar((0,r.kM)(e,t(i))),suffix:e=>e.inputUnitInfos.area.abbreviation,title:e=>e.messages.sketch.area,readOnly:!0,...e})}function S(e){return new h({name:"x",actual:r.IV,parse:s.L5,format:(e,t)=>t.formatters.longitudeDecimalDegrees(e),formatForInputMode:e=>(0,s.zX)(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.longitude,...e})}function V(e){return new h({name:"y",actual:r.IV,parse:s.A3,format:(e,t)=>t.formatters.latitudeDecimalDegrees(e),formatForInputMode:e=>(0,s.oZ)(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.latitude,...e})}function A(e){return G("x",{name:"x",...e})}function F(e){return G("y",{name:"y",...e})}function G(e,t){return new h({actual:(0,r.LF)(0),parse:(0,s.hw)({createQuantity:e=>(0,r.LF)(e)}),format:(e,t)=>t.formatters.scalar(e),formatForInputMode:(e,t)=>t.formatters.scalar(e),title:t=>t.messages.sketch[e],...t})}(0,o.Cg)([(0,l.MZ)()],_.prototype,"precision",void 0),_=(0,o.Cg)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldSize")],_)},7947:(e,t,i)=>{i.d(t,{AA:()=>y,L2:()=>C,PW:()=>w,U0:()=>v,iv:()=>b,mg:()=>R,ov:()=>M,xk:()=>S,z7:()=>P});var r=i(76931),s=i(72745),o=i(20664),n=i(9392),a=i(19247),l=i(56611),c=i(13927),h=i(95925),u=i(96190),d=i(75762),p=i(12482),g=i(37431),m=i(96342),_=i(97974),f=i(17046);function y(e,t){return x(e,()=>t)}function v(e){return x(e,e=>e.plane)}function x(e,t){const i=(0,n.vt)(),s=(0,n.vt)();let o=!1;return n=>{const a=t(n);if("start"===n.action){const t=(0,r.WA)(n.screenStart,(0,r.PR)(d.oG.get())),s=(0,g.Z4)(e.state.camera,t,G);null!=s&&(o=(0,c.Ui)(a,s,i))}if(!o)return null;const l=(0,r.WA)(n.screenEnd,(0,r.PR)(d.oG.get())),h=(0,g.Z4)(e.state.camera,l,G);return null==h?null:(0,c.Ui)(a,h,s)?{...n,renderStart:i,renderEnd:s,plane:a,ray:h}:null}}function w(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=null;return a=>{if("start"===a.action&&(n=e.sceneIntersectionHelper.intersectElevationFromScreen((0,r.gs)(a.screenStart.x,a.screenStart.y),t,i,o),null!=n&&null!=s&&!(0,l.projectPoint)(n,n,s)))return null;if(null==n)return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen((0,r.gs)(a.screenEnd.x,a.screenEnd.y),t,i,o);return null==c||null!=s&&!(0,l.projectPoint)(c,c,s)?null:{...a,mapStart:n,mapEnd:c}}}(e,i,(0,p.id)(t,e,i),s,o)}function C(e,t,i,r){const s=i.toMap(e.screenStart);return null!=s?w(t,s,i.elevationInfo,r):null}function b(e,t,i){let r=null;const s=new f.rh;return s.next(y(e,function(e,t){const i=A,r=F,s=(0,c.vt)();e.renderCoordsHelper.worldUpAtPosition(t,i);const n=(0,o.i)((0,c.Qj)(s),i,(0,o.e)(r,t,e.state.camera.eye));return(0,o.i)(n,n,i),(0,c.O_)(t,n,s)}(e,t))).next(function(e,t){const i=(0,n.vt)(),r=(0,o.b)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const s=(0,n.vt)(),a=(0,n.vt)(),l=s=>((0,o.e)(s,s,t),(0,u._I)(i,s,s),"global"===e.viewingMode&&(0,o.b)(s)*Math.sign((0,o.f)(i,s))<.001-r&&(0,o.e)(s,(0,o.h)(s,i,.001),t),(0,o.g)(s,s,t),s);return e=>(e.renderStart=l((0,o.d)(s,e.renderStart)),e.renderEnd=l((0,o.d)(a,e.renderEnd)),e)}(e,t)).next(R(e,i)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e}),e=>(r=null,s.execute(e),r)}function M(e,t){const i=i=>{const s=(0,r.WA)(i,(0,r.PR)(V)),o=(0,g.Z4)(e.state.camera,s,G);if(null==o)return null;const n=(0,h.Zb)(t,o,A,F);return n?.[0]};return e=>{const t=i(e.screenStart);if(null==t)return null;const r=i(e.screenEnd);return null==r?null:{...e,renderStart:t,renderEnd:r}}}function R(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,new a.A({spatialReference:t})),s=i.fromRenderCoords(e.renderEnd,new a.A({spatialReference:t}));return null!=r&&null!=s?{...e,mapStart:r,mapEnd:s}:null}}function P(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return i}}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=new m.n(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=0,i.options.hud=!1;const s=(0,r.gs)(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,n.vt)(),c=t??e.spatialReference,h=t=>{e.map.ground&&e.map.ground.opacity<1?o.exclude.add(_.fo):o.exclude.delete(_.fo),e.sceneIntersectionHelper.intersectIntersectorScreen((0,r.WA)(t,s),i,o);const n=i.results.min;let h;if(n.getIntersectionPoint(l))h=7===n.intersector?0:1;else{if(!i.results.ground.getIntersectionPoint(l))return null;h=0}return{location:e.renderCoordsHelper.fromRenderCoords(l,new a.A({spatialReference:c})),surfaceType:h}};let u;return e=>{if("start"===e.action){const t=h(e.screenStart);u=null!=t?t.location:null}if(null==u)return null;const t=h(e.screenEnd);return null!=t?.location?{...e,mapStart:u,mapEnd:t.location,surfaceType:t.surfaceType}:null}}const V=(0,s.vt)(),A=(0,n.vt)(),F=(0,n.vt)(),G=(0,h.vt)()},10294:(e,t,i)=>{i.d(t,{S:()=>a});var r=i(15941),s=i(31633),o=i(20664),n=i(13927);function a(e,t,i){const a=function(e,t,i,r){const a=(e=>!Array.isArray(e[0]))(t)?(e,i)=>t[3*e+i]:(e,i)=>t[e][i],l=r?(0,s.GA)(r)/(0,s.G9)(r):1;return(0,n.lU)(e,(e,t)=>(0,o.j)(e,a(t,0)*l,a(t,1)*l,a(t,2)),i)}(l,e,t,i)?(0,n.Qj)(l):[0,0,1];return Math.abs(a[2])>Math.cos((0,r.kU)(80))?2:Math.abs(a[1])>Math.abs(a[0])?1:0}const l=(0,n.vt)()},10760:(e,t,i)=>{i.d(t,{h:()=>o});let r=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),s=(e,t,i)=>{for(let o=0,n=t.length;o<n;o++){let n=t[o];Array.isArray(n)?s(e,n,i):null!=n&&!1!==n&&("string"==typeof n&&(n=r(n)),i.push(n))}};function o(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let r,o;return i&&1===i.length&&"string"==typeof i[0]?r=i[0]:i&&(o=[],s(e,i,o),0===o.length&&(o=void 0)),{vnodeSelector:e,properties:t,children:o,text:""===r?void 0:r,domNode:null}}},18295:(e,t,i)=>{i.d(t,{B:()=>h});var r=i(19276),s=i(54901),o=i(43927),n=i(3589),a=i(63078),l=i(83973);const c=r.A.ofType(n.A);function h(e,t){const i=(0,o.L)(t?.excludeInternal?()=>e.map?.allLayers.filter(e=>!("internal"in e)||!e.internal):()=>e.map?.allLayers,e=>new n.A({layer:e}),{recycleItems:!0,createCollection:()=>new c}),r=new l.A({enabled:!0,selfEnabled:t?.selfEnabled??!1,featureEnabled:!0,featureSources:i,distance:t?.distance??a.N.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??a.N.touchSensitivityMultiplier});return{...(0,s.DQ)(i),options:r}}},25191:(e,t,i)=>{i.d(t,{C:()=>h,J:()=>u});var r=i(20664),s=i(9392),o=i(56611),n=i(98510),a=i(14487),l=i(75762),c=i(94966);class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.vt)(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.vt)();this.startRenderSpace=e,this.endRenderSpace=t,this.type="euclidean"}eval(e,t,i){return(0,r.l)(t,this.startRenderSpace,this.endRenderSpace,e),i&&((0,r.e)(i,this.endRenderSpace,this.startRenderSpace),(0,r.n)(i,i)),t}createRenderGeometry(e,t){const i=[],s=[],o=(t,o)=>{const n=p;(0,r.e)(n,t,e),i.push([n[0],n[1],n[2]]),s.push([o[0],o[1],o[2]])},n=t.worldUpAtPosition(this.eval(.5,d),l.rq.get());return o(this.startRenderSpace,n),o(this.endRenderSpace,n),{points:i,normals:s}}static fromPositionAndVector(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,r.h)(d,t,i),(0,r.g)(d,e,d),new h((0,s.o8)(e),(0,s.o8)(d))}}class u{_projectIn(e,t){this._project?(0,a.F)(e,this.renderSpatialReference,t,this._pcpf):(0,r.d)(t,e)}constructor(e,t,i){this.startRenderSpace=e,this.endRenderSpace=t,this.renderSpatialReference=i,this.type="geodesic",this._start=(0,s.vt)(),this._end=(0,s.vt)(),this._pcpf=(0,n.lO)(i),this._project=(0,o.canProjectWithoutEngine)(i,this._pcpf),this._projectIn(e,this._start),this._projectIn(t,this._end)}eval(e,t,i){if(this._project)if(i){const s=p;(0,c.is)(this._start,this._end,e,t,s),(0,r.g)(g,t,s),(0,a.F)(t,this._pcpf,t,this.renderSpatialReference),(0,a.F)(g,this._pcpf,g,this.renderSpatialReference),(0,r.e)(i,g,t),(0,r.n)(i,i)}else(0,c.nu)(this._start,this._end,e,t),(0,a.F)(t,this._pcpf,t,this.renderSpatialReference);else(0,r.l)(t,this._start,this._end,e),i&&((0,r.e)(i,this._end,this._start),(0,r.n)(i,i));return t}createRenderGeometry(e,t){const i=[],s=[],o=(t,o)=>{const n=g;(0,r.e)(n,t,e),i.push([n[0],n[1],n[2]]),s.push([o[0],o[1],o[2]])};for(let r=0;r<128;++r){const e=r/127,i=d,s=p;this.eval(e,i),t.worldUpAtPosition(i,s),o(i,s)}return{points:i,normals:s}}}const d=(0,s.vt)(),p=(0,s.vt)(),g=(0,s.vt)()},28048:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(6326),s=i(69539),o=i(91967),n=i(46053),a=(i(81806),i(76460),i(47249),i(87990)),l=(i(27347),i(10760));i(48396);const c={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let h=class extends o.A{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){const{textColor:e,backgroundColor:t}=this,i=t.clone();return i.a*=e.a,i}get _textShadow(){const e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get padding(){return.5*this.fontSize}get borderRadius(){return this.padding}set borderRadius(e){this._overrideIfSome("borderRadius",e)}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new s.A([0,0,0,.6]),this.textColor=new s.A([255,255,255]),this._textShadowSize=1}render(){return(0,l.h)("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this.borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const{padding:i,borderRadius:r}=this,s=e.measureText(this.text).width,o=""!==this.text?this.fontSize:0,n=u[this.anchor];e.textAlign="center",e.textBaseline="middle";const a=s+2*i,l=o+2*i,c=this.x+n.x*a,h=this.y+n.y*l;this._roundedRect(e,c,h,a,l,r),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const d=this.x+(n.x+.5)*a,p=this.y+(n.y+.5)*l;this._renderTextShadow(e,this.text,d,p),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,d,p)}_renderTextShadow(e,t,i,r){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/d.length})`;const s=this._textShadowSize;for(const[o,n]of d)e.fillText(t,i+s*o,r+s*n)}_roundedRect(e,t,i,r,s,o){o=Math.min(o,s/2,r/2),e.beginPath(),e.moveTo(t,i+o),e.arcTo(t,i,t+o,i,o),e.lineTo(t+r-o,i),e.arcTo(t+r,i,t+r,i+o,o),e.lineTo(t+r,i+s-o),e.arcTo(t+r,i+s,t+r-o,i+s,o),e.lineTo(t+o,i+s),e.arcTo(t,i+s,t,i+s-o,o),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in c)e[c[t]]=this.anchor===t;return e}};(0,r.Cg)([(0,n.MZ)()],h.prototype,"x",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"y",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"position",null),(0,r.Cg)([(0,n.MZ)()],h.prototype,"text",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"fontSize",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"anchor",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"visible",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"isDecoration",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"backgroundColor",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"textColor",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"_textShadowSize",void 0),(0,r.Cg)([(0,n.MZ)()],h.prototype,"_textShadowColor",null),(0,r.Cg)([(0,n.MZ)()],h.prototype,"_textShadow",null),(0,r.Cg)([(0,n.MZ)()],h.prototype,"padding",null),(0,r.Cg)([(0,n.MZ)()],h.prototype,"borderRadius",null),h=(0,r.Cg)([(0,a.$)("esri.views.overlay.TextOverlayItem")],h);const u={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},d=[];{const e=16;for(let t=0;t<360;t+=360/e)d.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}},35925:(e,t,i)=>{i.d(t,{Xq:()=>a,wk:()=>n});const r={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},s={dash:r.dash,"dash-dot":[...r.dash,...r.dot],dot:r.dot,"long-dash":r["long-dash"],"long-dash-dot":[...r["long-dash"],...r.dot],"long-dash-dot-dot":[...r["long-dash"],...r.dot,...r.dot],none:null,"short-dash":r["short-dash"],"short-dash-dot":[...r["short-dash"],...r["short-dot"]],"short-dash-dot-dot":[...r["short-dash"],...r["short-dot"],...r["short-dot"]],"short-dot":r["short-dot"],solid:null},o=8;function n(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return"style"===e?.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(s[e],o):null}(e.style):null}},38983:(e,t,i)=>{function r(e,t,i){i=i||2;var r,o,a,l,c,h,d,p=t&&t.length,g=p?t[0]*i:e.length,m=s(e,0,g,i,!0),_=[];if(!m||m.next===m.prev)return _;if(p&&(m=u(e,t,m,i)),e.length>80*i){r=a=e[0],o=l=e[1];for(var f=i;f<g;f+=i)(c=e[f])<r&&(r=c),(h=e[f+1])<o&&(o=h),c>a&&(a=c),h>l&&(l=h);d=0!==(d=Math.max(a-r,l-o))?1/d:0}return n(m,_,i,r,o,d),_}function s(e,t,i,r,s){var o,n;if(s===G(e,t,i,r)>0)for(o=t;o<i;o+=r)n=V(o,e[o],e[o+1],n);else for(o=i-r;o>=t;o-=r)n=V(o,e[o],e[o+1],n);if(n&&C(n,n.next)){var a=n.next;A(n),n=a}return n}function o(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!C(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{var s=r.prev;if(A(r),(r=t=s)===r.next)break;i=!0}}while(i||r!==t);return t}function n(e,t,i,r,s,u,d){if(e){!d&&u&&_(e,r,s,u);for(var p,g,m=e;e.prev!==e.next;)if(p=e.prev,g=e.next,u?l(e,r,s,u):a(e))t.push(p.i/i),t.push(e.i/i),t.push(g.i/i),A(e),e=g.next,m=g.next;else if((e=g)===m){d?1===d?n(e=c(o(e),t,i),t,i,r,s,u,2):2===d&&h(e,t,i,r,s,u):n(o(e),t,i,r,s,u,1);break}}}function a(e){var t=e.prev,i=e,r=e.next;if(w(t,i,r)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(v(t.x,t.y,i.x,i.y,r.x,r.y,s.x,s.y)&&w(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function l(e,t,i,r){var s=e.prev,o=e,n=e.next;if(w(s,o,n)>=0)return!1;for(var a=s.x<o.x?s.x<n.x?s.x:n.x:o.x<n.x?o.x:n.x,l=s.y<o.y?s.y<n.y?s.y:n.y:o.y<n.y?o.y:n.y,c=s.x>o.x?s.x>n.x?s.x:n.x:o.x>n.x?o.x:n.x,h=s.y>o.y?s.y>n.y?s.y:n.y:o.y>n.y?o.y:n.y,u=f(a,l,t,i,r),d=f(c,h,t,i,r),p=e.prevZ,g=e.nextZ;p&&p.z>=u&&g&&g.z<=d;){if(p!==e.prev&&p!==e.next&&v(s.x,s.y,o.x,o.y,n.x,n.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&v(s.x,s.y,o.x,o.y,n.x,n.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&v(s.x,s.y,o.x,o.y,n.x,n.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=d;){if(g!==e.prev&&g!==e.next&&v(s.x,s.y,o.x,o.y,n.x,n.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function c(e,t,i){var r=e;do{var s=r.prev,n=r.next.next;!C(s,n)&&b(s,r,r.next,n)&&P(s,n)&&P(n,s)&&(t.push(s.i/i),t.push(r.i/i),t.push(n.i/i),A(r),A(r.next),r=e=n),r=r.next}while(r!==e);return o(r)}function h(e,t,i,r,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&x(l,c)){var h=S(l,c);return l=o(l,l.next),h=o(h,h.next),n(l,t,i,r,s,a),void n(h,t,i,r,s,a)}c=c.next}l=l.next}while(l!==e)}function u(e,t,i,r){var n,a,l,c=[];for(n=0,a=t.length;n<a;n++)(l=s(e,t[n]*r,n<a-1?t[n+1]*r:e.length,r,!1))===l.next&&(l.steiner=!0),c.push(y(l));for(c.sort(d),n=0;n<c.length;n++)i=o(i=g(c[n],i),i.next);return i}function d(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function g(e,t){var i=function(e,t){var i,r=t,s=e.x,o=e.y,n=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>n){if(n=a,a===s){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(s===n)return i;var l,c=i,h=i.x,u=i.y,d=1/0;r=i;do{s>=r.x&&r.x>=h&&s!==r.x&&v(o<u?s:n,o,h,u,o<u?n:s,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(s-r.x),P(r,e)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&m(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(e,t);if(!i)return t;var r=S(i,e),s=o(i,i.next);let n=p(r);return o(n,n.next),s=p(s),p(t===i?s:t)}function m(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function _(e,t,i,r){var s=e;do{null===s.z&&(s.z=f(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,i,r,s,o,n,a,l,c=1;do{for(i=e,e=null,o=null,n=0;i;){for(n++,r=i,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),o?o.nextZ=s:e=s,s.prevZ=o,o=s;i=r}o.nextZ=null,c*=2}while(n>1)}(s)}function f(e,t,i,r,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function v(e,t,i,r,s,o,n,a){return(s-n)*(t-a)-(e-n)*(o-a)>=0&&(e-n)*(r-a)-(i-n)*(t-a)>=0&&(i-n)*(o-a)-(s-n)*(r-a)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&b(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(P(e,t)&&P(t,e)&&function(e,t){var i=e,r=!1,s=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&s<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||C(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function C(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,i,r){var s=R(w(e,t,i)),o=R(w(e,t,r)),n=R(w(i,r,e)),a=R(w(i,r,t));return s!==o&&n!==a||!(0!==s||!M(e,i,t))||!(0!==o||!M(e,r,t))||!(0!==n||!M(i,e,r))||!(0!==a||!M(i,t,r))}function M(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function R(e){return e>0?1:e<0?-1:0}function P(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function S(e,t){var i=new F(e.i,e.x,e.y),r=new F(t.i,t.x,t.y),s=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function V(e,t,i,r){var s=new F(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function F(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function G(e,t,i,r){for(var s=0,o=t,n=i-r;o<i;o+=r)s+=(e[n]-e[o])*(e[o+1]+e[n+1]),n=o;return s}i.d(t,{e:()=>r}),r.deviation=function(e,t,i,r){var s=t&&t.length,o=s?t[0]*i:e.length,n=Math.abs(G(e,0,o,i));if(s)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,h=a<l-1?t[a+1]*i:e.length;n-=Math.abs(G(e,c,h,i))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,g=r[a+2]*i;u+=Math.abs((e[d]-e[g])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[g+1]-e[d+1]))}return 0===n&&0===u?0:Math.abs((u-n)/n)},r.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,s=0;s<e.length;s++){for(var o=0;o<e[s].length;o++)for(var n=0;n<t;n++)i.vertices.push(e[s][o][n]);s>0&&(r+=e[s-1].length,i.holes.push(r))}return i}},43147:(e,t,i)=>{i.d(t,{C:()=>c,a:()=>u,b:()=>h});var r=i(73398),s=i(65058),o=i(86955),n=i(70367),a=i(31432),l=i(2687);class c extends a.Y{}function h(){const e=new l.N5;return e.include(r.c),e.fragment.include(s.E),e.fragment.uniforms.add(new n.N("cutFillReferenceDepthTexture",e=>e.referenceDepthTexture),new n.N("cutFillTargetDepthTexture",e=>e.targetDepthTexture)),e.fragment.code.add(o.H`bool outsideFar(float depth) {
return depth >= 1.0;
}`),e.fragment.main.add(o.H`float referenceDepth = depthFromTexture(cutFillReferenceDepthTexture, uv);
float targetDepth = depthFromTexture(cutFillTargetDepthTexture, uv);
if (outsideFar(targetDepth)) {
discard;
}
float depth = referenceDepth - targetDepth;
float cut = min(0.0, depth);
float fill = max(0.0, depth);
fragColor = vec4(cut, fill, 0.0, 0.0);`),e}const u=Object.freeze(Object.defineProperty({__proto__:null,CutFillDepthParameters:c,build:h},Symbol.toStringTag,{value:"Module"}))},48234:(e,t,i)=>{i.d(t,{C:()=>g,a:()=>f,b:()=>m});var r=i(34761),s=i(13191),o=i(72745),n=i(9392),a=i(59395),l=i(49399),c=i(95756),h=i(86955),u=i(43425),d=i(31432),p=i(2687);class g extends d.Y{constructor(){super(...arguments),this.origin=n.uY,this.cutFillCamera={projectionMatrix:(0,s.vt)(),viewMatrix:(0,s.vt)(),nearFar:(0,o.vt)()}}}function m(e){const t=new p.N5,{vertex:i,fragment:s,varyings:o,attributes:n}=t;return t.include(a.d),t.include(l.L,e),n.add("position","vec3"),o.add("depth","float",{invariant:!0}),i.uniforms.add(new u.X("proj",e=>e.cutFillCamera.projectionMatrix),new u.X("view",e=>(0,r.Tl)(_,e.cutFillCamera.viewMatrix,e.origin)),new c.G("nearFar",e=>e.cutFillCamera.nearFar)),i.main.add(h.H`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, depth);`),s.main.add(h.H`fragColor = vec4(1.0);
outputDepth(depth);`),t}const _=(0,s.vt)(),f=Object.freeze(Object.defineProperty({__proto__:null,CutFillTargetDepthParameters:g,build:m},Symbol.toStringTag,{value:"Module"}))},49853:(e,t,i)=>{i.d(t,{a:()=>c});var r=i(6326),s=i(54099),o=i(54901),n=i(91291),a=i(46053),l=(i(81806),i(76460),i(47249),i(87990));let c=class extends((0,n.g)(s.nJ)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return(this.parent?.visible&&!this.parent.suspended)??!0}set visible(e){this._overrideIfSome("visible",e)}forceInteractive(){return this._interactiveViewModelCount++,(0,o.hA)(()=>this._interactiveViewModelCount--)}};(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],c.prototype,"parent",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],c.prototype,"view",void 0),(0,r.Cg)([(0,a.MZ)({type:Boolean})],c.prototype,"interactive",null),(0,r.Cg)([(0,a.MZ)()],c.prototype,"_userInteractive",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],c.prototype,"updating",null),(0,r.Cg)([(0,a.MZ)()],c.prototype,"visible",null),(0,r.Cg)([(0,a.MZ)()],c.prototype,"_interactiveViewModelCount",void 0),c=(0,r.Cg)([(0,l.$)("esri.views.analysis.AnalysisView")],c)},53172:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Gt});var r=i(6326),s=i(81806),o=i(30726),n=i(31633),a=i(46053),l=i(76460),c=(i(47249),i(87990)),h=i(9392),u=i(19247),d=i(19747),p=i(2522),g=i(69539);const m=new g.A("black");const _=new class{constructor(){this.geometryOutlineWidth=1.5,this.geometryOutlineColor=new g.A("rgb(128,128,128)"),this.cutColor=new g.A("rgba(153, 198, 111, 0.75)"),this.fillColor=new g.A("rgba(200, 200, 230, 0.75)"),this.cutColorMuted=new g.A("rgba(176, 176, 176, 0.75)"),this.fillColorMuted=new g.A("rgba(194, 194, 194, 0.75)"),this.cutProjectionLineColor=g.A.blendColors(this.cutColor,m,.4),this.fillProjectionLineColor=g.A.blendColors(this.fillColor,m,.4),this.projectionLineWidth=2,this.projectionLineStippleSize=4,this.labelDistance=40,this.labelPrecisions={"cubic-millimeters":0,"cubic-centimeters":0,"cubic-decimeters":1,"cubic-meters":2,"cubic-kilometers":6,"cubic-inches":0,"cubic-feet":2,"cubic-yards":2,"cubic-miles":6,liters:2},this.maxVolumeExtentSizeVw=.7,this.minVolumeExtentSizePixels=250,this.minTargetElevation=-11e3,this.maxTargetElevation=9e3,this.targetElevationRange=this.maxTargetElevation-this.minTargetElevation,this.maxPerimeterLocalWebMercator=1e4,this.maxPerimeterGlobal=5e4}};var f=i(91967),y=i(68134),v=i(76931),x=i(38983),w=i(13191),C=i(20664),b=i(19451),M=i(56611),R=i(5809),P=i(50840),S=i(2413),V=i(44815),A=i(45136),F=i(731),G=i(17430),T=i(88954);let k=class extends f.A{constructor(e){super(e),this.rawResult=null}get localOriginRenderSpace(){const{extent:e,localOrigin:t,renderCoordsHelper:i}=this,r=(0,h.vt)();return i.toRenderCoords(t,e.spatialReference,r),r}get cameraPositionRenderSpace(){const{localOriginRenderSpace:e,renderCoordsHelper:t}=this,i=(0,h.vt)(),r=1/t.unitInMeters;return t.setAltitude(i,D*r,e),i}get boundingRect(){const{extent:e,renderCoordsHelper:t}=this,i=(0,S.vt)();return 2===t.viewingMode?(0,S.VY)(e,i):(this._expandBoundingRect(e.xmin,e.ymin,i),this._expandBoundingRect(e.xmax,e.ymin,i),this._expandBoundingRect(e.xmin,e.ymax,i),this._expandBoundingRect(e.xmax,e.ymax,i)),i}get cameraDimensions(){const{boundingRect:e}=this;return{width:(0,S.VL)(e),height:(0,S.uJ)(e)}}get cameraNearFar(){const{renderCoordsHelper:{unitInMeters:e}}=this,t=1/e;return{near:L*t,far:I*t}}get upVector(){return this.renderCoordsHelper.worldBasisAtPosition(this.cameraPositionRenderSpace,2,(0,h.vt)())}get northVector(){return this.renderCoordsHelper.worldBasisAtPosition(this.cameraPositionRenderSpace,1,(0,h.vt)())}get eastVector(){return this.renderCoordsHelper.worldBasisAtPosition(this.cameraPositionRenderSpace,0,(0,h.vt)())}_expandBoundingRect(e,t,i){const{extent:r,eastVector:s,northVector:o,upVector:n,renderCoordsHelper:a}=this,l=r.center.z??0;(0,C.j)(O,e,t,l),a.toRenderCoords(O,r.spatialReference,O),(0,T.PX)(O,s,o,n,Z),(0,S.fT)(i,Z,i)}};(0,r.Cg)([(0,a.MZ)()],k.prototype,"renderCoordsHelper",void 0),(0,r.Cg)([(0,a.MZ)()],k.prototype,"extent",void 0),(0,r.Cg)([(0,a.MZ)()],k.prototype,"localOrigin",void 0),(0,r.Cg)([(0,a.MZ)()],k.prototype,"localOriginRenderSpace",null),(0,r.Cg)([(0,a.MZ)()],k.prototype,"cameraPositionRenderSpace",null),(0,r.Cg)([(0,a.MZ)()],k.prototype,"boundingRect",null),(0,r.Cg)([(0,a.MZ)()],k.prototype,"cameraDimensions",null),(0,r.Cg)([(0,a.MZ)()],k.prototype,"upVector",null),(0,r.Cg)([(0,a.MZ)()],k.prototype,"northVector",null),(0,r.Cg)([(0,a.MZ)()],k.prototype,"eastVector",null),(0,r.Cg)([(0,a.MZ)()],k.prototype,"rawResult",void 0),k=(0,r.Cg)([(0,c.$)("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementCutFillComputation")],k);const O=(0,h.vt)(),Z=(0,h.vt)(),D=_.maxTargetElevation,L=0,I=_.targetElevationRange+100;var E=i(50076);class j extends E.A{constructor(e,t,i){super(e,t,i),this.name="unknown",this.name=e}}class z extends j{constructor(){super("perimeter-too-large","The input geometry's perimeter is too large for the current viewing mode and spatial reference.")}}class U extends j{constructor(){super("distance-too-far","The measurement geometry is too far from the camera.")}}class B extends j{constructor(){super("distance-too-close","The measurement geometry is too close to the camera.")}}class H extends j{constructor(){super("unsupported-coordinate-system","The coordinate system of the view (viewing mode and spatial reference) is not supported.")}}class q extends j{constructor(){super("unsupported-layer-transparency","The volume measurement analysis does not support transparent layers.")}}var W=i(24648);function N(e,t){return e?(0,W.kM)(e,(0,n.bE)(e.value,e.unit,t)):null}let $=class extends f.A{constructor(e){super(e)}get cutVolume(){return N(this.rawResult.cutVolume,this.unit)}get fillVolume(){return N(this.rawResult.fillVolume,this.unit)}get netVolume(){return N(this.rawResult.netVolume,this.unit)}get totalVolume(){return N(this.rawResult.totalVolume,this.unit)}};(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],$.prototype,"measureType",void 0),(0,r.Cg)([(0,a.MZ)()],$.prototype,"cutVolume",null),(0,r.Cg)([(0,a.MZ)()],$.prototype,"fillVolume",null),(0,r.Cg)([(0,a.MZ)()],$.prototype,"netVolume",null),(0,r.Cg)([(0,a.MZ)()],$.prototype,"totalVolume",null),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],$.prototype,"rawResult",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],$.prototype,"unit",void 0),$=(0,r.Cg)([(0,c.$)("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementResult")],$);var Q=i(49296),Y=i(80935),X=i(87925),J=i(15941),K=i(34761),ee=i(90364),te=i(57481),ie=i(48549),re=i(33062),se=i(36451),oe=i(6485);class ne extends oe.K{constructor(){super(...arguments),this.output=0}}(0,r.Cg)([(0,oe.W)({count:11})],ne.prototype,"output",void 0);var ae=i(69008),le=i(43147),ce=i(16506),he=i(59246),ue=i(11850),de=i(57162);class pe extends he.w{constructor(e,t){super(e,t,new ce.$(le.a,()=>i.e(48197).then(i.bind(i,48197))),ue.Nx)}initializePipeline(){return(0,de.Ey)({colorWrite:de.kn})}}var ge=i(72915);class me extends he.w{constructor(e,t){super(e,t,new ce.$(ge.a,()=>i.e(36061).then(i.bind(i,36061))),ue.Nx)}initializePipeline(){return(0,de.Ey)({colorWrite:de.kn})}}var _e=i(48234);class fe extends he.w{constructor(e,t){super(e,t,new ce.$(_e.a,()=>i.e(9484).then(i.bind(i,9484))),ue.S$)}initializePipeline(){return(0,de.Ey)({colorWrite:de.kn,depthWrite:de.Uy,depthTest:{func:519}})}}var ye=i(93345),ve=i(9243);let xe=class extends se.A{constructor(e){super(e),this.consumes={required:[ee.hM.TRANSPARENT]},this.produces=ee.OG.CUTFILL_DEPTH,this._cutFillTargetDepthConfiguration=new ne,this._cutFillTargetDepthParameters=new _e.C,this._cutFillDepthParameters=new le.C,this._cutFillReductionParameters=new ge.C,this.needsRender=!1,this.done=!0,this._localOrigin=(0,h.vt)(),this._maxTextureSize=4096,this._width=0,this._height=0,this._reducedWidth=0,this._reducedHeight=0,this._depthFormat=13,this._colorFormat=10,this._targetVao=null}initialize(){this._maxTextureSize=Math.min((0,s.A)("esri-mobile")?1024:this._maxTextureSize,this.fboCache.rctx.parameters.maxTextureSize),this._cutFillTargetDepthConfiguration.output=8}destroy(){this._targetVao=(0,o.WD)(this._targetVao)}precompile(){this.techniques.precompile(fe,this._cutFillTargetDepthConfiguration),this.techniques.precompile(pe),this.techniques.precompile(me),this.view.stage.renderer.precompileCutFill()}render(e){const t=e.find(e=>{let{name:t}=e;return t===ee.OG.CUTFILL_DEPTH});if(!this._orthographicCamera||!this._targetVao||!this.needsRender)return t;const i=this.techniques.get(fe,this._cutFillTargetDepthConfiguration),r=this.techniques.get(pe),s=this.techniques.get(me);if(!i.compiled||!r.compiled||!s.compiled)return this.requestRender(1),t;this.needsRender=!1;const o=this.renderingContext,n=this.fboCache,a=o.getViewport(),l=n.acquire(this._width,this._height,"cutfill reference depth",this._depthFormat);o.bindFramebuffer(l.fbo),o.setViewport(0,0,this._width,this._height),o.clear(1280),this.view.stage.renderer.renderCutFillReferenceDepth(this._orthographicCamera);const c=n.acquire(this._width,this._height,"cutfill target depth",this._depthFormat);o.bindFramebuffer(c.fbo),o.setViewport(0,0,this._width,this._height),o.setClearDepth(1),o.clear(256),this._cutFillTargetDepthParameters.origin=this._localOrigin,this._cutFillTargetDepthParameters.cutFillCamera=this._orthographicCamera,o.bindTechnique(i,this.bindParameters,this._cutFillTargetDepthParameters),o.bindVAO(this._targetVao),o.drawArrays(ye.WR.TRIANGLES,0,this._targetVao.vertexCount("geometry"));let h=n.acquire(this._width,this._height,"cutfill reduction even",this._colorFormat),u=n.acquire(this._width,this._height,"cutfill reduction odd",this._colorFormat);this._cutFillDepthParameters.referenceDepthTexture=l.depthTexture,this._cutFillDepthParameters.targetDepthTexture=c.depthTexture,o.bindFramebuffer(h.fbo),o.bindTechnique(r,this.bindParameters,this._cutFillDepthParameters),o.setClearColor(0,0,0,0),o.clear(16384),o.screen.draw(),l.release(),c.release();let d=this._width,p=this._height;const g=Math.ceil(Math.log2(Math.min(d,p)));for(let m=0;m<g;m++)d=Math.ceil(d/2),p=Math.ceil(p/2),this._cutFillReductionParameters.depthTexture=h.getTexture(),this._prepareFBO(u,d,p),o.bindTechnique(s,this.bindParameters,this._cutFillReductionParameters),o.screen.draw(),[h,u]=[u,h];return this._buffer=new Float32Array(d*p*2),h.fbo?.readPixels(0,0,d,p,33319,ye.pe.FLOAT,this._buffer),this._reducedWidth=d,this._reducedHeight=p,h.release(),u.release(),o.setViewport(a.x,a.y,a.width,a.height),this.done=!0,t}setup(e,t){const i=this.renderingContext,{cameraDimensions:{width:r,height:s},localOriginRenderSpace:n}=e,a=this._maxTextureSize,l=s/r,c=r>s?a:a/l,h=r>s?a*l:a;this._width=(0,J.yR)(c),this._height=(0,J.yR)(h);const u=[this._width,this._height];this._orthographicCamera=this._createCamera(e,u),this._targetVao=(0,o.WD)(this._targetVao),this._targetVao=function(e,t){const{positions:i,indices:r}=t,s=we.createBuffer(r.length),o=s.position;for(let a=0;a<r.length;++a){const e=3*r[a];o.set(a,0,i[e]),o.set(a,1,i[e+1]),o.set(a,2,i[e+2])}const n=new ve.R(e,(0,te.U)(we),s.buffer);return new ae.Z(e,n)}(i,t),this._localOrigin=n,this.done=!1}start(){0!==this._width&&0!==this._height&&(this.needsRender=!0)}getDepth(){let e=0,t=0;for(let i=0;i<this._reducedWidth;i++)for(let r=0;r<this._reducedHeight;r++){const s=i+r*this._reducedHeight;e+=this._buffer?.[2*s]??0,t+=this._buffer?.[2*s+1]??0}return{cut:e,fill:t}}get width(){return this._width}get height(){return this._height}get updating(){return this.needsRender||!this.done}_prepareFBO(e,t,i){const r=this.renderingContext;r.bindFramebuffer(e.fbo),r.setViewport(0,0,t,i),r.setClearColor(0,0,0,0),r.clear(16384)}_createCamera(e,t){const{cameraPositionRenderSpace:i,localOriginRenderSpace:r,northVector:s,cameraDimensions:{width:o,height:n},cameraNearFar:{near:a,far:l}}=e,c=new re.A({eye:i,center:r,up:s,near:a,far:l});return c.viewport=[0,0,t[0],t[1]],(0,K.v3)(c.projectionMatrix,-o/2,o/2,-n/2,n/2,a,l),c}};(0,r.Cg)([(0,a.MZ)()],xe.prototype,"consumes",void 0),(0,r.Cg)([(0,a.MZ)()],xe.prototype,"produces",void 0),(0,r.Cg)([(0,a.MZ)()],xe.prototype,"needsRender",void 0),(0,r.Cg)([(0,a.MZ)()],xe.prototype,"done",void 0),(0,r.Cg)([(0,a.MZ)()],xe.prototype,"updating",null),xe=(0,r.Cg)([(0,c.$)("esri.views.3d.webgl-engine.lib.CutFillDepth")],xe);const we=(0,ie.BP)().vec3f("position").freeze();class Ce{constructor(e,t){this.positions=e,this.indices=t}}var be=i(29772);let Me=class extends f.A{constructor(e){super(e),this._getElevationProvider=()=>this.view.elevationProvider,this._updatingHandles=new b.U,this._computationValue=null}initialize(){const e=this.view;this._renderer=new xe({view:e}),this._updatingHandles.add(()=>({computation:this._computation,renderGeometry:this._targetGeometryRenderInfo}),e=>{let{computation:t,renderGeometry:i}=e;t&&i&&(this._renderer.setup(t,i),this._renderer.start())},y.Vh),this.addHandles([this._createElevationUpdateHandle(),(0,y.wB)(()=>this._targetGeometry,e=>this.analysisViewData.targetGeometry=e,y.pc),(0,y.wB)(()=>this._elevationAlignedGeometry,e=>this.analysisViewData.elevationAlignedGeometry=e,y.pc),(0,y.wB)(()=>({computation:this._computation,extent:this._projectedGeometry?.extent,localOrigin:this._localOrigin}),e=>{let{computation:t,extent:i,localOrigin:r}=e;t&&i&&r&&(t.extent=i,t.localOrigin=r)},y.OH),(0,y.z7)(()=>this._renderer.done,()=>this._updateResult())])}destroy(){this._updatingHandles.destroy(),this._renderer.destroy()}get _projectedGeometry(){if(!this.analysis.valid)return null;const e=this.analysis.geometry,t=(0,M.projectOrLoad)(e,this.view.spatialReference);return t.pending?(this._updatingHandles.addPromise(t.pending),null):(e&&!t.geometry&&(0,G.V)(this.analysis,e.spatialReference,l.A.getLogger(this)),t.geometry)}get _localOrigin(){const e=this._projectedGeometry?.extent;return e?(0,h.fA)(e.center.x,e.center.y,0):null}get _elevationAlignedGeometry(){const e=this._projectedGeometry;if(!e)return null;const t=e.clone();return function(e,t){t.rings[0].forEach(t=>{t[2]=(0,Y.R1)(e,t,"ground")??0})}(this._getElevationProvider(),t),t}get _targetGeometry(){const e=this._elevationAlignedGeometry;if(!e)return null;const t=this.analysis.measureType,{effectiveTargetElevation:i}=this.analysisViewData;if("stockpile"===t||null==i)return e;const r=e.clone();return r.rings[0].forEach(e=>e[2]=i),r}get _targetGeometryRenderInfo(){const e=this._targetGeometry,t=this._projectedGeometry?.extent,i=this._localOrigin;if(!e||!t||!i)return null;const{elevationProvider:r,renderCoordsHelper:s}=this.view,o=(0,X.C8)(e,r,s,Q.F.fromElevationInfo(new F.A({mode:"absolute-height"}))),{polygons:n}=o,a=n[0],l=(0,x.e)(a.position,a.holeIndices,3),c=(0,V.jh)(3*a.count),h=(0,w.vt)(),u=(0,w.vt)();return(0,R.l)(t.spatialReference,i,h,s.spatialReference),u[12]=-h[12],u[13]=-h[13],u[14]=-h[14],(0,A.t)(c,a.position,u),new Ce(c,l)}get updating(){return this._renderer.updating||this._updatingHandles.updating}get result(){const e=this._computation?.rawResult;return e?new $({measureType:this.analysis.measureType,rawResult:e,unit:this.analysisViewData.effectiveDisplayUnits.volume}):null}get error(){return this._unsupportedCoordinateSystemError??this._unsupportedLayerTransparencyError??this._perimeterTooLargeError??this._tooNearFarError}get _tooNearFarError(){const e=this._elevationAlignedGeometry;if(!e)return null;const{view:t}=this,{elevationProvider:i,renderCoordsHelper:r}=t,{camera:s}=t.state,o=(0,X.C8)(e,i,r,Q.F.fromElevationInfo(new F.A({mode:"absolute-height"}))),{polygons:n}=o,a=n[0].position;(0,S.Ie)(Ve);for(let d=0;d<a.length;d+=3)s.projectToScreen((0,C.j)(Se,a[d],a[d+1],a[d+2]),Ae),(0,S.fT)(Ve,Ae,Ve);const l=(0,S.VL)(Ve),c=(0,S.uJ)(Ve),{maxVolumeExtentSizeVw:h,minVolumeExtentSizePixels:u}=_;return l>s.width/s.pixelRatio*h||c>s.height/s.pixelRatio*h?new B:Math.max(l,c)<u?new U:null}get _perimeterTooLargeError(){return this._perimeterTooLargeLocalError??this._perimeterTooLargeGlobalError}get _perimeterTooLargeLocalError(){const{spatialReference:e,state:{isLocal:t}}=this.view;if(!t||!e.isWebMercator)return null;const i=this._perimeter,{maxPerimeterLocalWebMercator:r}=_;return null!=i&&i>r?new z:null}get _perimeterTooLargeGlobalError(){if(!this.view.state.isGlobal)return null;const e=this._perimeter,{maxPerimeterGlobal:t}=_;return null!=e&&e>t?new z:null}get _unsupportedCoordinateSystemError(){return this.view.state.isLocal&&this.view.spatialReference.isGeographic?new H:null}get _unsupportedLayerTransparencyError(){return(this.view.map?.ground.opacity??1)<1?new q:null}get _perimeter(){const e=this._targetGeometryRenderInfo?.positions,t=e?function(e){if(!e)return null;let t=null,i=null,r=0;for(const s of e)t||(t=[s[0],s[1],s[2]??0]),i?r+=(0,C.x)(i,s):i=[0,0,0],i[0]=s[0],i[1]=s[1],i[2]=s[2];return t&&i&&(r+=(0,C.x)(i,t)),Math.sqrt(r)}(function*(e){const t=(0,h.vt)();for(let i=0;i<e.length;i+=3)t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],yield t}(e)):null;return null!=t?t/this.view.renderCoordsHelper.unitInMeters:null}get _enabled(){return!this.error}get _computation(){const e=this._projectedGeometry?.extent;if(!e||!this._enabled)return this._computationValue=(0,o.pR)(this._computationValue),null;if(this._computationValue)return this._computationValue;const t=this._localOrigin;if(!t)return null;const{renderCoordsHelper:i}=this.view;return this._computationValue=new k({extent:e,localOrigin:t,renderCoordsHelper:i}),this._computationValue}_createElevationUpdateHandle(){const e=e=>{const t=this._projectedGeometry?.extent;"ground"===e.context&&t&&((0,P.S)(e.extent,e.spatialReference,Re,this.view.spatialReference),(0,S.VY)(t,Pe),(0,S.HY)(Re,Pe)&&(this._getElevationProvider=()=>this.view.elevationProvider))};return this.view.elevationProvider.on("elevation-change",t=>e(t))}_updateResult(){if(!this._computation)return;const{spatialReference:e,viewingMode:t}=this.view,{extent:i,boundingRect:r,cameraNearFar:{near:s,far:o}}=this._computation,{width:n,height:a}=this._renderer;let l,c;"local"===t&&e.isWebMercator?({width:l,height:c}=function(e){const t=(0,be.vp)([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],e.spatialReference),i=(0,be.vp)([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],e.spatialReference);return{width:t?.value??0,height:i?.value??0}}(i)):(l=(0,S.VL)(r),c=(0,S.uJ)(r));const h=l/n*(c/a),u=this._renderer.getDepth(),d=e=>e*(o-s)+s,p=d(u.cut)*h,g=d(u.fill)*h;this._computation.rawResult=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cubic-meters";const r=e-t,s=e+t;return{cutVolume:(0,W.pb)(e,i),fillVolume:(0,W.pb)(t,i),netVolume:(0,W.pb)(r,i),totalVolume:(0,W.pb)(s,i)}}(Math.abs(p),g)}};(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_projectedGeometry",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_localOrigin",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_getElevationProvider",void 0),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_elevationAlignedGeometry",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_targetGeometry",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_targetGeometryRenderInfo",null),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],Me.prototype,"analysis",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],Me.prototype,"analysisViewData",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],Me.prototype,"view",void 0),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"updating",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"result",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"error",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_tooNearFarError",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_perimeterTooLargeError",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_perimeterTooLargeLocalError",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_perimeterTooLargeGlobalError",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_unsupportedCoordinateSystemError",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_unsupportedLayerTransparencyError",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_perimeter",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_enabled",null),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_renderer",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],Me.prototype,"_updatingHandles",void 0),(0,r.Cg)([(0,a.MZ)()],Me.prototype,"_computation",null),Me=(0,r.Cg)([(0,c.$)("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementCutFillController")],Me);const Re=(0,S.Ie)(),Pe=(0,S.Ie)(),Se=(0,h.vt)(),Ve=(0,S.vt)(),Ae=(0,v.gs)();i(11265);var Fe=i(18690),Ge=i(73582),Te=i(11113),ke=i(38496),Oe=i(96190),Ze=i(66747),De=i(7256),Le=i(73074),Ie=i(25191),Ee=i(16266),je=i(69366);class ze extends he.w{constructor(e,t){super(e,t,new ce.$(je.a,()=>i.e(81320).then(i.bind(i,58939))),ue.Nx)}initializePipeline(){return(0,de.Ey)({colorWrite:de.kn})}}var Ue=i(71686),Be=i(75757);class He extends he.w{constructor(e,t){super(e,t,new ce.$(Ue.a,()=>i.e(20492).then(i.bind(i,20492))),(0,Be.Xk)(ue.SL))}initializePipeline(){return(0,de.Ey)({colorWrite:de.kn,depthTest:{func:515}})}}var qe=i(37267),We=i(54633),Ne=i(31432);let $e=class extends se.A{constructor(e){super(e),this.consumes={required:[ee.hM.OPAQUE]},this.produces=ee.OG.CUTFILL_COLOR,this._vaoCut=null,this._vaoFill=null,this._countCut=0,this._countFill=0,this._maskParameters=new Ue.C,this._cutVolumeParameters=new qe.uD,this._fillVolumeParameters=new qe.uD,this._compositeParameters=new je.C,this._drawParameters=new qe.V;const t=1===e.view.state.viewingMode;this._cutVolumeTechniqueConfiguration=new We.n(t),this._cutVolumeTechniqueConfiguration.customDepthTest=2,this._cutVolumeTechniqueConfiguration.writeDepth=!1,this._cutVolumeTechniqueConfiguration.cullFace=1,this._cutVolumeTechniqueConfiguration.doubleSidedMode=1,this._fillVolumeTechniqueConfiguration=new We.n(t),this._fillVolumeTechniqueConfiguration.cullFace=2}initialize(){this.addHandles([(0,y.wB)(()=>[this.cutColor,this.fillColor],()=>this._updateColors(),y.pc)])}destroy(){this._vaoCut=(0,o.WD)(this._vaoCut),this._vaoFill=(0,o.WD)(this._vaoFill)}precompile(){this.techniques.precompile(qe.R5,this._cutVolumeTechniqueConfiguration),this.techniques.precompile(qe.R5,this._fillVolumeTechniqueConfiguration),this.techniques.precompile(He),this.techniques.precompile(ze)}render(e){const t=this.techniques.get(qe.R5,this._cutVolumeTechniqueConfiguration),i=this.techniques.get(qe.R5,this._fillVolumeTechniqueConfiguration),r=this.techniques.get(He),s=this.techniques.get(ze),o=e.find(e=>{let{name:t}=e;return t===this.produces});if(!this._vaoCut||!this._vaoFill)return o;if(!(t&&i&&r.compiled&&s.compiled))return this.requestRender(1),o;const n=this.bindParameters,a=n.camera,l=a.fullViewport[2],c=a.fullViewport[3],h=this.renderingContext,u=this.fboCache,d=u.acquire(l,c,"cutfill color mask",2);d.attachDepth(o.getAttachment(ye.nI)),h.bindFramebuffer(d.fbo),h.setClearColor(0,0,0,1),h.clear(17408),h.setViewport(0,0,l,c),h.bindTechnique(r,n,Ne.m,this._maskParameters),h.setFaceCullingEnabled(!1),h.setStencilTestEnabled(!0),h.setStencilOpSeparate(1028,7680,34055,7680),h.setStencilOpSeparate(1029,7680,34056,7680),h.setDepthWriteEnabled(!1),h.bindVAO(this._vaoCut),h.setDepthTestEnabled(!0),h.setStencilWriteMask(255),h.setStencilFunction(519,0,255),h.setColorMask(!1,!1,!1,!1),h.drawArrays(ye.WR.TRIANGLES,0,this._countCut),h.setDepthTestEnabled(!1),h.setStencilWriteMask(0),h.setStencilFunction(517,0,255),h.setColorMask(!0,!1,!1,!1),h.drawArrays(ye.WR.TRIANGLES,0,this._countCut),h.bindVAO(this._vaoFill),h.setDepthTestEnabled(!0),h.setStencilWriteMask(255),h.setStencilFunction(519,0,255),h.setColorMask(!1,!0,!1,!1),h.drawArrays(ye.WR.TRIANGLES,0,this._countFill);const p=u.acquire(l,c,"cutfill color volumes",5);p.attachDepth(o.getAttachment(ye.nI)),h.bindFramebuffer(p.fbo),h.setClearColor(0,0,0,0),h.clear(16384),h.setColorMask(!0,!0,!0,!0),h.bindTechnique(t,this.bindParameters,this._cutVolumeParameters,this._drawParameters),h.setPolygonOffset(1,1),h.setPolygonOffsetFillEnabled(!0),h.bindVAO(this._vaoCut),h.drawArrays(ye.WR.TRIANGLES,0,this._countCut),h.bindTechnique(i,this.bindParameters,this._fillVolumeParameters,this._drawParameters),h.setPolygonOffset(0,0),h.setPolygonOffsetFillEnabled(!1),h.bindVAO(this._vaoFill),h.drawArrays(ye.WR.TRIANGLES,0,this._countFill);const m=this.fboCache.acquire(l,c,this.produces);return h.bindFramebuffer(m.fbo),this._compositeParameters.color=o.getTexture(),this._compositeParameters.cutFillVolumes=p.getTexture(),this._compositeParameters.cutFillMask=d.getTexture(),g.A.toUnitRGBA(this.borderColor,this._compositeParameters.borderColor),h.bindTechnique(s,n,this._compositeParameters),h.screen.draw(),d.release(),p.release(),m.attachDepth(o.getAttachment(ye.nI)),m}enable(){this.produces=ee.OG.CUTFILL_COLOR,this.requestRender(1)}disable(){this.produces="disabled",this.requestRender(1)}updateGeometries(e,t,i){this._vaoCut=(0,o.WD)(this._vaoCut),this._vaoCut=this._createVao(e),this._countCut=e.indicesBottom.length+e.indicesExtruded.length,this._vaoFill=(0,o.WD)(this._vaoFill),this._vaoFill=this._createVao(t),this._countFill=t.indicesBottom.length+t.indicesExtruded.length,this._maskParameters.origin=i,(0,C.d)(this._drawParameters.origin,i),this.requestRender(1)}_updateColors(){this._cutVolumeParameters.diffuse=g.A.toUnitRGB(this.cutColor),this._cutVolumeParameters.opacity=this.cutColor.a,this._fillVolumeParameters.diffuse=g.A.toUnitRGB(this.fillColor),this._fillVolumeParameters.opacity=this.fillColor.a,this.requestRender(1)}_createVao(e){const t=this.renderingContext,{vertices:i,normals:r,indicesBottom:s,indicesExtruded:o}=e,n=Qe.createBuffer(s.length+o.length),{position:a,normal:l}=n;for(let h=0;h<s.length;h++){const e=3*s[h];a.set(h,0,i[e]),a.set(h,1,i[e+1]),a.set(h,2,i[e+2]),l.set(h,0,r[e]),l.set(h,1,r[e+1]),l.set(h,2,r[e+2])}for(let h=0;h<o.length;h++){const e=h+s.length,t=3*o[h];a.set(e,0,i[t]),a.set(e,1,i[t+1]),a.set(e,2,i[t+2]),l.set(e,0,r[t]),l.set(e,1,r[t+1]),l.set(e,2,r[t+2])}const c=new ve.R(t,(0,te.U)(Qe),n.buffer);return new ae.Z(t,c)}};(0,r.Cg)([(0,a.MZ)()],$e.prototype,"consumes",void 0),(0,r.Cg)([(0,a.MZ)()],$e.prototype,"produces",void 0),(0,r.Cg)([(0,a.MZ)()],$e.prototype,"cutColor",void 0),(0,r.Cg)([(0,a.MZ)()],$e.prototype,"fillColor",void 0),(0,r.Cg)([(0,a.MZ)()],$e.prototype,"borderColor",void 0),$e=(0,r.Cg)([(0,c.$)("esri.views.3d.webgl-engine.lib.CutFillColor")],$e);const Qe=(0,ie.BP)().vec3f("position").vec3f("normal").freeze();class Ye{constructor(e,t,i,r){this.vertices=e,this.indicesBottom=t,this.indicesExtruded=i,this.normals=r}}var Xe=i(35925),Je=i(38042),Ke=i(63860),et=i(39348);let tt=class extends f.A{get visible(){return this.analysisViewData.visible&&null!=this.analysisViewData.elevationAlignedGeometry&&null!=this.analysisViewData.targetGeometry}get updating(){return this.loadingMessages}get hasUnsupportedError(){const{error:e}=this.analysisViewData;return!!e&&["unsupported-coordinate-system","unsupported-layer-transparency"].includes(e.name)}constructor(e){super(e),this.unitsMessages=null,this.messages=null,this.loadingMessages=!0,this._elevationContext=Q.F.fromElevationInfo(new F.A({mode:"absolute-height"})),this._extrusionHeight=_.targetElevationRange,this._projectionLines=[]}initialize(){const{view:e}=this,t={view:e,isDecoration:!0},i=_,r={...t,width:i.geometryOutlineWidth};this._elevationAlignedGeometry=new Le.P({...r,isDraped:!0,color:g.A.toUnitRGBA(i.geometryOutlineColor)}),this._targetGeometry=new Le.P(r);const s={...t,attached:!0,width:i.projectionLineWidth,renderOccluded:4,polygonOffset:!0},o={...s,stipplePattern:(0,Xe.wk)(i.projectionLineStippleSize)},n=g.A.toUnitRGBA(i.cutProjectionLineColor),a=g.A.toUnitRGBA(i.fillProjectionLineColor);this._cutProjectionLines=new De.t({...s,color:n}),this._occludedCutProjectionLines=new De.t({...o,color:n}),this._fillProjectionLines=new De.t({...s,color:a}),this._occludedFillProjectionLines=new De.t({...o,color:a});const l={...t,attached:!0};this._cutVolumeLabel=new Ze.N(l),this._fillVolumeLabel=new Ze.N(l),this._cutFillRenderNode=new $e({view:e,cutColor:i.cutColor,fillColor:i.fillColor,borderColor:i.geometryOutlineColor}),this.addHandles([(0,y.wB)(()=>({elevationAlignedGeometry:this.analysisViewData.elevationAlignedGeometry,targetGeometry:this.analysisViewData.targetGeometry}),e=>{let{elevationAlignedGeometry:t,targetGeometry:i}=e;this._elevationAlignedGeometry.geometry=t,this._targetGeometry.geometry=i},y.Vh),(0,y.wB)(()=>({interactive:this.analysisViewData.interactive,measureType:this.analysis.measureType,visible:this.visible}),e=>{let{visible:t,interactive:i,measureType:r}=e;this._elevationAlignedGeometry.visible=t&&!i,this._targetGeometry.visible=t&&"cut-fill"===r},y.Vh),(0,y.wB)(()=>({elevationAlignedGeometry:this.analysisViewData.elevationAlignedGeometry,targetGeometry:this.analysisViewData.targetGeometry,visible:this.visible}),e=>{let{elevationAlignedGeometry:t,targetGeometry:i,visible:r}=e;return this._updateProjectionLines(t,i,r)},y.Vh),(0,y.wB)(()=>({interactive:this.analysisViewData.interactive,accentColor:this.view.effectiveTheme.accentColor,hasResult:!!this.analysisViewData.result}),e=>{let{interactive:t,accentColor:i,hasResult:r}=e;this._updateColors(t,i,r)},y.Vh),(0,y.wB)(()=>this.analysisViewData.targetGeometry,()=>this._updateCutFillGeometry(),y.Vh),(0,y.wB)(()=>this.visible&&!this.hasUnsupportedError,e=>this._updateCutFillVisibility(e),y.Vh),(0,y.wB)(()=>{const{messages:e,unitsMessages:t,visible:i,analysisViewData:r}=this;return{labelAnchors:r.labelAnchors,effectiveDisplayUnits:r.effectiveDisplayUnits,messages:e,unitsMessages:t,result:r.result,visible:i&&!!r.result}},e=>this._updateLabels(e)),(0,y.wB)(()=>this.view.state.camera,e=>this._updateProjectionLineOcclusion(e),y.Vh),(0,Je.oQ)(()=>this._updateMessageBundle())]),this._updateMessageBundle()}destroy(){this._elevationAlignedGeometry=(0,o.pR)(this._elevationAlignedGeometry),this._targetGeometry=(0,o.pR)(this._targetGeometry),this._cutProjectionLines=(0,o.pR)(this._cutProjectionLines),this._occludedCutProjectionLines=(0,o.pR)(this._occludedCutProjectionLines),this._fillProjectionLines=(0,o.pR)(this._fillProjectionLines),this._occludedFillProjectionLines=(0,o.pR)(this._occludedFillProjectionLines),this._cutVolumeLabel=(0,o.pR)(this._cutVolumeLabel),this._fillVolumeLabel=(0,o.pR)(this._fillVolumeLabel),this._cutFillRenderNode.destroy()}_updateProjectionLines(e,t,i){if(this._cutProjectionLines.visible=i,this._occludedCutProjectionLines.visible=i,this._fillProjectionLines.visible=i,this._occludedFillProjectionLines.visible=i,!e||!t)return;const{renderCoordsHelper:r}=this.view,s=[],o=e.spatialReference,n=e.rings[0],a=n.length>1&&(0,Fe.aI)(n[0],n[n.length-1]),l=n.length-(a?1:0);for(let _=0;_<l;++_){const e=n[_],i=(0,C.j)((0,h.vt)(),e[0],e[1],e[2]);r.toRenderCoords(i,o,i);const a=t.rings[0][_],l=(0,C.j)((0,h.vt)(),a[0],a[1],a[2]);r.toRenderCoords(l,o,l);const c=new Ie.C(i,l);s.push(c)}e.isClockwise(n)||s.reverse();const c=[],u=[],d=[],p=[],g=[],m=this.view.state.camera;for(let h=0;h<s.length;++h){const i=s[h],r=s[0===h?s.length-1:h-1],o=s[h===s.length-1?0:h+1],n=e.rings[0][h],a=t.rings[0][h],l=n[2]>a[2],_=new rt(i,r,o,l);c.push(_),_.updateOccluded(m);const f=_.isOccluded;l?(f?d:u).push(i):(f?g:p).push(i)}this._projectionLines=c,this._cutProjectionLines.setGeometryFromSegments(u),this._occludedCutProjectionLines.setGeometryFromSegments(d),this._fillProjectionLines.setGeometryFromSegments(p),this._occludedFillProjectionLines.setGeometryFromSegments(g)}_updateProjectionLineOcclusion(e){const t=[],i=[],r=[],s=[];let o=!1,n=!1;for(const a of this._projectionLines){a.updateOccluded(e)&&(o||=a.isCut,n||=!a.isCut);const l=a.isOccluded;(a.isCut?l?i:t:l?s:r).push(a.segment)}n&&(this._fillProjectionLines.setGeometryFromSegments(r),this._occludedFillProjectionLines.setGeometryFromSegments(s)),o&&(this._cutProjectionLines.setGeometryFromSegments(t),this._occludedCutProjectionLines.setGeometryFromSegments(i))}_updateColors(e,t,i){const{geometryOutlineColor:r,cutColor:s,fillColor:o,cutColorMuted:n,fillColorMuted:a,cutProjectionLineColor:l,fillProjectionLineColor:c}=_;if(this._cutFillRenderNode.cutColor=i?s:n,this._cutFillRenderNode.fillColor=i?o:a,e){const e=g.A.toUnitRGBA(t);this._targetGeometry.color=e,this._cutProjectionLines.color=e,this._occludedCutProjectionLines.color=e,this._fillProjectionLines.color=e,this._occludedFillProjectionLines.color=e,this._cutFillRenderNode.borderColor=t}else{this._targetGeometry.color=g.A.toUnitRGBA(r);const e=g.A.toUnitRGBA(i?l:n);this._cutProjectionLines.color=e,this._occludedCutProjectionLines.color=e;const t=g.A.toUnitRGBA(i?c:a);this._fillProjectionLines.color=t,this._occludedFillProjectionLines.color=t,this._cutFillRenderNode.borderColor=r}}_updateLabels(e){const{labelDistance:t}=_,{effectiveDisplayUnits:i,labelAnchors:r,messages:s,unitsMessages:o,result:n,visible:a}=e;if(this._cutVolumeLabel.visible=a,this._fillVolumeLabel.visible=a,this._cutVolumeLabel.geometry=r.cut?{type:"point",point:r.cut,callout:{distance:t,offset:0}}:null,this._fillVolumeLabel.geometry=r.fill?{type:"point",point:r.fill,callout:{distance:-t,offset:0}}:null,null==n||null==s||null==o)return this._cutVolumeLabel.text="-",void(this._fillVolumeLabel.text="-");const l=i.volume,c=(0,et.V)(s.labels.cut,{volume:it(o,n.cutVolume,l)}),h=(0,et.V)(s.labels.fill,{volume:it(o,n.fillVolume,l)});this._cutVolumeLabel.text=c,this._fillVolumeLabel.text=h}_updateCutFillVisibility(e){e?this._cutFillRenderNode.enable():this._cutFillRenderNode.disable()}_updateCutFillGeometry(){const{renderCoordsHelper:e}=this.view,{targetGeometry:t}=this.analysisViewData;if(!t?.extent)return;const{center:i}=t.extent,r=(0,h.fA)(i.x,i.y,0),s=(0,h.vt)();e.toRenderCoords(r,t.spatialReference,s);const o=this._getExtrudedVolumes(t,this._extrusionHeight,r),n=this._getExtrudedVolumes(t,-this._extrusionHeight,r);this._cutFillRenderNode.updateGeometries(o,n,s)}_getExtrudedVolumes(e,t,i){const{renderCoordsHelper:r,spatialReference:s,elevationProvider:o}=this.view,n=(0,h.vt)(),a=1===r.viewingMode;a||r.worldUpAtPosition([0,0,0],n);const l=(0,X.C8)(e,o,r,this._elevationContext),{polygons:c,mapPositions:u,position:d}=l,p=c[0],g=p.count,m=(0,x.e)(p.mapPositions,p.holeIndices,3),_=m.length,f=6*g,y=(0,ke.my)(f+_),v=(0,ke.my)(_),C=(0,V.jh)(3*f),b=(0,V.jh)(3*f);(0,Ee.K)(d,u,m,p,C,null,b,null,y,v,t,n,a);const M=(0,w.vt)(),P=(0,w.vt)();return(0,R.l)(s,i,M,r.spatialReference),P[12]=-M[12],P[13]=-M[13],P[14]=-M[14],(0,A.t)(C,C,P),new Ye(C,v,y,b)}async _updateMessageBundle(){this.loadingMessages=!0;try{this.unitsMessages=await(0,Ke.ud)("esri/core/t9n/Units"),this.messages=await(0,Ke.ud)("esri/views/3d/analysis/VolumeMeasurement/t9n/VolumeMeasurementAnalysis")}finally{this.loadingMessages=!1}}};function it(e,t,i){if(!t||!e)return null;const r=(0,n.bE)(t.value,t.unit,i),s=_.labelPrecisions[r];return(0,Te.zJ)(e,t,r,s)}(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],tt.prototype,"view",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],tt.prototype,"analysis",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],tt.prototype,"analysisViewData",void 0),(0,r.Cg)([(0,a.MZ)()],tt.prototype,"unitsMessages",void 0),(0,r.Cg)([(0,a.MZ)()],tt.prototype,"messages",void 0),(0,r.Cg)([(0,a.MZ)()],tt.prototype,"loadingMessages",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],tt.prototype,"visible",null),(0,r.Cg)([(0,a.MZ)()],tt.prototype,"updating",null),(0,r.Cg)([(0,a.MZ)()],tt.prototype,"hasUnsupportedError",null),tt=(0,r.Cg)([(0,c.$)("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementCutFillVisualization")],tt);class rt{constructor(e,t,i,r){this.segment=e,this.previous=t,this.next=i,this.isCut=r,this._isOccluded=!1,this._n1=(0,h.vt)(),this._n2=(0,h.vt)();const s=(0,C.n)(st,(0,C.e)(st,e.endRenderSpace,e.startRenderSpace));(0,C.n)(this._n1,(0,C.i)(this._n1,s,(0,C.n)(ot,(0,C.e)(ot,t.startRenderSpace,e.startRenderSpace)))),(0,C.n)(this._n2,(0,C.i)(this._n2,s,(0,C.n)(ot,(0,C.e)(ot,e.startRenderSpace,i.startRenderSpace)))),this._isConvex=Ge.wf.normalize((0,Oe.EJ)(this._n1,this._n2,s))<0}get isOccluded(){return this._isOccluded}updateOccluded(e){(0,C.e)(st,this.segment.startRenderSpace,e.eye);const t=(0,C.f)(this._n1,st)<0,i=(0,C.f)(this._n2,st)<0,r=this._isOccluded;return this._isOccluded=this._isConvex?t&&i:t||i,this._isOccluded!==r}}const st=(0,h.vt)(),ot=(0,h.vt)();var nt=i(39356),at=i(54901),lt=i(50346),ct=i(63733),ht=i(86875);function ut(e){return null!=e&&"polygon"===e.type}var dt=i(75762),pt=i(20205),gt=i(77654),mt=i(38317),_t=i(7947),ft=i(17046),yt=i(56829),vt=i(97513),xt=i(16008),wt=i(81773),Ct=i(37159),bt=i(65240);let Mt=class extends((0,bt.B)(Ct.w)){constructor(e){super(e),this.type="elevation",this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get allFields(){return[this.elevation]}};(0,r.Cg)([(0,a.MZ)()],Mt.prototype,"type",void 0),(0,r.Cg)([(0,a.MZ)()],Mt.prototype,"allFields",null),Mt=(0,r.Cg)([(0,c.$)("esri.views.interactive.tooltip.infos.ElevationTooltipInfo")],Mt);let Rt=class extends yt.g{constructor(e){super(e),this.sketchOptions=new vt.A}initialize(){const{view:e}=this;this._shiftManipulator=new pt.x(e,0),this._shiftManipulator.state|=gt.xM,this.manipulators.add(this._shiftManipulator),this.addHandles([this._createDragPipeline(),(0,y.wB)(()=>this.analysisViewData.targetGeometry,()=>this._updateManipulatorPosition(),y.OH),(0,y.wB)(()=>[this.analysisViewData.interactive,this.analysisViewData.targetGeometry,this.analysis.measureType],()=>this._updateManipulatorVisibility(),y.pc)]),this._initializeTooltip(),this.finishToolCreation()}_initializeTooltip(){const{view:e}=this;this.tooltip=(0,wt.A)(()=>({view:e,options:this.sketchOptions.tooltips})),this._tooltipInfo=new Mt({sketchOptions:this.sketchOptions}),this.sketchOptions.tooltips.placement="trailing",this._updateSketchOptions(),this.addHandles([(0,y.wB)(()=>this.analysisViewData.effectiveTargetElevation,()=>this._updateTooltip()),(0,y.wB)(()=>this._shouldShowTooltip,e=>{e?this._showTooltip():this._hideTooltip()}),this.tooltip.on("commit",()=>{const e=this._tooltipInfo.elevation.actual,t=(0,n.mq)(this.view.spatialReference);if(null==e||null==t)return;const i=(0,W.l3)(e,t);this._updateValue(i,{recordUndo:this.analysis.cutFillOptions.targetElevation})}),(0,y.wB)(()=>[this.analysis.displayUnits.elevation,this.analysis.inputUnits.elevation],()=>this._updateSketchOptions(),y.pc)])}destroy(){this._shiftManipulator.destroy(),this.tooltip.destroy()}onInputEvent(e){if(!this.destroyed&&!(0,wt.wG)(e,this.tooltip))return super.onInputEvent(e)}get _shouldShowTooltip(){return this.hasFocusedManipulators||"input"===this.tooltip.mode}_createDragPipeline(){return(0,ft.Xt)(this._shiftManipulator,(e,t,i)=>{const r=(0,h.o8)(e.renderLocation),s=this.analysis.inputUnits.elevation??"meters",o=(0,n.mq)(this.view.spatialReference);let a;t.next((0,_t.iv)(this.view,r,this.view.spatialReference)).next((0,ft.j5)()).next(e=>{if("start"===e.action){const{targetElevation:e}=this.analysis.cutFillOptions;a=e&&o?(0,n.oU)(e,s,o):void 0}return this._updateValue(null!=a?a+e.translationZ:e.mapEnd.z,"end"===e.action?{recordUndo:a}:void 0),e}),i.next(()=>{this._updateValue(a)})})}_updateManipulatorPosition(){const{targetGeometry:e}=this.analysisViewData,{renderCoordsHelper:t}=this.view;if(!e)return;const i=e.rings[0],r=(0,h.ci)(i[0]),s=(0,h.ci)(i[1]);t.toRenderCoords(r,e.spatialReference,r),t.toRenderCoords(s,e.spatialReference,s);const o=dt.rq.get();(0,C.e)(o,s,r);const n=dt.rq.get();(0,C.l)(n,r,s,.5);const a=t.worldBasisAtPosition(n,1,dt.rq.get()),l=t.worldBasisAtPosition(n,0,dt.rq.get()),c=(0,mt.wQ)(a,l,n,dt.Rc.get()),u=t.headingAtPosition(n,o),d=e.isClockwise(e.rings[0])?-Math.PI/2:Math.PI/2;(0,K.Qr)(c,c,(0,J.kU)(u)+d),c[12]=0,c[13]=0,c[14]=0,this._shiftManipulator.renderLocation=(0,h.o8)(n),this._shiftManipulator.modelTransform=c}_updateManipulatorVisibility(){const{interactive:e,targetGeometry:t}=this.analysisViewData,{measureType:i}=this.analysis,r=e&&null!=t&&"cut-fill"===i;this._shiftManipulator.available=r}_updateValue(e,t){const i=(0,be.Qc)(e,this.view.spatialReference);if(null==i)return;const r=this.analysis.inputUnits.elevation??"meters",s=(0,n.oU)(i.value,i.unit,r),o=e=>{this.analysis.cutFillOptions.targetElevation=e};if(o(s),t&&"recordUndo"in t){const e=t.recordUndo;this.emit("record-undo",{apply:()=>o(s),undo:()=>o(e)})}}_getUpdatedTooltipInfo(){const{effectiveTargetElevation:e}=this.analysisViewData;return e?(this._tooltipInfo.elevation.actual=(0,be.Qc)(e,this.view.spatialReference),this._tooltipInfo):this._tooltipInfo}_updateTooltip(){this._shouldShowTooltip&&(this.tooltip.info=this._getUpdatedTooltipInfo())}_showTooltip(){this._updateTooltip()}_hideTooltip(){this.tooltip?.clear()}_updateSketchOptions(){const{analysis:e}=this,{displayUnits:t,inputUnits:i}=e;this.sketchOptions.values.inputUnits=new xt.A({verticalLength:i.elevation}),this.sketchOptions.values.displayUnits=new xt.A({verticalLength:t.elevation})}};(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],Rt.prototype,"analysis",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],Rt.prototype,"view",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],Rt.prototype,"analysisViewData",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0,type:vt.A})],Rt.prototype,"sketchOptions",void 0),(0,r.Cg)([(0,a.MZ)()],Rt.prototype,"_shouldShowTooltip",null),Rt=(0,r.Cg)([(0,c.$)("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementShiftTool")],Rt);var Pt=i(2144),St=i(18295),Vt=i(18279);let At=class extends f.A{constructor(e){super(e),this._updatingHandles=new b.U,this._operationManager=new Pt.b,this._onUndoRedo=()=>{this._updateGeometryFromSketchGraphic()}}initialize(){const{analysis:e,analysisViewData:t,view:i}=this;this._graphicsLayer=new ct.A({listMode:"hide",internal:!0,elevationInfo:{mode:"on-the-ground"}});const r=(0,St.B)(i,{selfEnabled:!0,excludeInternal:!0});this._sketchViewModel=new Vt.A({layer:this._graphicsLayer,view:i,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polygonSymbol:this._polygonSymbol,snappingOptions:r.options}),this.addHandles([this._sketchViewModel.on(["undo","redo"],this._onUndoRedo),(0,y.wB)(()=>({map:i.map,internalGraphicsLayer:this._graphicsLayer,state:this.state}),e=>{let{map:t,internalGraphicsLayer:i,state:r}=e;switch(function(e,t){t&&(t.removeFromParent(),e?.add(t))}(t,i),r){case"idle":case"reshaping-disabled":this._operationManager.stop(),this._graphicsLayer.removeAll(),this._ensureUpdatedSketchGraphic();break;case"reshaping":(0,lt.QZ)(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},y.pc),r]),this._shiftTool=new Rt({analysis:e,view:i,analysisViewData:t}),this.addHandles(this._shiftTool.on("record-undo",e=>{const t=this._sketchViewModel.activeComponent;"reshape-3d"===t?.type&&t.recordUndo(e.apply,e.undo)})),i.tools.add(this._shiftTool),this.addHandles({remove:()=>i.tools.remove(this._shiftTool)})}destroy(){this._operationManager.destroy(),this._sketchViewModel.destroy();const e=this._graphicsLayer;this.view.map.remove(e),e.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(e){e!==this._get("sketchGraphic")&&(this._set("sketchGraphic",e),this._updateGeometryFromSketchGraphic())}get state(){const{geometry:e}=this.analysis,{interactive:t,visible:i}=this.analysisViewData;return i?this._sketchViewModel.createGraphic?this._sketchViewModel.createGraphic===this.sketchGraphic?"sketching":"awaiting-sketch":e?t?"reshaping":"reshaping-disabled":"idle":"idle"}get updating(){return this._sketchViewModel.updating||this._updatingHandles.updating}get _polygonSymbol(){return new ht.A({color:[0,0,0,0],outline:{color:[0,0,0,0]}})}place(e){return this._operationManager.start("place",async t=>{const i=this.analysis.clone();this._ensureUpdatedSketchGraphic();const r=this._sketchViewModel.on("create",e=>{switch(e.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=e.graphic;break;case"active":this._updateGeometryFromSketchGraphic();break;case"complete":this._updateGeometryFromSketchGraphic(),t.stop();break;case"cancel":t.stop()}});t.handles.push(r,(0,at.hA)(()=>(r.remove(),this._sketchViewModel.cancel(),this._updateGeometryFromSketchGraphic(),this.analysis.valid?(0,lt.G4)(e)||i.equals(this.analysis)?t.reject():void t.resolve({}):(this._clearGeometry(),t.reject())))),await this._updatingHandles.addPromise(this._sketchViewModel.create("polygon"))},e)}_startReshape(){return this._operationManager.start("reshape",async e=>{const t=()=>{const e=this._ensureUpdatedSketchGraphic();return e?(this._graphicsLayer.removeAll(),this._graphicsLayer.add(e),this._updatingHandles.addPromise(this._sketchViewModel.update(e,{tool:"reshape"}))):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const i=this._sketchViewModel.on("update",i=>{this._updateGeometryFromSketchGraphic(),"complete"===i.state&&("reshaping"===this.state?(0,lt.QZ)(t()):e.resolve())});e.handles.push(i,(0,at.hA)(()=>{i.remove(),this._sketchViewModel.cancel(),e.resolve()})),await t()})}_ensureUpdatedSketchGraphic(){const{geometry:e}=this.analysis;return ut(e)?(this.sketchGraphic??=new nt.A({geometry:e,symbol:this._polygonSymbol}),this.sketchGraphic.geometry=e,this.sketchGraphic):(this.sketchGraphic=null,null)}_clearGeometry(){this.sketchGraphic=null,this.analysis.geometry=null}_updateGeometryFromSketchGraphic(){const e=this.sketchGraphic;this.analysis.geometry=function(e){return ut(e?.geometry)}(e)?e.geometry:null}get test(){}};(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],At.prototype,"analysisViewData",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],At.prototype,"view",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],At.prototype,"analysis",void 0),(0,r.Cg)([(0,a.MZ)()],At.prototype,"sketchGraphic",null),(0,r.Cg)([(0,a.MZ)({nonNullable:!0})],At.prototype,"state",null),(0,r.Cg)([(0,a.MZ)()],At.prototype,"updating",null),(0,r.Cg)([(0,a.MZ)()],At.prototype,"_polygonSymbol",null),At=(0,r.Cg)([(0,c.$)("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementTool")],At);let Ft=class extends p.P{constructor(e){super(e),this.type="volume-measurement-view-3d",this.analysis=null,this.elevationAlignedGeometry=null,this.targetGeometry=null}initialize(){const{analysis:e,view:t}=this;this._analysisController=new Me({view:t,analysis:e,analysisViewData:this}),this._analysisTool=new At({analysis:e,view:t,analysisViewData:this}),this._analysisVisualization=new tt({view:t,analysis:e,analysisViewData:this})}destroy(){this._analysisController=(0,o.pR)(this._analysisController),this._analysisVisualization=(0,o.pR)(this._analysisVisualization),this._analysisTool.destroy()}get error(){return this._analysisController?.error??null}get result(){return this._analysisController?.result}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get visible(){return super.visible}set visible(e){super.visible=e}get effectiveTargetElevation(){const{cutFillOptions:e,inputUnits:t}=this.analysis,{targetElevation:i}=e,r=t?.elevation??"meters",s=(0,n.mq)(this.view.spatialReference);if(null!=i&&null!=s)return(0,n.oU)(i,r,s);const o=this.elevationAlignedGeometry?.extent;return null==o?.zmin||null==o?.zmax?null:(o.zmax+o.zmin)/2}get effectiveDisplayUnits(){const{displayUnits:e}=this.analysis,t=(0,d.c)(this.view);return{elevation:e.elevation??t,volume:e.volume??t}}get labelAnchors(){const{elevationAlignedGeometry:e,view:t}=this,{renderCoordsHelper:i}=t;if(!e)return{cut:null,fill:null};let r=e.rings[0][0],s=e.rings[0][0];e.rings[0].forEach(e=>{e[2]>r[2]&&(r=e),e[2]<s[2]&&(s=e)});const{spatialReference:o}=e,n=new u.A({x:r[0],y:r[1],z:r[2],spatialReference:o}),a=new u.A({x:s[0],y:s[1],z:s[2],spatialReference:o}),l=(0,h.vt)(),c=(0,h.vt)();return i.toRenderCoords(n,l),i.toRenderCoords(a,c),{cut:l,fill:c}}get updating(){return null!=this._analysisController&&this._analysisController.updating||this._analysisTool.updating||this._analysisVisualization.updating}place(e){return this._analysisTool.place(e)}get test(){}};(0,r.Cg)([(0,a.MZ)()],Ft.prototype,"error",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],Ft.prototype,"type",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],Ft.prototype,"analysis",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],Ft.prototype,"result",null),(0,r.Cg)([(0,a.MZ)()],Ft.prototype,"elevationAlignedGeometry",void 0),(0,r.Cg)([(0,a.MZ)({type:Number})],Ft.prototype,"effectiveTargetElevation",null),(0,r.Cg)([(0,a.MZ)()],Ft.prototype,"targetGeometry",void 0),(0,r.Cg)([(0,a.MZ)()],Ft.prototype,"effectiveDisplayUnits",null),(0,r.Cg)([(0,a.MZ)()],Ft.prototype,"labelAnchors",null),(0,r.Cg)([(0,a.MZ)()],Ft.prototype,"updating",null),Ft=(0,r.Cg)([(0,c.$)("esri.views.3d.analysis.VolumeMeasurementAnalysisView3D")],Ft);const Gt=Ft},63928:(e,t,i)=>{i.d(t,{W:()=>o});var r=i(45463),s=i(48168);class o extends r.i{intersect(e,t,i,r,o,n){return(0,s.Uy)(e,i,r,o,void 0,n)}intersectDraped(e,t,i,r){return(0,s.gz)(i[0],i[1],e,r)}}},65240:(e,t,i)=>{i.d(t,{B:()=>u});var r=i(6326),s=i(24648),o=i(46053),n=(i(81806),i(76460),i(47249),i(87990)),a=i(12294),l=i(5512),c=i(69077),h=i(90659);const u=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.longitude=(0,l.em)(),this.latitude=(0,l.fL)(),this.x=(0,l.Hw)(),this.y=(0,l.uf)(),this.elevation=(0,l.S3)(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e?.spatialReference;if(this.geographic=!!t&&(0,h.yF)(t),null==e)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const t=(0,a.QP)(e,d);this._setActualLonLat((0,c.m6)(t?.[0]),(0,c.m6)(t?.[1]))}else this._setActualXY((0,s.LF)(e.x),(0,s.LF)(e.y))}_setActualLonLat(e,t){this.longitude.actual=e,this.latitude.actual=t}_setActualXY(e,t){this.x.actual=e,this.y.actual=t}};return(0,r.Cg)([(0,o.MZ)()],i.prototype,"geographic",void 0),(0,r.Cg)([(0,o.MZ)()],i.prototype,"effectiveX",null),(0,r.Cg)([(0,o.MZ)()],i.prototype,"effectiveY",null),(0,r.Cg)([(0,o.MZ)()],i.prototype,"key",null),i=(0,r.Cg)([(0,n.$)("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],i),i},d=[0,0]},66747:(e,t,i)=>{i.d(t,{N:()=>x,R:()=>C});var r=i(69539),s=i(88321),o=i(68134),n=i(76931),a=i(19555),l=i(20664),c=i(9392),h=i(4244),u=i(69230),d=i(6326),p=i(91967),g=i(46053),m=(i(81806),i(76460),i(47249),i(87990)),_=(i(27347),i(10760));i(48396);let f=class extends p.A{get startPosition(){return[this.startX,this.startY]}set startPosition(e){this._set("startX",e[0]),this._set("startY",e[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(e){this._set("endX",e[0]),this._set("endY",e[1])}constructor(e){super(e),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const e=this.color;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _lineCap(){return"round"}render(){const{height:e,left:t,top:i,width:r,x1:s,x2:o,y1:n,y2:a}=this._calculateCoordinates(y),l=`stroke: ${this._strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this._lineCap};`;return(0,_.h)("div",{classes:{"esri-line-overlay-item":!0},styles:{left:t+"px",top:i+"px",width:r+"px",height:e+"px",visibility:this.visible?"visible":"hidden"}},[(0,_.h)("svg",{width:r,height:e},[(0,_.h)("line",{x1:s,y1:n,x2:o,y2:a,style:l})])])}renderCanvas(e){if(!this.visible)return;e.strokeStyle=this._strokeStyle,e.lineWidth=this.width,e.lineCap=this._lineCap;const t=this._calculateCoordinates(y);e.beginPath(),e.moveTo(t.left+t.x1,t.top+t.y1),e.lineTo(t.left+t.x2,t.top+t.y2),e.stroke()}_calculateCoordinates(e){const t=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),r=Math.min(this.startY,this.endY),s=Math.max(this.startY,this.endY),o=this.width;return e.left=t-o,e.top=r-o,e.width=i-t+2*o,e.height=Math.max(20,s-r+2*o),e.x1=this.startX-t+o,e.y1=this.startY-r+o,e.x2=this.endX-t+o,e.y2=this.endY-r+o,e}};(0,d.Cg)([(0,g.MZ)()],f.prototype,"startX",void 0),(0,d.Cg)([(0,g.MZ)()],f.prototype,"startY",void 0),(0,d.Cg)([(0,g.MZ)()],f.prototype,"endX",void 0),(0,d.Cg)([(0,g.MZ)()],f.prototype,"endY",void 0),(0,d.Cg)([(0,g.MZ)()],f.prototype,"startPosition",null),(0,d.Cg)([(0,g.MZ)()],f.prototype,"endPosition",null),(0,d.Cg)([(0,g.MZ)()],f.prototype,"width",void 0),(0,d.Cg)([(0,g.MZ)()],f.prototype,"color",void 0),(0,d.Cg)([(0,g.MZ)()],f.prototype,"visible",void 0),(0,d.Cg)([(0,g.MZ)()],f.prototype,"isDecoration",void 0),(0,d.Cg)([(0,g.MZ)({readOnly:!0})],f.prototype,"_strokeStyle",null),f=(0,d.Cg)([(0,m.$)("esri.views.overlay.LineOverlayItem")],f);const y={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};var v=i(28048);class x extends u.B{constructor(e){super(e),this._handles=new s.A,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text="-",this._fontSize=14,this._backgroundColor=new r.A([0,0,0,.6]),this._calloutColor=new r.A([0,0,0,.5]),this._textColor=new r.A([255,255,255]),this._distance=25,this._anchor="right",this.updatePositionOnCameraMove=!0,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.updateLabelPosition()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._textItem&&(this._textItem.isDecoration=e),this._calloutItem&&(this._calloutItem.isDecoration=e)}get textItem(){return this._textItem}get text(){return this._text}set text(e){this._text=e,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e,this.attached&&(this._textItem.fontSize=this._fontSize)}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e,this.attached&&(this._textItem.backgroundColor=this._backgroundColor)}get calloutColor(){return this._calloutColor}set calloutColor(e){this._calloutColor=e,this.attached&&(this._calloutItem.color=this._calloutColor.toRgba())}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this.attached&&(this._textItem.textColor=this._textColor)}get distance(){return this._distance}set distance(e){this._distance!==e&&(this._distance=e,this.updateLabelPosition())}get anchor(){return this._anchor}set anchor(e){this._anchor!==e&&(this._anchor=e,this.updateLabelPosition())}get _camera(){return this.view.state.cssCamera}overlaps(e){return!!this.attached&&this.textItem.visible&&e.textItem.visible&&!!this.view.overlay?.overlaps(this._textItem,e.textItem)}updateLabelPosition(){if(!this.attached)return;this._showText=!1,this._showCallout=!1;const{geometry:e,view:t,visible:i}=this;if(null!=e&&t.stage)switch(e.type){case"point":if(!this._computeLabelPositionFromPoint(e.point,T))break;if(e.callout){const t=this._camera,i=e.callout.distance;(0,a.WQ)(G,G,[0,e.callout.offset]),t.renderToScreen(G,T),(0,a.hZ)(V,0,1),(0,a.hs)(V,V,i),(0,a.WQ)(V,V,G),t.renderToScreen(V,k),this._showCallout=this._updatePosition(T,k)}else this._textItem.position=[T[0],T[1]],this._textItem.anchor="center";this._showText=!0;break;case"corner":if(!this._computeLabelPositionFromCorner(e,this._distance,T,k))break;this._showCallout=this._updatePosition(T,k),this._showText=!0;break;case"segment":{if(!this._computeLabelPositionFromSegment(e,this._distance,this._anchor,T,k))break;this._showText=!0;const t=this._updatePosition(T,k);this._showCallout=!1!==e.callout&&t,this._showCallout||(this._textItem.anchor="center")}}this.updateVisibility(i)}_computeLabelPositionFromPoint(e,t){const i=this._camera,r=i.projectToRenderScreen(e,G);return!!r&&!(r[2]<0||r[2]>1)&&(i.renderToScreen(r,t),!0)}_computeLabelPositionFromCorner(e,t,i,r){if(!e)return!1;const s=this._camera,o=w(e.left,1,s,P),n=w(e.right,0,s,S);if(null==o||null==n)return!1;(0,a.ze)(P,P),(0,a.WQ)(V,o,n),(0,a.ze)(V,V),(0,a.S8)(V,V);const l=s.projectToRenderScreen(e.left.endRenderSpace,F);return!(!l||l[2]<0||l[2]>1)&&(s.renderToScreen(l,i),(0,a.hs)(V,V,t),(0,a.WQ)(V,V,l),s.renderToScreen(V,r),!0)}_computeLabelPositionFromSegment(e,t,i,r,s){if(!e)return!1;const o=e.segment,n=this._camera;(0,h.Q)(o.startRenderSpace,o.endRenderSpace,n,P),(0,a.hZ)(V,-P[1],P[0]);let l=!1;switch(i){case"top":l=V[1]<0;break;case"bottom":l=V[1]>0;break;case"left":l=V[0]>0;break;case"right":l=V[0]<0}if(l&&(0,a.ze)(V,V),0===(0,a.Bw)(V))switch(i){case"top":V[1]=1;break;case"bottom":V[1]=-1;break;case"left":V[0]=-1;break;case"right":V[0]=1}o.eval(O[e.sampleLocation],A);const c=n.projectToRenderScreen(A,F);return!(!c||c[2]<0||c[2]>1)&&(n.renderToScreen(F,r),(0,a.hs)(V,V,t),(0,a.WQ)(V,V,F),n.renderToScreen(V,s),!0)}_updatePosition(e,t){if(t){const i=t[0]-e[0],r=t[1]-e[1];return this._textItem.position=[t[0],t[1]],this._textItem.anchor=Math.abs(i)>Math.abs(r)?i>0?"left":"right":r>0?"top":"bottom",this._calloutItem.startPosition=[e[0],e[1]],this._calloutItem.endPosition=[t[0],t[1]],!0}return this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new v.A({visible:!0,text:this._text,fontSize:this._fontSize,backgroundColor:this._backgroundColor,textColor:this._textColor,isDecoration:this._isDecoration}),this._calloutItem=new f({color:this._calloutColor.toRgba(),visible:!0,width:2,isDecoration:this._isDecoration}),this.updateLabelPosition(),this.view.overlay?.items.addMany([this._textItem,this._calloutItem]),this.updatePositionOnCameraMove&&this._handles.add((0,o.wB)(()=>this.view.state.camera,()=>this.updateLabelPosition()))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(e){this._textItem.visible=this._showText&&e,this._calloutItem.visible=this._showCallout&&e}forEachMaterial(){}}function w(e,t,i,r){return e.eval(t,b,R),(0,l.g)(M,b,R),(0,h.Q)(b,M,i,r)}function C(e){switch(e){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const b=(0,c.vt)(),M=(0,c.vt)(),R=(0,c.vt)(),P=(0,n.QG)(),S=(0,n.QG)(),V=(0,n.QG)(),A=(0,c.vt)(),F=(0,n.r_)(),G=(0,n.QG)(),T=(0,n.gs)(),k=(0,n.gs)(),O={start:0,center:.5,end:1}},69366:(e,t,i)=>{i.d(t,{C:()=>u,a:()=>p,b:()=>d});var r=i(55855),s=i(73398),o=i(58350),n=i(21390),a=i(86955),l=i(70367),c=i(31432),h=i(2687);class u extends c.Y{constructor(){super(...arguments),this.borderColor=(0,r.vt)()}}function d(){const e=new h.N5;return e.include(s.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new l.N("colorTexture",e=>e.color),new l.N("cutFillVolumes",e=>e.cutFillVolumes),new l.N("cutFillMask",e=>e.cutFillMask),new n.m("pixelRatio",(e,t)=>t.camera.pixelRatio),new o.E("borderColor",e=>e.borderColor)).main.add(a.H`vec4 color = texture(colorTexture, uv, 0.0);
vec4 volumesColor = texture(cutFillVolumes, uv, 0.0);
ivec2 iuv = ivec2(uv * vec2(textureSize(cutFillMask, 0)));
vec2 m0 = texelFetch(cutFillMask, iuv, 0).rg;
vec2 m1 = texelFetch(cutFillMask, iuv + ivec2(-1, 0), 0).rg;
vec2 m2 = texelFetch(cutFillMask, iuv + ivec2(1, 0), 0).rg;
vec2 m3 = texelFetch(cutFillMask, iuv + ivec2(0, -1), 0).rg;
vec2 m4 = texelFetch(cutFillMask, iuv + ivec2(0, 1), 0).rg;
float d = (
step(1.5, abs(m0.r - m1.r) + abs(m0.g - m1.g))
+ step(1.5, abs(m0.r - m2.r) + abs(m0.g - m2.g))
+ step(1.5, abs(m0.r - m3.r) + abs(m0.g - m3.g))
+ step(1.5, abs(m0.r - m4.r) + abs(m0.g - m4.g))
) * 0.25 * pixelRatio;
vec4 base = mix(color, volumesColor, max(m0.r, m0.g) * volumesColor.a);
fragColor = mix(base, borderColor, d);`),e}const p=Object.freeze(Object.defineProperty({__proto__:null,CutFillCompositionPassParameters:u,build:d},Symbol.toStringTag,{value:"Module"}))},71686:(e,t,i)=>{i.d(t,{C:()=>u,a:()=>g,b:()=>d});var r=i(34761),s=i(13191),o=i(9392),n=i(86955),a=i(23687),l=i(12216),c=i(31432),h=i(2687);class u extends c.Y{constructor(){super(...arguments),this.origin=o.uY}}function d(){const e=new h.N5;return e.attributes.add("position","vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new a.F("proj",e=>e.camera.projectionMatrix),new l.S("view",(e,t)=>(0,r.Tl)(p,t.camera.viewMatrix,e.origin))).main.add(n.H`gl_Position = proj * view * vec4(position, 1.0);
gl_Position.z = min(gl_Position.z, gl_Position.w);`),e.fragment.main.add(n.H`fragColor = vec4(1, 1, 0, 0);`),e}const p=(0,s.vt)(),g=Object.freeze(Object.defineProperty({__proto__:null,CutFillMaskDrawParameters:u,build:d},Symbol.toStringTag,{value:"Module"}))},72915:(e,t,i)=>{i.d(t,{C:()=>l,a:()=>h,b:()=>c});var r=i(73398),s=i(86955),o=i(70367),n=i(31432),a=i(2687);class l extends n.Y{}function c(){const e=new a.N5;return e.include(r.c),e.fragment.uniforms.add(new o.N("cutFillDepthTexture",e=>e.depthTexture)),e.fragment.main.add(s.H`ivec2 iuv = ivec2(gl_FragCoord.xy) * 2;
vec2 sum = vec2(0.0);
for (int dx = 0; dx < 2; dx++) {
for (int dy = 0; dy < 2; dy++) {
sum += texelFetch(cutFillDepthTexture, iuv + ivec2(dx, dy), 0).rg;
}
}
fragColor = vec4(sum.r, sum.g, 0.0, 0.0);`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,CutFillReductionParameters:l,build:c},Symbol.toStringTag,{value:"Module"}))},73074:(e,t,i)=>{i.d(t,{P:()=>w});var r=i(54099),s=i(20664),o=i(9392),n=i(43047),a=i(55855),l=i(45308),c=i(42294),h=i(44815),u=i(18117),d=i(12482),p=i(731),g=i(85746),m=i(1307),_=i(49296),f=i(70667),y=i(29889),v=i(442),x=i(52479);class w extends g.X{constructor(e){super(e),this._attachmentOrigin=(0,u.TH)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new r.bk,this._geometry=null,this._width=1,this._color=(0,a.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,a.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new m.o({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:C,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:C,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){const t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,n.a)(e,this._color)||((0,n.d)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,n.a)(e,this._innerColor)||((0,n.d)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,n.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,a.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,s.j)(M,0,0,0);let t=0;for(const i of e)i.computeAttachmentOrigin(b)&&((0,s.g)(M,M,b),t++);return 0===t?null:((0,s.h)(M,M,1/t),this.view.renderCoordsHelper.fromRenderCoords(M,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}_recreateGeometry(e,t,i){this._createRenderGeometries(t,i);for(const r of i)e.addGeometry(r);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new x.W(this._materialParameters,this.view.state.isGlobal),i=new Array;return this._recreateGeometry(e,t,i),{material:t,geometries:i}}_createDrapedResources(){const e=new x.W(this._materialParameters,this.view.state.isGlobal);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:i}=this,r=i.basemapTerrain.spatialReference;return null==t||null==r?[]:(0,y.A)(t,r).lines.map(t=>{let{position:s}=t;const o={overlayInfo:{spatialReference:r,renderCoordsHelper:i.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this._isClosed};return new v.$((0,f.te)(e,o))})}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const i of this.object3dResources.resources.geometries){const r=i.attributes.get("position"),s=(0,h.jh)(r.data.length);(0,l.projectBuffer)(r.data,t.spatialReference,0,s,this.view.spatialReference,0),(0,c.Hq)(e,s)}return!0}_createRenderGeometries(e,t){const i=this.geometry;if(null==i)return;const r=(0,y.C)(i,this.view.elevationProvider,this.view.renderCoordsHelper,_.F.fromElevationInfo(this.elevationInfo??new p.A({mode:(0,d.w7)(i,null)}))),s=new Array;for(const{position:o,mapPositions:n}of r.lines){const i={mapPositions:n,attributeData:{position:o},removeDuplicateStartEnd:this._isClosed};t.push((0,f.te)(e,i)),s.push(o)}this._laserline.pathVerticalPlane=s}}function C(e){e.geometries=[]}const b=(0,o.vt)(),M=(0,o.vt)()},77176:(e,t,i)=>{i.d(t,{b:()=>o});var r=i(15941),s=i(38496);function o(e,t,i){const o=Array.isArray(e),h=o?e.length/t:e.byteLength/(4*t),u=o?e:new Uint32Array(e,0,h*t),d=i?.minReduction??0,p=i?.originalIndices||null,g=p?p.length:0,m=i?.componentOffsets||null;let _=0;if(m)for(let r=0;r<m.length-1;r++){const e=m[r+1]-m[r];e>_&&(_=e)}else _=h;const f=Math.floor(1.1*_)+1;(null==c||c.length<2*f)&&(c=new Uint32Array((0,r.cU)(2*f)));for(let r=0;r<2*f;r++)c[r]=0;let y=0;const v=!!m&&!!p,x=v?g:h;let w=(0,s.my)(h);const C=new Uint32Array(g),b=1.96;let M=0!==d?Math.ceil(4*b*b/(d*d)*d*(1-d)):x,R=1,P=m?m[1]:x;for(let r=0;r<x;r++){if(r===M){const e=1-y/r;if(e+b*Math.sqrt(e*(1-e)/r)<d)return null;M*=2}if(r===P){for(let e=0;e<2*f;e++)c[e]=0;if(p)for(let e=m[R-1];e<m[R];e++)C[e]=w[p[e]];P=m[++R]}const e=v?p[r]:r,i=e*t,s=l(u,i,t);let o=s%f,a=y;for(;0!==c[2*o+1];){if(c[2*o]===s){const e=c[2*o+1]-1;if(n(u,i,e*t,t)){a=w[e];break}}o++,o>=f&&(o-=f)}a===y&&(c[2*o]=s,c[2*o+1]=e+1,y++),w[e]=a}if(0!==d&&1-y/h<d)return null;if(v){for(let e=m[R-1];e<C.length;e++)C[e]=w[p[e]];w=(0,s.uW)(C)}const S=o?new Array(y):new Uint32Array(y*t);y=0;for(let r=0;r<x;r++)w[r]===y&&(a(u,(v?p[r]:r)*t,S,y*t,t),y++);if(p&&!v){const e=new Uint32Array(g);for(let t=0;t<e.length;t++)e[t]=w[p[t]];w=(0,s.uW)(e)}return{buffer:Array.isArray(S)?S:S.buffer,indices:w,uniqueCount:y}}function n(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function a(e,t,i,r,s){for(let o=0;o<s;o++)i[r+o]=e[t+o]}function l(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},85746:(e,t,i)=>{i.d(t,{X:()=>m});var r=i(6326),s=i(91967),o=i(5632),n=i(46053),a=(i(81806),i(76460),i(47249),i(87990));class l{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=2}destroy(){this._destroyResources()}get resources(){return this._resources?.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new c({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!0))}}let c=class extends((0,o.sA)(s.A)){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1,this.renderGroup=2}};(0,r.Cg)([(0,n.MZ)({constructOnly:!0})],c.prototype,"view",void 0),(0,r.Cg)([(0,n.MZ)({readOnly:!0})],c.prototype,"drapeSourceType",void 0),(0,r.Cg)([(0,n.MZ)()],c.prototype,"renderGroup",void 0),c=(0,r.Cg)([(0,a.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],c);var h=i(69230),u=i(68134),d=i(37046),p=i(8918);class g{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view.stage;if(null==this._resources||!e)return;const t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t.stage;if(!i)return;const r=new p.x(i,{pickable:!1,updatePolicy:1}),s=new d.B({castShadow:!1}),o=e.createResources(s,r);r.add(s);const n=e.cameraChanged,a=n?(0,u.wB)(()=>t.state.camera,e=>n(e),u.Vh):null;this._resources={layer:r,object:s,external:o,cameraHandle:a},this._syncVisible()}_destroyResources(){null!=this._resources&&(this._resources.layer.destroy(),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class m extends h.B{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new g(this.createObject3DResourceFactory(e.view)),this.drapedResources=new l(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){this.object3dResources?.forEachMaterial(e),this.drapedResources?.forEachMaterial(e)}}},86401:(e,t,i)=>{i.d(t,{Ci:()=>s,KL:()=>a,dB:()=>n,l5:()=>o,wB:()=>l});var r=i(48549);const s=(0,r.BP)().vec3f("position").freeze(),o=(0,r.BP)().vec3f("position").vec2f16("uv0").freeze(),n=(0,r.BP)().vec3f("position").vec4u8("color").freeze(),a=(0,r.BP)().vec3f("position").vec2f("uv0").freeze(),l=(0,r.BP)().vec3f("position").vec2f("uv0").vec4u8("olidColor").freeze()},99785:(e,t,i)=>{i.d(t,{lO:()=>c,oR:()=>h});var r=i(38983),s=i(5262),o=i(44815),n=i(38496),a=i(10294),l=i(77176);function c(e){const t=h(e.rings,e.hasZ,1,e.spatialReference),i=new Array;let s=0,a=0;for(const l of t.polygons){const e=l.count,c=l.index,h=(0,o.l5)(t.position,3*c,3*e),u=l.holeIndices.map(e=>e-c),d=(0,n.uW)((0,r.e)(h,u,3));i.push({position:h,faces:d}),s+=h.length,a+=d.length}const c=function(e,t,i){if(1===e.length)return e[0];const r=(0,o.jh)(t),s=new Array(i);let a=0,l=0,c=0;for(const o of e){for(let e=0;e<o.position.length;e++)r[a++]=o.position[e];for(const e of o.faces)s[l++]=e+c;c=a/3}return{position:r,faces:(0,n.uW)(s)}}(i,s,a),u=Array.isArray(c.position)?(0,l.b)(c.position,3,{originalIndices:c.faces}):(0,l.b)(c.position.buffer,6,{originalIndices:c.faces});return c.position=(0,o.xm)(new Float64Array(u.buffer)),c.faces=u.indices,c}function h(e,t,i,r){const s=e.length,n=new Array(s),a=new Array(s),l=new Array(s);let c=0;for(let o=0;o<s;++o)c+=e[o].length;let h=0,p=0,g=0;const m=(0,o.jh)(3*c);let _=0;for(let o=s-1;o>=0;o--){const c=e[o],f=1===i&&d(c,t,r);if(f&&1!==s)n[h++]=c;else{let e=c.length;for(let t=0;t<h;++t)e+=n[t].length;const i={index:_,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};i.pathLengths[0]=c.length,c.length>0&&(l[g++]={index:_,count:c.length}),_=f?u(c,c.length-1,-1,m,_,c.length,t):u(c,0,1,m,_,c.length,t);for(let r=0;r<h;++r){const e=n[r];i.holeIndices[r]=_,i.pathLengths[r+1]=e.length,e.length>0&&(l[g++]={index:_,count:e.length}),_=u(e,0,1,m,_,e.length,t)}h=0,i.count>0&&(a[p++]=i)}}for(let o=0;o<h;++o){const e=n[o];e.length>0&&(l[g++]={index:_,count:e.length}),_=u(e,0,1,m,_,e.length,t)}return a.length=p,l.length=g,{position:m,polygons:a,outlines:l}}function u(e,t,i,r,s,o,n){s*=3;for(let a=0;a<o;++a){const o=e[t];r[s++]=o[0],r[s++]=o[1],r[s++]=n&&o[2]?o[2]:0,t+=i}return s/3}function d(e,t,i){if(!t)return!(0,s.$3)(e);const r=e.length-1;switch((0,a.S)(e,r,i)){case 0:return!(0,s.$3)(e,1,2);case 1:return!(0,s.$3)(e,0,2);case 2:return!(0,s.$3)(e,0,1)}}}}]);
//# sourceMappingURL=49041.2a602f77.chunk.js.map