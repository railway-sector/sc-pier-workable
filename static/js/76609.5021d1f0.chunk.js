"use strict";(self.webpackChunksc_pier_workable=self.webpackChunksc_pier_workable||[]).push([[76609],{2522:(t,e,i)=>{i.d(e,{P:()=>a});var n=i(6326),s=(i(76460),i(81806),i(47249),i(50076),i(87990)),o=i(49853);let a=class extends o.a{};a=(0,n.Cg)([(0,s.$)("esri.views.3d.analysis.AnalysisView3D")],a)},5109:(t,e,i)=>{i.d(e,{k:()=>r});var n=i(6326),s=i(68134),o=(i(76460),i(81806),i(47249),i(50076),i(87990)),a=i(56829);let r=class extends a.g{constructor(t){super(t)}initialize(){this.addHandles((0,s.wB)(()=>this.analysisViewData.visible,t=>this.visible=t,s.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};r=(0,n.Cg)([(0,o.$)("esri.views.interactive.AnalysisToolBase")],r)},10260:(t,e,i)=>{i.d(e,{Hd:()=>l,ZX:()=>d,aS:()=>c,qW:()=>u});var n=i(98773),s=i(54901),o=i(30726),a=i(50346),r=i(68134);function l(t,e){return(0,r.wB)(()=>t.interactive,()=>function(t,e){t.interactive?function(t,e){c(t);const{view:i,analysis:n}=t,s=new e({view:i,analysis:n,analysisViewData:t});t.tool=s,i.tools.add(s)}(t,e):c(t)}(t,e),r.pc)}function c(t){const{view:e,tool:i}=t;null!=i&&(e.tools.remove(i),t.tool=null)}function u(t,e){const i=t.userOperation,l=(0,n.UT)(async l=>{if(i){const t=i.promise.catch(()=>{});i?.abort(),await t,(0,a.Te)(l)}const c=function(t,e){t.interactive=!0;const{tool:i,view:s}=t;s.activeTool=i;let l=(0,a.u7)(e,()=>{s.activeTool===i&&(s.activeTool=null)});return(0,n.UT)(async e=>{await(0,r.C_)(()=>!t.tool?.active,e),l=(0,o.xt)(l)},e)}(t,{signal:l}),u=e?.shouldRejectOnCancel??(()=>!0),d=(0,s.vE)([(0,r.on)(()=>t.tool,"cancel",()=>{u()&&c.abort()})]),{tool:h}=t;try{h&&(h.resetCreated(),e?.onToolActivated?.(h)),await c.promise,(0,a.Te)(l)}catch(p){if(l.aborted||!(0,a.zf)(p)||u())throw p}finally{d?.remove()}},{signal:e?.abortOptions?.signal});return t.userOperation=l,l.promise.finally(()=>{t.userOperation===l&&(t.userOperation=null)})}async function d(t,e){const i=t.analysis.clone();return await u(t,{abortOptions:e?.placementOptions,onToolActivated:e?.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:e}=t;return!e.valid||e.equals(i)}}),{}}},11113:(t,e,i)=>{i.d(e,{Ee:()=>l,Jd:()=>f,Nk:()=>h,OM:()=>v,Oo:()=>g,W4:()=>c,ix:()=>p,t_:()=>d,tr:()=>u,yh:()=>m,zJ:()=>a});var n=i(73582),s=i(24648),o=i(96820);function a(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,o.zJ)(t,(0,s.kM)(e,i).value,i,n,a)}function r(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,o.nD)(t,(0,s.kM)(e,i).value,i,n,a)}function l(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.Ee)(t,e.value,e.unit,i,n)}function c(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.W4)(t,e.value,e.unit,i,n)}function u(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.tr)(t,e.value,e.unit,i,n)}function d(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.t_)(t,e.value,e.unit,i,n)}function h(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.ie,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,o.Me)(t.value,t.unit,t.rotationType,e,i,s,a)}function p(t,e,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(n=n??2,i){case"imperial":return u(t,e,n,s);case"metric":return l(t,e,n,s);default:return a(t,e,i,n,s)}}function m(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.J1)(t,e.value,e.unit,i,n)}(t,e,n,s);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.Mm)(t,e.value,e.unit,i,n)}(t,e,n,s);default:return r(t,e,i,n,s)}}function g(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return d(t,e,n,s);case"metric":return c(t,e,n,s);default:return a(t,e,i,n,s)}}function v(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.LF)(t,e.value,e.unit,i,n)}(t,e,n,s);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.e_)(t,e.value,e.unit,i,n)}(t,e,n,s);default:return r(t,e,i,n,s)}}function f(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.Sz)(t,e.value,e.unit,i,n)}(t,e,n,s);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,o.zq)(t,e.value,e.unit,i,n)}(t,e,n,s);default:return a(t,e,i,n,s)}}},14318:(t,e,i)=>{i.d(e,{O:()=>u});var n=i(6326),s=i(91967),o=i(30726),a=i(50346),r=i(46053),l=(i(81806),i(76460),i(47249),i(87990)),c=i(59752);let u=class extends s.A{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,a.sg)(async(t,e,i,n)=>{const s=this._frameTask;if(null==s)return;const o=await s.schedule(()=>e.snap({...t,context:i,signal:n}),n);o.valid&&await s.schedule(()=>{this.stagedPoint=o.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:i}))},n)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=t?t.registerTask(c.W6.SNAPPING):c.nu}destroy(){this._abortController=(0,o.DC)(this._abortController),this._frameTask=(0,o.xt)(this._frameTask)}update(t,e,i){this._snapPoints=t;const{point:n,scenePoint:s}=t,o=e.update({point:n,scenePoint:s,context:i});return this.stagedPoint=o,o}async snap(t,e,i){const{point:n,scenePoint:s}=t;return this.stagedPoint=e.update({point:n,scenePoint:s,context:i}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=(0,o.DC)(this._abortController),this._snapPoints=null}};(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,n.Cg)([(0,r.MZ)()],u.prototype,"stagedPoint",null),(0,n.Cg)([(0,r.MZ)()],u.prototype,"constrainResult",void 0),(0,n.Cg)([(0,r.MZ)()],u.prototype,"_stagedPoint",void 0),u=(0,n.Cg)([(0,l.$)("esri.views.interactive.snapping.SnappingOperation")],u)},18295:(t,e,i)=>{i.d(e,{B:()=>u});var n=i(19276),s=i(54901),o=i(43927),a=i(3589),r=i(63078),l=i(83973);const c=n.A.ofType(a.A);function u(t,e){const i=(0,o.L)(e?.excludeInternal?()=>t.map?.allLayers.filter(t=>!("internal"in t)||!t.internal):()=>t.map?.allLayers,t=>new a.A({layer:t}),{recycleItems:!0,createCollection:()=>new c}),n=new l.A({enabled:!0,selfEnabled:e?.selfEnabled??!1,featureEnabled:!0,featureSources:i,distance:e?.distance??r.N.distance,touchSensitivityMultiplier:e?.touchSensitivityMultiplier??r.N.touchSensitivityMultiplier});return{...(0,s.DQ)(i),options:n}}},19747:(t,e,i)=>{i.d(e,{c:()=>o});var n=i(31633),s=i(44568);function o(t){const e="metric";if(null==t)return e;const i=t.map,o=(i&&"portalItem"in i?i.portalItem?.portal:null)??s.A.getDefault();switch(o.user?.units??o.units){case e:return e;case"english":return"imperial"}return(0,n.jM)(t.spatialReference)??e}},23458:(t,e,i)=>{i.d(e,{h:()=>n});const n=["horizontal","vertical","direct"]},25191:(t,e,i)=>{i.d(e,{C:()=>u,J:()=>d});var n=i(20664),s=i(9392),o=i(56611),a=i(98510),r=i(14487),l=i(75762),c=i(94966);class u{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.vt)(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.vt)();this.startRenderSpace=t,this.endRenderSpace=e,this.type="euclidean"}eval(t,e,i){return(0,n.l)(e,this.startRenderSpace,this.endRenderSpace,t),i&&((0,n.e)(i,this.endRenderSpace,this.startRenderSpace),(0,n.n)(i,i)),e}createRenderGeometry(t,e){const i=[],s=[],o=(e,o)=>{const a=p;(0,n.e)(a,e,t),i.push([a[0],a[1],a[2]]),s.push([o[0],o[1],o[2]])},a=e.worldUpAtPosition(this.eval(.5,h),l.rq.get());return o(this.startRenderSpace,a),o(this.endRenderSpace,a),{points:i,normals:s}}static fromPositionAndVector(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,n.h)(h,e,i),(0,n.g)(h,t,h),new u((0,s.o8)(t),(0,s.o8)(h))}}class d{_projectIn(t,e){this._project?(0,r.F)(t,this.renderSpatialReference,e,this._pcpf):(0,n.d)(e,t)}constructor(t,e,i){this.startRenderSpace=t,this.endRenderSpace=e,this.renderSpatialReference=i,this.type="geodesic",this._start=(0,s.vt)(),this._end=(0,s.vt)(),this._pcpf=(0,a.lO)(i),this._project=(0,o.canProjectWithoutEngine)(i,this._pcpf),this._projectIn(t,this._start),this._projectIn(e,this._end)}eval(t,e,i){if(this._project)if(i){const s=p;(0,c.is)(this._start,this._end,t,e,s),(0,n.g)(m,e,s),(0,r.F)(e,this._pcpf,e,this.renderSpatialReference),(0,r.F)(m,this._pcpf,m,this.renderSpatialReference),(0,n.e)(i,m,e),(0,n.n)(i,i)}else(0,c.nu)(this._start,this._end,t,e),(0,r.F)(e,this._pcpf,e,this.renderSpatialReference);else(0,n.l)(e,this._start,this._end,t),i&&((0,n.e)(i,this._end,this._start),(0,n.n)(i,i));return e}createRenderGeometry(t,e){const i=[],s=[],o=(e,o)=>{const a=m;(0,n.e)(a,e,t),i.push([a[0],a[1],a[2]]),s.push([o[0],o[1],o[2]])};for(let n=0;n<128;++n){const t=n/127,i=h,s=p;this.eval(t,i),e.worldUpAtPosition(i,s),o(i,s)}return{points:i,normals:s}}}const h=(0,s.vt)(),p=(0,s.vt)(),m=(0,s.vt)()},29201:(t,e,i)=>{i.d(e,{I:()=>f,a:()=>g,b:()=>v});var n=i(26917),s=i(59395),o=i(90080),a=i(94192),r=i(80883),l=i(3799),c=i(21390),u=i(86955),d=i(70367),h=i(91911),p=i(31432),m=i(2687);class g extends p.Y{}function v(t){const e=new m.N5,{vertex:i,fragment:p,varyings:g}=e,{output:v,perspectiveInterpolation:f}=t;return(0,l.NB)(i,t),e.include(s.d),e.include(a.Z,t),e.fragment.include(n.HQ,t),e.include(o.g,t),e.include(h.z,t),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),f&&e.attributes.add("perspectiveDivide","float"),i.main.add(u.H`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${(0,u.If)(f,"gl_Position *= perspectiveDivide;")}`),g.add("vpos","vec3",{invariant:!0}),g.add("vTexCoord","vec2"),p.include(r.a),p.uniforms.add(new c.m("opacity",t=>t.opacity),new d.N("tex",t=>t.glTexture)).main.add(u.H`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${(0,u.If)(10===v,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),e}const f=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:g,build:v},Symbol.toStringTag,{value:"Module"}))},30416:(t,e,i)=>{i.d(e,{r:()=>P});var n=i(88105),s=i(34981),o=i(59696),a=i(34812),r=i(45463),l=i(60322),c=i(86994),u=i(82809),d=i(63928),h=i(52757),p=i(16506),m=i(59246),g=i(96643),v=i(86401),f=i(29201),_=i(57162);class y extends m.w{constructor(t,e){super(t,e,new p.$(f.I,()=>i.e(48391).then(i.bind(i,48391))),M(e).locations)}_getPipelineState(t,e){const{oitPass:i,output:n,hasOccludees:o,cullFace:a}=t;return(0,_.Ey)({blending:(0,s.RN)(n)?(0,l.Yf)(i,!0):null,culling:(0,_.Xt)(a),depthTest:{func:(0,l.K_)(i)},depthWrite:(0,l.z5)(t),drawBuffers:(0,l.m6)(i,n),colorWrite:_.kn,stencilWrite:o?g.v0:null,stencilTest:o?e?g.a9:g.qh:null,polygonOffset:(0,l.mE)(t)})}initializePipeline(t){return this._occludeePipeline=this._getPipelineState(t,!0),this._getPipelineState(t,!1)}getPipeline(t){return t?this._occludeePipeline:super.getPipeline()}}function M(t){let e=v.l5;return t.perspectiveInterpolation&&(e=e.clone().f32("perspectiveDivide")),e}var w=i(6326),C=i(6485),S=i(92656);class b extends S.E{constructor(t){super(),this.draped=t,this.cullFace=0,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.snowCover=!1}}(0,w.Cg)([(0,C.W)({count:3})],b.prototype,"cullFace",void 0),(0,w.Cg)([(0,C.W)()],b.prototype,"enableOffset",void 0),(0,w.Cg)([(0,C.W)()],b.prototype,"writeDepth",void 0),(0,w.Cg)([(0,C.W)()],b.prototype,"hasOccludees",void 0),(0,w.Cg)([(0,C.W)()],b.prototype,"terrainDepthTest",void 0),(0,w.Cg)([(0,C.W)()],b.prototype,"cullAboveTerrain",void 0),(0,w.Cg)([(0,C.W)()],b.prototype,"perspectiveInterpolation",void 0);class P extends d.W{constructor(t){super(t,O),this.supportsEdges=!0,this.produces=new Map([[2,t=>(0,s.CL)(t)],[4,t=>(0,s._o)(t)&&this.parameters.writeDepth],[8,t=>(0,s._o)(t)&&!this.parameters.writeDepth],[18,t=>(0,s._o)(t)||(0,s.CL)(t)]]),this._configuration=new b(t.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(t,e){return super.getConfiguration(t,e,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=e.hasOccludees,this._configuration.oitPass=e.oitPass,this._configuration.enableOffset=e.camera.relativeElevation<l.xt,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(t){return new x(t)}createBufferWriter(){return new D(M(this.parameters))}}class x extends o.A{constructor(t){super({...t,...t.material.parameters}),this.parameters=t;const e=this._material.parameters.texture;(0,a.y)(e)&&t.textures.updater.add(e)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(t){return this.getTechnique(y,t)}}class D extends u.Z{write(t,e,i,s,o,a){for(const r of this.layout.fields.keys()){const s=i.get(r);if(s)if("perspectiveDivide"===r){(0,c.vA)(1===s.size);const t=o.getField(r,n.Y$);t&&(0,h.uO)(s,t,a)}else(0,h.Ap)(r,s,t,e,o,a)}return null}}class O extends r.q{constructor(t,e){super(),this.texture=t,this.draped=e,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}},46576:(t,e,i)=>{i.d(e,{T:()=>s});var n=i(96342);function s(t){const e=new n.n(t);return e.options.store=0,e.options.excludeLabels=!0,e}},49853:(t,e,i)=>{i.d(e,{a:()=>c});var n=i(6326),s=i(54099),o=i(54901),a=i(91291),r=i(46053),l=(i(81806),i(76460),i(47249),i(87990));let c=class extends((0,a.g)(s.nJ)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(t){this._userInteractive=t}get updating(){return!1}get visible(){return(this.parent?.visible&&!this.parent.suspended)??!0}set visible(t){this._overrideIfSome("visible",t)}forceInteractive(){return this._interactiveViewModelCount++,(0,o.hA)(()=>this._interactiveViewModelCount--)}};(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],c.prototype,"parent",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],c.prototype,"view",void 0),(0,n.Cg)([(0,r.MZ)({type:Boolean})],c.prototype,"interactive",null),(0,n.Cg)([(0,r.MZ)()],c.prototype,"_userInteractive",void 0),(0,n.Cg)([(0,r.MZ)({readOnly:!0})],c.prototype,"updating",null),(0,n.Cg)([(0,r.MZ)()],c.prototype,"visible",null),(0,n.Cg)([(0,r.MZ)()],c.prototype,"_interactiveViewModelCount",void 0),c=(0,n.Cg)([(0,l.$)("esri.views.analysis.AnalysisView")],c)},56567:(t,e,i)=>{i.d(e,{A:()=>m});var n=i(6326),s=i(23458),o=i(69098),a=i(73582),r=i(42553),l=i(30726),c=i(46053),u=i(21403),d=(i(81806),i(47249),i(87990)),h=i(40565),p=i(19247);let m=class extends((0,r.T)(o.Pw)){constructor(t){super(t),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType="direct",this.offset=0,this.orientation=0}get valid(){return null!=this.startPoint&&null!=this.endPoint}equals(t){return this===t||(0,l.CM)(this.startPoint,t.startPoint)&&(0,l.CM)(this.endPoint,t.endPoint)&&this.measureType===t.measureType&&this.offset===t.offset&&this.orientation===t.orientation}};(0,n.Cg)([(0,c.MZ)({type:["length"],json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),(0,n.Cg)([(0,c.MZ)({type:p.A,json:{write:{isRequired:!0}}})],m.prototype,"startPoint",void 0),(0,n.Cg)([(0,c.MZ)({type:p.A,json:{write:{isRequired:!0}}})],m.prototype,"endPoint",void 0),(0,n.Cg)([(0,c.MZ)({type:s.h,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"measureType",void 0),(0,n.Cg)([(0,c.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"offset",void 0),(0,n.Cg)([(0,c.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,u.w)(t=>a.ie.normalize((0,h.GB)(t),0,!0))],m.prototype,"orientation",void 0),(0,n.Cg)([(0,c.MZ)({readOnly:!0})],m.prototype,"valid",null),m=(0,n.Cg)([(0,d.$)("esri.analysis.LengthDimension")],m)},59962:(t,e,i)=>{i.d(e,{t:()=>u,k:()=>d});const n="theme-style";function s(t,e){return function(t,e){const i=new Image(e,e);return i.src=t,i}(function(t){const e=(new XMLSerializer).serializeToString(t);return`data:image/svg+xml;base64,${btoa(e)}`}(o(function(t){const e=t.split(",")[1],i=atob(e);return(new DOMParser).parseFromString(i,"image/svg+xml")}(t),e)),e.size)}function o(t,e){let{accentColor:i,contrastColor:s}=e;const o=i.toHex(),a=i.a,r=s.toHex(),l=s.a,c=t.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(n);return c&&(c.innerHTML=`\n      .contrast-fill { fill: ${r}; fill-opacity: ${l}; }\n      .contrast-stroke { stroke: ${r}; stroke-opacity: ${l};  }\n      .accent-fill { fill: ${o}; fill-opacity: ${a}; }\n      .accent-stroke { stroke: ${o}; stroke-opacity:  ${a}; }`),t}const a="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSI+PHN0eWxlIGlkPSJ0aGVtZS1zdHlsZSI+LmNvbnRyYXN0LWZpbGx7ZmlsbDojZmZmfS5jb250cmFzdC1zdHJva2V7c3Ryb2tlOiNmZmZ9LmFjY2VudC1maWxse2ZpbGw6I2ZmN2YwMDtmaWxsLW9wYWNpdHk6LjV9PC9zdHlsZT48cGF0aCBkPSJNMjggMGEyOCAyOCAwIDEgMSAwIDU2IDI4IDI4IDAgMCAxIDAtNTYiIGNsYXNzPSJhY2NlbnQtZmlsbCIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNC45OSIgZD0iTTIwLjA1IDQwLjg2YTE1LjA1IDE1LjA1IDAgMCAwIDE3LjE0LTEuNSAxNS4wNSAxNS4wNSAwIDAgMCA0LjQ3LTE2LjY1IDE1LjA1IDE1LjA1IDAgMCAwLTIyLjcyLTcuMTUgMTUuMDUgMTUuMDUgMCAwIDAtNS41IDcuMTUiIGNsYXNzPSJjb250cmFzdC1zdHJva2UiLz48cGF0aCBkPSJtMTAuOTcgMzUuNTcgNS4zOCAxMi4wNyA3Ljc5LTEzLjQ3eiIgY2xhc3M9ImNvbnRyYXN0LWZpbGwiLz48L3N2Zz4=",r="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSI+PHN0eWxlIGlkPSJ0aGVtZS1zdHlsZSI+LmNvbnRyYXN0LWZpbGx7ZmlsbDojZmZmfS5jb250cmFzdC1zdHJva2V7c3Ryb2tlOiNmZmZ9LmFjY2VudC1maWxse2ZpbGw6I2ZmN2YwMDtmaWxsLW9wYWNpdHk6LjV9PC9zdHlsZT48Y2lyY2xlIGN4PSIzOS40NzgiIGN5PSIzLjA3OCIgcj0iMjgiIGNsYXNzPSJhY2NlbnQtZmlsbCIgdHJhbnNmb3JtPSJyb3RhdGUoNDAuNTQyKSIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNSIgZD0ibTcuMDc0IDMwLjA1MyAyOS4zOTcgMTEuOTg1LTMuNjczLTMzLjQ5MyIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIHN0cm9rZS13aWR0aD0iMi45OTYiIGQ9Ik0yNC41MDQgMjMuMjA3YTExLjk4IDExLjk4IDAgMCAwLTkuOCA3LjUwNyIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSBjb250cmFzdC1maWxsIi8+PHBhdGggZD0ibTI5LjgxOCAyMi44MDgtNi4xODQgNC42LS41NDEtOC4zNjR6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==";var l=i(96897);const c=64;function u(t,e){const{accentColor:i,contrastColor:n,preMultiplyAlpha:o}=e;return t.fromData(`heading-rotate:[accent:${i},contrast:${n},size:${c}]`,()=>new l.g(s(a,{accentColor:i,contrastColor:n,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:o}))}function d(t,e){const{accentColor:i,contrastColor:n,preMultiplyAlpha:o}=e;return t.fromData(`tilt-rotate:[accent:${i},contrast:${n},size:${c}]`,()=>new l.g(s(r,{accentColor:i,contrastColor:n,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:o}))}},66747:(t,e,i)=>{i.d(e,{N:()=>M,R:()=>C});var n=i(69539),s=i(88321),o=i(68134),a=i(76931),r=i(19555),l=i(20664),c=i(9392),u=i(4244),d=i(69230),h=i(6326),p=i(91967),m=i(46053),g=(i(81806),i(76460),i(47249),i(87990)),v=(i(27347),i(10760));i(48396);let f=class extends p.A{get startPosition(){return[this.startX,this.startY]}set startPosition(t){this._set("startX",t[0]),this._set("startY",t[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(t){this._set("endX",t[0]),this._set("endY",t[1])}constructor(t){super(t),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const t=this.color;return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}get _lineCap(){return"round"}render(){const{height:t,left:e,top:i,width:n,x1:s,x2:o,y1:a,y2:r}=this._calculateCoordinates(_),l=`stroke: ${this._strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this._lineCap};`;return(0,v.h)("div",{classes:{"esri-line-overlay-item":!0},styles:{left:e+"px",top:i+"px",width:n+"px",height:t+"px",visibility:this.visible?"visible":"hidden"}},[(0,v.h)("svg",{width:n,height:t},[(0,v.h)("line",{x1:s,y1:a,x2:o,y2:r,style:l})])])}renderCanvas(t){if(!this.visible)return;t.strokeStyle=this._strokeStyle,t.lineWidth=this.width,t.lineCap=this._lineCap;const e=this._calculateCoordinates(_);t.beginPath(),t.moveTo(e.left+e.x1,e.top+e.y1),t.lineTo(e.left+e.x2,e.top+e.y2),t.stroke()}_calculateCoordinates(t){const e=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),n=Math.min(this.startY,this.endY),s=Math.max(this.startY,this.endY),o=this.width;return t.left=e-o,t.top=n-o,t.width=i-e+2*o,t.height=Math.max(20,s-n+2*o),t.x1=this.startX-e+o,t.y1=this.startY-n+o,t.x2=this.endX-e+o,t.y2=this.endY-n+o,t}};(0,h.Cg)([(0,m.MZ)()],f.prototype,"startX",void 0),(0,h.Cg)([(0,m.MZ)()],f.prototype,"startY",void 0),(0,h.Cg)([(0,m.MZ)()],f.prototype,"endX",void 0),(0,h.Cg)([(0,m.MZ)()],f.prototype,"endY",void 0),(0,h.Cg)([(0,m.MZ)()],f.prototype,"startPosition",null),(0,h.Cg)([(0,m.MZ)()],f.prototype,"endPosition",null),(0,h.Cg)([(0,m.MZ)()],f.prototype,"width",void 0),(0,h.Cg)([(0,m.MZ)()],f.prototype,"color",void 0),(0,h.Cg)([(0,m.MZ)()],f.prototype,"visible",void 0),(0,h.Cg)([(0,m.MZ)()],f.prototype,"isDecoration",void 0),(0,h.Cg)([(0,m.MZ)({readOnly:!0})],f.prototype,"_strokeStyle",null),f=(0,h.Cg)([(0,g.$)("esri.views.overlay.LineOverlayItem")],f);const _={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};var y=i(28048);class M extends d.B{constructor(t){super(t),this._handles=new s.A,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text="-",this._fontSize=14,this._backgroundColor=new n.A([0,0,0,.6]),this._calloutColor=new n.A([0,0,0,.5]),this._textColor=new n.A([255,255,255]),this._distance=25,this._anchor="right",this.updatePositionOnCameraMove=!0,this.applyProperties(t)}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.updateLabelPosition()}get isDecoration(){return this._isDecoration}set isDecoration(t){this._isDecoration=t,this._textItem&&(this._textItem.isDecoration=t),this._calloutItem&&(this._calloutItem.isDecoration=t)}get textItem(){return this._textItem}get text(){return this._text}set text(t){this._text=t,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.attached&&(this._textItem.fontSize=this._fontSize)}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t,this.attached&&(this._textItem.backgroundColor=this._backgroundColor)}get calloutColor(){return this._calloutColor}set calloutColor(t){this._calloutColor=t,this.attached&&(this._calloutItem.color=this._calloutColor.toRgba())}get textColor(){return this._textColor}set textColor(t){this._textColor=t,this.attached&&(this._textItem.textColor=this._textColor)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this.updateLabelPosition())}get anchor(){return this._anchor}set anchor(t){this._anchor!==t&&(this._anchor=t,this.updateLabelPosition())}get _camera(){return this.view.state.cssCamera}overlaps(t){return!!this.attached&&this.textItem.visible&&t.textItem.visible&&!!this.view.overlay?.overlaps(this._textItem,t.textItem)}updateLabelPosition(){if(!this.attached)return;this._showText=!1,this._showCallout=!1;const{geometry:t,view:e,visible:i}=this;if(null!=t&&e.stage)switch(t.type){case"point":if(!this._computeLabelPositionFromPoint(t.point,I))break;if(t.callout){const e=this._camera,i=t.callout.distance;(0,r.WQ)(z,z,[0,t.callout.offset]),e.renderToScreen(z,I),(0,r.hZ)(O,0,1),(0,r.hs)(O,O,i),(0,r.WQ)(O,O,z),e.renderToScreen(O,R),this._showCallout=this._updatePosition(I,R)}else this._textItem.position=[I[0],I[1]],this._textItem.anchor="center";this._showText=!0;break;case"corner":if(!this._computeLabelPositionFromCorner(t,this._distance,I,R))break;this._showCallout=this._updatePosition(I,R),this._showText=!0;break;case"segment":{if(!this._computeLabelPositionFromSegment(t,this._distance,this._anchor,I,R))break;this._showText=!0;const e=this._updatePosition(I,R);this._showCallout=!1!==t.callout&&e,this._showCallout||(this._textItem.anchor="center")}}this.updateVisibility(i)}_computeLabelPositionFromPoint(t,e){const i=this._camera,n=i.projectToRenderScreen(t,z);return!!n&&!(n[2]<0||n[2]>1)&&(i.renderToScreen(n,e),!0)}_computeLabelPositionFromCorner(t,e,i,n){if(!t)return!1;const s=this._camera,o=w(t.left,1,s,x),a=w(t.right,0,s,D);if(null==o||null==a)return!1;(0,r.ze)(x,x),(0,r.WQ)(O,o,a),(0,r.ze)(O,O),(0,r.S8)(O,O);const l=s.projectToRenderScreen(t.left.endRenderSpace,A);return!(!l||l[2]<0||l[2]>1)&&(s.renderToScreen(l,i),(0,r.hs)(O,O,e),(0,r.WQ)(O,O,l),s.renderToScreen(O,n),!0)}_computeLabelPositionFromSegment(t,e,i,n,s){if(!t)return!1;const o=t.segment,a=this._camera;(0,u.Q)(o.startRenderSpace,o.endRenderSpace,a,x),(0,r.hZ)(O,-x[1],x[0]);let l=!1;switch(i){case"top":l=O[1]<0;break;case"bottom":l=O[1]>0;break;case"left":l=O[0]>0;break;case"right":l=O[0]<0}if(l&&(0,r.ze)(O,O),0===(0,r.Bw)(O))switch(i){case"top":O[1]=1;break;case"bottom":O[1]=-1;break;case"left":O[0]=-1;break;case"right":O[0]=1}o.eval(Z[t.sampleLocation],T);const c=a.projectToRenderScreen(T,A);return!(!c||c[2]<0||c[2]>1)&&(a.renderToScreen(A,n),(0,r.hs)(O,O,e),(0,r.WQ)(O,O,A),a.renderToScreen(O,s),!0)}_updatePosition(t,e){if(e){const i=e[0]-t[0],n=e[1]-t[1];return this._textItem.position=[e[0],e[1]],this._textItem.anchor=Math.abs(i)>Math.abs(n)?i>0?"left":"right":n>0?"top":"bottom",this._calloutItem.startPosition=[t[0],t[1]],this._calloutItem.endPosition=[e[0],e[1]],!0}return this._textItem.position=[t[0],t[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new y.A({visible:!0,text:this._text,fontSize:this._fontSize,backgroundColor:this._backgroundColor,textColor:this._textColor,isDecoration:this._isDecoration}),this._calloutItem=new f({color:this._calloutColor.toRgba(),visible:!0,width:2,isDecoration:this._isDecoration}),this.updateLabelPosition(),this.view.overlay?.items.addMany([this._textItem,this._calloutItem]),this.updatePositionOnCameraMove&&this._handles.add((0,o.wB)(()=>this.view.state.camera,()=>this.updateLabelPosition()))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(t){this._textItem.visible=this._showText&&t,this._calloutItem.visible=this._showCallout&&t}forEachMaterial(){}}function w(t,e,i,n){return t.eval(e,S,P),(0,l.g)(b,S,P),(0,u.Q)(S,b,i,n)}function C(t){switch(t){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const S=(0,c.vt)(),b=(0,c.vt)(),P=(0,c.vt)(),x=(0,a.QG)(),D=(0,a.QG)(),O=(0,a.QG)(),T=(0,c.vt)(),A=(0,a.r_)(),z=(0,a.QG)(),I=(0,a.gs)(),R=(0,a.gs)(),Z={start:0,center:.5,end:1}},68655:(t,e,i)=>{i.d(e,{f:()=>a});var n=i(9392),s=i(29772),o=i(23739);async function a(){return t=await(0,o.V)(),{autoLength2D:e=>t.geodesicLength(e)??(0,s.Xg)(e),autoDistanceBetweenPoints2D:(e,i)=>t.geodesicDistanceBetweenPoints(e,i)??(0,s.ll)(e,i),autoDistance2D:(e,i,n)=>(r[0]=e[0],r[1]=e[1],r[2]=3===e.length?e[2]:0,l[0]=i[0],l[1]=i[1],l[2]=3===i.length?i[2]:0,t.geodesicDistance(r,l,n)??(0,s.sT)(r,l,n))};var t}const r=(0,n.vt)(),l=(0,n.vt)()},75218:(t,e,i)=>{i.d(e,{X:()=>l});var n=i(54901),s=i(77944),o=i(18295),a=i(64344);const r=new Map;function l(t){if(!r.has(t)){const e=(0,o.B)(t,{distance:10}),i=function(t,e){return new a.g({view:t,options:e})}(t,e.options);r.set(t,{referenceCount:0,snappingManager:i,remove:()=>{e.remove(),i.destroy()}})}const e=r.get(t);e.referenceCount++;const i=(0,n.hA)(()=>{return i=t,(n=e).referenceCount--,void(n.referenceCount>0||(0,s.d)(()=>{0===n.referenceCount&&(n.remove(),r.delete(i))}));var i,n});return{snappingManager:e.snappingManager,...i}}},76609:(t,e,i)=>{i.r(e),i.d(e,{default:()=>Ee});var n=i(6326),s=i(54901),o=(i(81806),i(76460)),a=i(43927),r=i(30726),l=i(46053),c=(i(47249),i(87990)),u=i(2522),d=i(91967),h=i(68134),p=i(31633),m=i(19747),g=i(15941),v=i(24648),f=i(40565),_=i(34761),y=i(13191),M=i(20664),w=i(9392),C=i(19247),S=i(75762),b=i(18117),P=i(32535),x=i(25191),D=i(29772),O=i(90659);class T{constructor(t,e,i,n,s,o){this.elevationAlignedStartPoint=t,this.elevationAlignedEndPoint=e,this.directSegment=i,this.dimensionSegment=n,this.primaryOffsetAxis=s,this.spatialReference=o}}const A=(0,f.dp)(C.A);function z(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:s,orientation:o}}=t;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,offset:n,measureType:s,orientation:o}}function I(t,e){let{elevationAlignedStartPoint:i,elevationAlignedEndPoint:n,offset:s,measureType:o,orientation:a}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==i||null==n)return null;const l=L(r?.directSegment??new x.C,{elevationAlignedStartPoint:i,elevationAlignedEndPoint:n},e),c=r?.primaryOffsetAxis??(0,w.vt)();G(c,{measureType:o,elevationAlignedStartPoint:i,elevationAlignedEndPoint:n,directSegment:l,orientation:a,renderCoordsHelper:e});const u=r?.dimensionSegment??new x.C;return N({elevationAlignedStartPoint:i,elevationAlignedEndPoint:n})&&"vertical"===o?((0,M.d)(u.startRenderSpace,l.startRenderSpace),(0,M.d)(u.endRenderSpace,l.endRenderSpace)):j(u,c,s,l,e),new T(i,n,l,u,c,e.spatialReference)}function R(t,e,i,n){return 0===e?((0,M.d)(t.startRenderSpace,i.startRenderSpace),(0,M.d)(t.endRenderSpace,n.startRenderSpace)):((0,M.d)(t.startRenderSpace,i.endRenderSpace),(0,M.d)(t.endRenderSpace,n.endRenderSpace)),t}function Z(t,e,i,n){switch(e){case"direct":return L(t,i,n);case"horizontal":case"vertical":{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,dimension:a,geometry:r}=i;let l;"direct"===a.measureType?(l=function(t,e){const i=t.directSegment.eval(.5,S.rq.get()),n=e.worldUpAtPosition(i,S.rq.get()),s=t.dimensionSegment.eval(.5,S.rq.get()),o=(0,M.a)(S.rq.get(),s,i);return!(0,M.G)(o,w.uY)&&(0,M.f)(o,n)>0}(r,n)===s.z>o.z,"horizontal"===e&&(l=!l)):l=!function(t){const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=t.directSegment;return(0,M.x)(n,e)<(0,M.x)(s,i)}(r);const[c,u]=l?[s,o]:[o,s],d=(0,P.EL)(u,k);return"horizontal"===e?d.z=c.z:(d.x=c.x,d.y=c.y),n.toRenderCoords(c,t.startRenderSpace),n.toRenderCoords(d,t.endRenderSpace),t}}}function L(t,e,i){return i.toRenderCoords(e.elevationAlignedStartPoint,t.startRenderSpace),i.toRenderCoords(e.elevationAlignedEndPoint,t.endRenderSpace),t}const k=(0,b.TH)(0,0,0,null);const H=new x.C;function G(t,e){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:o,endRenderSpace:a},directSegment:r,renderCoordsHelper:l}=e,c=r.eval(.5,S.rq.get()),u=l.worldUpAtPosition(c,S.rq.get()),d=l.worldBasisAtPosition(c,1,S.rq.get());switch(i){case"horizontal":(0,M.d)(t,u);break;case"vertical":(0,M.f)(o,u)<(0,M.f)(a,u)?(0,M.a)(t,a,o):(0,M.a)(t,o,a),(0,M.i)(t,t,u),(0,M.i)(t,t,u);break;case"direct":{const i=e.orientation??0;if(N({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))(0,_.$0)(E,-(0,g.kU)(i),u),(0,M.t)(t,d,E);else{const e=(0,M.a)(S.rq.get(),a,o),n=(0,M.i)(S.rq.get(),e,u);(0,M.i)(n,n,e),(0,_.$0)(E,(0,g.kU)(i),e),(0,M.t)(t,n,E)}break}}return(0,M.G)(t,w.uY)?(0,M.d)(t,d):(0,M.n)(t,t)}const E=(0,y.vt)();function N(t){let{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=t;return null!=e&&null!=i&&e.x===i.x&&e.y===i.y}function j(t,e,i,n,s){const{startRenderSpace:o,endRenderSpace:a}=n,r=i/s.unitInMeters,[l,c]=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=(0,M.f)(e,i),o=(0,M.f)(t,i),a=Math.abs(s-o)+n;return s>o?[a,n]:[n,a]}(o,a,e,r);return(0,M.c)(t.startRenderSpace,n.startRenderSpace,e,l),(0,M.c)(t.endRenderSpace,n.endRenderSpace,e,c),t}function V(t,e,i){const n=e.directSegment.eval(.5,S.rq.get());return i.worldUpAtPosition(n,t)}function B(t,e){const{startRenderSpace:i,endRenderSpace:n}=e.directSegment;return(0,M.a)(t,n,i)}function Y(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:n,endRenderSpace:s}=e.dimensionSegment;return i.invert?(0,M.a)(t,n,s):(0,M.a)(t,s,n)}function W(t,e){const i=t.directSegment.eval(.5,S.rq.get());return e.headingAtPosition(i,t.primaryOffsetAxis)}const q=(0,w.vt)();function F(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=t;if(null==e||null==i)return!1;const n=(0,D.Ce)(e,i);return null!=n&&(0,v.kM)(n,"meters").value>O.U7}function U(t){return null!=t.geometry}let $=class extends d.A{constructor(t){super(t)}initialize(){const t=(0,a.L)(()=>this.analysisViewData.computations,t=>{let{computation:e}=t;return this._watchComputation(e)});this.addHandles((0,s.DQ)(t))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,m.c)(this.view)}_watchComputation(t){return(0,h.wB)(()=>z(t),e=>{const{measureType:i}=e;if(F(e)&&"direct"!==i){const e=Math.round((0,p.oU)(O.U7,"meters","kilometers"));return o.A.getLogger(this).warnOnce(`A ${i} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${e} km. Update the measureType of the affected dimension to "direct" to display it.`),void(t.geometry=null)}const n=I(e,this.view.renderCoordsHelper,t.geometry);t.geometry=n,t.result.length=function(t,e,i,n){if(null==t)return null;let s;if("horizontal"===e)s=n.autoDistanceBetweenPoints2D(A(t.elevationAlignedStartPoint),A(t.elevationAlignedEndPoint));else{const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment;s=(0,D.vp)(e,i,t.spatialReference)}if(null==s)return null;const o="vertical"===e?(0,p.jE)(s.value,s.unit,i):(0,p.Vs)(s.value,s.unit,i);return(0,v.kM)(s,o)}(n,i,this._defaultUnit,this.automaticLengthMeasurementUtils)},h.pc)}};(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],$.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],$.prototype,"view",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],$.prototype,"automaticLengthMeasurementUtils",void 0),(0,n.Cg)([(0,l.MZ)()],$.prototype,"analysis",null),(0,n.Cg)([(0,l.MZ)()],$.prototype,"_defaultUnit",null),$=(0,n.Cg)([(0,c.$)("esri.views.3d.analysis.Dimension.DimensionController")],$);var X=i(50176),Q=i(69539),J=i(23458),K=i(73582),tt=i(76931),et=i(55855),it=i(13927),nt=i(59784);function st(t){return(0,nt._L)(t.accentColor,.5)}function ot(t){return(0,nt.bJ)(t.accentColor)}const at=new Q.A([127,127,127,.5]);var rt=i(56121),lt=i(38317),ct=i(91175),ut=i(7947),dt=i(99443),ht=i(50468),pt=i(17345),mt=i(72017),gt=i(52479),vt=i(17046);class ft{constructor(t){this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}manipulatorName(t){return Object.keys(this).find(e=>this.hasOwnProperty(e)&&t===this[e])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(t){for(const e of J.h)t(this.manipulatorForMeasureType(e),e)}manipulatorForMeasureType(t){switch(t){case"direct":return this.direct;case"horizontal":return this.horizontal;case"vertical":return this.vertical}}}class _t extends rt.q{constructor(t,e){const i=(0,lt.UM)(Q.A.toUnitRGBA(st(t.effectiveTheme))),n=[new ct.M((0,mt.CM)(i,1,32,32),kt)];super({view:t,renderObjects:n,metadata:e.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,h.wB)(()=>({color:Q.A.toUnitRGBA(st(t.effectiveTheme))}),t=>i.setParameters(t))}destroy(){this._themeHandle.remove(),super.destroy()}}class yt extends rt.q{constructor(t,e){let{lineSizePt:i,material:n,metadata:s}=e;super({view:t,autoScaleRenderObjects:!1,collisionPriority:1,metadata:s}),this._options={calloutColor:(0,et.vt)(),lineSizePt:i,material:n},this._themeHandle=(0,h.wB)(()=>Q.A.toUnitRGBA(st(t.effectiveTheme)),t=>{this._options.calloutColor=t,Lt(this,Mt({...this._options,metadata:this.metadata}))},h.Vh)}update(t){let{lineSizePt:e,material:i}=t;this._options.lineSizePt=e,this._options.material=i,Lt(this,Mt({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Mt(t){let{calloutColor:e,lineSizePt:i,material:n,metadata:s}=t;return{calloutLength:.25*dt.PV*.8*(0,tt.Lz)(i)+18,calloutColor:e,calloutWidth:2,customStateMask:kt,discScale:.3,focusMultiplier:2,material:n,metadata:s}}function wt(t,e){let{computation:i,view:n}=e;return[(0,vt.Xt)(t,(t,e,s)=>{Ct({cancel:s,computation:i,settingHeading:!1,steps:e,view:n})}),t.events.on("immediate-click",t=>{!function(t,e,i){const{dimension:n,geometry:s}=e;if(90===n.orientation||270===n.orientation)return n.orientation=0,void t.stopPropagation();if(null==s)return;const{renderCoordsHelper:o}=i,a=I({...z(e),orientation:90},o),r=I({...z(e),orientation:270},o);if(null==a||null==r)return;const l=W(a,o),c=W(r,o),u=Pt(s,i),d=K.ie.shortestSignedDiff(u,l),h=K.ie.shortestSignedDiff(u,c);n.orientation=Math.abs(d)<Math.abs(h)?90:270,t.stopPropagation()}(t,i,n)})]}function Ct(t){const{cancel:e,computation:i,settingHeading:n,steps:s,view:o}=t;if(!U(i))return;const{renderCoordsHelper:a}=o,{dimension:r,geometry:l}=i,c=(0,w.vt)(),u=At((0,w.vt)(),l,l.directSegment,a),d=zt(S.rq.get(),{forHeading:n,geometry:l,renderCoordsHelper:a}),h=(0,it.O_)(u,d,(0,it.vt)()),p=n?r.orientation??W(l,o.renderCoordsHelper):r.orientation??0;s.next((0,ut.AA)(o,h)).next(t=>{"start"===t.action&&(0,M.d)(c,t.renderStart);const e=(0,it.Qj)(h),i=(0,lt.FY)(c,t.renderEnd,u,e);let s=p-(0,g.KJ)(i);n||(s=function(t){const e=K.ie.normalize(t)%90;return e<5?t-e:90-e<5?t+(90-e):t}(s)),r.orientation=s}),e.next((0,vt.VG)(r,["orientation"]))}function St(t,e){let{computation:i,manipulatorMeasureType:n,view:s}=e,o="direct",a=0,r=0;return[t.events.on("grab-changed",e=>{if("start"!==e.action||!U(i))return;const{dimension:l,geometry:c}=i;o=l.measureType,a=l.offset,r=l.orientation;const u=(0,M.d)(S.rq.get(),t.renderLocation);l.measureType=n,l.offset=function(t,e,i,n){const{directSegment:s}=i,o=G(S.rq.get(),{measureType:e,directSegment:s,renderCoordsHelper:n}),a=j(H,o,0,s,n).eval(.5,S.rq.get()),r=(0,M.a)(S.rq.get(),t,a);return(0,M.f)(r,o)*n.unitInMeters}(u,n,c,s.renderCoordsHelper),l.orientation=0}),(0,vt.Xt)(t,(t,e,l)=>{if(!U(i))return;const{geometry:c,dimension:u}=i,{renderCoordsHelper:d}=s,h=Z(Nt,n,i,d),p=G(S.rq.get(),{measureType:n,directSegment:c.directSegment,renderCoordsHelper:d}),m=(0,ut.z7)(t);e.next(m).next(bt(s,u,h,p)),l.next(m).next(t=>(u.measureType=o,u.offset=a,u.orientation=r,t))})]}function bt(t,e,i,n){const s=(0,M.e)(S.rq.get(),i.endRenderSpace,i.startRenderSpace);(0,M.i)(s,s,n);const o=(0,it.O_)(i.startRenderSpace,s,(0,it.vt)()),a=(0,it.O_)(i.startRenderSpace,n,(0,it.vt)()),r=e.offset;let l,c=0;const u=new vt.rh;return u.next((0,ut.AA)(t,o)).next(i=>{"start"===i.action&&(c=(0,it.mN)(a,i.renderStart));const n=((0,it.mN)(a,i.renderEnd)-c)*t.renderCoordsHelper.unitInMeters;e.offset=r+n,l=i}),t=>(u.execute(t),l)}function Pt(t,e){const{directSegment:i}=t,{renderCoordsHelper:n}=e,s=V(S.rq.get(),t,n),o=B(S.rq.get(),t),a=(0,M.i)(S.rq.get(),o,s),{viewForward:r}=e.state.camera;(0,M.f)(a,r)>0&&(0,M.h)(a,a,-1);const l=i.eval(.5,S.rq.get());return n.headingAtPosition(l,a)}function xt(t,e,i){const{dimensionSegment:n,primaryOffsetAxis:s}=e,o=Y(Ht,e),a=(0,M.q)(o,w.uY)?(0,_.D_)(Et):(0,lt.wQ)(o,s,w.uY,Et),r=Math.max((0,M.b)(o),.1/i.unitInMeters);(0,_.hs)(a,a,(0,M.j)(Ht,r,r,r)),t.modelTransform=a,t.renderLocation=n.eval(.5,Ht)}function Dt(t,e,i,n){let{forHeading:s}=n;const{dimension:o,geometry:a}=e,{primaryOffsetAxis:r}=a,l=(0,M.h)(Ot,r,o.offset>=0?1:-1),c=zt(Tt,{forHeading:s,geometry:a,renderCoordsHelper:i});(0,M.i)(c,c,l);const u=(0,lt.wQ)(l,c,w.uY,Et);t.modelTransform=u,t.renderLocation=At(Ht,a,a.dimensionSegment,i)}const Ot=(0,w.vt)(),Tt=(0,w.vt)();function At(t,e,i,n){const{startRenderSpace:s,endRenderSpace:o}=i,a=function(t,e){const i=B(It,t),n=V(Rt,t,e);return(0,M.f)(i,n)>0}(e,n)?s:o;return(0,M.d)(t,a)}function zt(t,e){let{forHeading:i,geometry:n,renderCoordsHelper:s}=e;return i?V(t,n,s):Y(t,n,{invert:!0})}const It=(0,w.vt)(),Rt=(0,w.vt)();function Zt(t){return(0,tt.Lz)(t)+6}function Lt(t,e){const i=e.material,n=e.focusMultiplier??lt.eO.focusMultiplier,s=e.calloutLength??lt.eO.calloutLength,o=lt.eO.discRadius*(e.discScale??1),a=o*n,r=(t,e)=>{const i=[0,1,2,2,3,0];return new pt.V(e,[["position",new ht.n([s-t,-t,0,s+t,-t,0,s+t,t,0,s-t,t,0],i,3,!0)],["uv0",new ht.n([0,0,1,0,1,1,0,1],i,2,!0)]])},l=e.calloutWidth??lt.eO.calloutWidth,c=new gt.W({width:l,color:e.calloutColor,renderOccluded:4,isDecoration:!0},t.view.state.isGlobal),u=(0,mt.Z8)(c,[[0,0,0],[s-o,0,0]]),d=(0,mt.Z8)(c,[[0,0,0],[s-a,0,0]]),h=e.customStateMask??0;t.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},t.focusMultiplier=n,t.metadata=e.metadata,t.radius=o,t.renderObjects=[new ct.M(r(o,i),1|h),new ct.M(u,1|h),new ct.M(r(a,i),2|h),new ct.M(d,2|h)]}const kt=16,Ht=(0,w.vt)(),Gt=(0,w.vt)(),Et=(0,y.vt)(),Nt=new x.C;var jt=i(56567),Vt=i(88321),Bt=i(53084),Yt=i(56002),Wt=i(50346),qt=i(19451);function Ft(t,e,i){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,unconstrainedGeometry:a,view:r}=i,{dimension:l,previousConstraint:c,preConstraintProperties:u}=t;if(null==s||null==o)return;const d=()=>{"startPoint"in e?l.startPoint=e.startPoint:"endPoint"in e&&(l.endPoint=e.endPoint)};if(null==n)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType="direct",n){case 0:if(n!==c&&(l.orientation=0),"startPoint"in e){const t=e.startPoint;null!=t&&(t.z=o.z),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.z=s.z),l.endPoint=t}break;case 1:if(n!==c&&(l.orientation=Pt(a,r)),"startPoint"in e){const t=e.startPoint;null!=t&&(t.x=o.x,t.y=o.y),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.x=s.x,t.y=s.y),l.endPoint=t}break;case 2:n!==c&&null!=u&&(l.orientation=u.orientation),d()}t.previousConstraint=n,t.unconstrainedGeometry=a}var Ut=i(59962),$t=i(70836),Xt=i(7256),Qt=i(85937),Jt=i(30416),Kt=i(35925),te=i(89238),ee=i(974),ie=i(56497),ne=i(13284),se=i(61237),oe=i(75218),ae=i(14318),re=i(70330);let le=class extends d.A{constructor(t){super(t),this._stagedDimension=null,this._snappingManagerResult=null,this._computationManipulators=new Map,this._computationHandles=new Vt.A,this._updatingHandles=new qt.U,this._getSnappingContext=(0,Yt.B)(t=>new ne.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new ie.p(new ee.ZE("point",(0,te.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new $t.s}));const{view:e}=t;this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(e),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(e),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(e),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,Kt.wk)(2)}),this._constraintSnappingIndicator=new Xt.t({view:e,attached:!0,width:1,renderOccluded:4,stipplePattern:(0,Kt.wk)(5),isDecoration:!0});const i=Q.A.toUnitRGBA(at);this._stagedStartIndicator=new Qt.I({view:e,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:t.view.renderCoordsHelper.spatialReference,color:i,size:10,outlineSize:0,renderOccluded:4,isDecoration:!0})}initialize(){const{view:t}=this;this._snappingOperation=new ae.O({view:t});const e=st(t.effectiveTheme),i=ot(t.effectiveTheme),n=!t.stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._textureHandle=(0,Ut.t)(t.stage.textures,{accentColor:e,contrastColor:i,preMultiplyAlpha:n}),this._orientationManipulatorMaterial=new Jt.r({draped:!1,texture:this._textureHandle.texture,writeDepth:!1,renderOccluded:16,isDecoration:!0});const o=(0,a.L)(()=>this.analysisViewData.computations,t=>{let{computation:e}=t;return this._createManipulators(e)});this.addHandles([(0,h.wB)(()=>({accentColor:st(t.effectiveTheme),contrastColor:ot(t.effectiveTheme)}),e=>{let{accentColor:i,contrastColor:s}=e;const o=this._textureHandle;this._textureHandle=(0,Ut.t)(t.stage.textures,{accentColor:i,contrastColor:s,preMultiplyAlpha:n}),this._orientationManipulatorMaterial.setParameters({texture:this._textureHandle.texture}),o?.release();const a=Q.A.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:a}),this._focusedOffsetManipulatorMaterial.setParameters({color:a}),this._thinOffsetManipulatorMaterial.setParameters({color:a}),this._constraintSnappingIndicator.color=a},h.Vh),(0,s.DQ)(o),(0,h.wB)(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),t=>{let{stagedPoint:e,stagedComputation:i}=t;if(null==i||null==e)return;const n=(0,P.EL)(e,new C.A);this._applyPointUpdate(i,{endPoint:n})},h.OH),(0,h.wB)(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(t,e)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:s}=t;if(i===e?.stagedDimension&&s===e?.firstGrabbedManipulator){for(const o of[n,e?.selectedComputation])if(null!=o){const e=this._computationManipulators.get(o);null!=e&&this._updateManipulators(o,e,t)}}else for(const[o,a]of this._computationManipulators)this._updateManipulators(o,a,t)},h.pc),(0,h.wB)(()=>this.analysis.style.lineSize,t=>this._updateManipulatorStyle(t),h.Vh),(0,h.wB)(()=>this.view.state.camera,()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)}),(0,h.wB)(()=>{const t=this._stagedComputation;if(!t)return null;const e=t.elevationAlignedStartPoint,i=(0,w.vt)();return null!=e&&this.view.renderCoordsHelper.toRenderCoords(e,i)?i:null},t=>{null!=t?(this._stagedStartIndicator.vertices=[t],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,re.BY)(this,()=>{const t=this._activeComputation,e=this._stagedComputation;if(null==t||null!=e){const t=this.view.inputManager.latestPointerInfo?.type??"mouse",e=this._getSnappingContext(t);this._updatingHandles.addPromise((0,Wt.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._ensureSnappingManager(),e)))}if(null!=t){const{start:e,end:i}=this._computationManipulators.get(t);if(e.grabbing||i.grabbing){!function(t,e,i){let{constraint:n,view:s}=i;const{unconstrainedGeometry:o}=t;if(null==o)return;const{renderCoordsHelper:a,spatialReference:r}=s,{startRenderSpace:l,endRenderSpace:c}=o.directSegment,u=a.fromRenderCoords(l,new C.A({spatialReference:r})),d=a.fromRenderCoords(c,new C.A({spatialReference:r}));let h;h="start"===e?{startPoint:u}:{endPoint:d},Ft(t,h,{constraint:n,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,unconstrainedGeometry:o,view:s})}(t,e.grabbing?"start":"end",{constraint:this._computeConstraint(t),view:this.view})}}})}destroy(){this._textureHandle=(0,r.Gz)(this._textureHandle),this._snappingOperation=(0,r.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose()}get updating(){return this._updatingHandles.updating||!!this._snappingManager?.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager?.options}get _snappingManager(){return this._snappingManagerResult?.snappingManager}_ensureSnappingManager(){return this._snappingManagerResult||(this._snappingManagerResult=(0,oe.X)(this.view),this.addHandles(this._snappingManagerResult)),this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:t}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=t?t:null}get _stagedComputation(){const t=this._stagedDimension,e=this.analysisViewData.computations.at(-1)?.computation;return null==t||null==e||e.dimension!==t?null:e}get _constraintHandles(){return[(0,h.z7)(()=>this.analysisViewData.selectedComputation,t=>{t.previousConstraint=this._computeConstraint(t)},{...h.pc,equals:Bt.aI}),(0,h.wB)(()=>{const t=this._activeComputation;if(null==t)return null;const{measureType:e,orientation:i}=t.dimension;return{measureType:e,orientation:i,computation:t}},(t,e)=>{if(null!=t&&null==e){const{measureType:e,orientation:i,computation:n}=t;switch(n.previousConstraint){case 0:n.preConstraintProperties={measureType:"horizontal",orientation:0};break;case 1:n.preConstraintProperties={measureType:"vertical",orientation:0};break;case 2:n.preConstraintProperties={measureType:"direct",orientation:i};break;default:n.preConstraintProperties={measureType:e,orientation:i}}}null==t&&null!=e&&(e.computation.preConstraintProperties=null)},h.OH)]}get _snappingIndicatorHandles(){const t="snapping-indicator-event-handles";return[(0,h.wB)(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),e=>{let{stagedComputation:i,activeComputation:n}=e;const s=this._constraintSnappingIndicator;if(this.removeHandles(t),null!=n)if(n===i)s.attached=!0;else{const{start:e,end:i}=this._computationManipulators.get(n),o=()=>{s.attached=e.grabbing||i.grabbing};o(),this.addHandles([e.events.on("grab-changed",o),i.events.on("grab-changed",o)],t)}else s.attached=!1}),(0,h.wB)(()=>{const t=this._activeComputation;return null!=t?{geometry:t.geometry,constraint:t.previousConstraint}:{}},t=>{let{geometry:e,constraint:i}=t;const n=this._constraintSnappingIndicator;null!=e&&null!=i&&2!==i?(n.visible=!0,n.setGeometryFromSegment(e.directSegment)):n.visible=!1})]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(t){const{_stagedDimension:e}=this;if(null==e){const e=this._onUnstagedClick(t);return this.analysis.dimensions.add(e),null}return this._onStagedClick(t),e}onPointerMove(t){let{mapPoint:e,pointerType:i}=t;if("touch"===i)return;const n=this._getSnappingContext(i);this._updatingHandles.addPromise((0,Wt.QZ)(this._snappingOperation.snap({point:e},this._ensureSnappingManager(),n)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(t){let{mapPoint:e,pointerType:i}=t,n=e;if("mouse"===i){const t=this._getSnappingContext(i);n=this._ensureSnappingManager().update({point:e,context:t})}const s=new jt.A({startPoint:(0,P.EL)(n,new C.A),endPoint:null,measureType:"horizontal"});return this._stagedDimension=s,this._resetSnappingState(),s}_onStagedClick(t){let{mapPoint:e,pointerType:i}=t;const n=this._stagedComputation;if(null==n)return;let s=e;if("mouse"===i){const t=this._getSnappingContext(i);s=this._ensureSnappingManager().update({point:e,context:t})}const o=(0,P.EL)(s,new C.A);this._applyPointUpdate(n,{endPoint:o}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._ensureSnappingManager().doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(t){const e=this._setupPointManipulator(t,{isStart:!0}),i=this._setupPointManipulator(t,{isStart:!1}),n=this._setupOffsetManipulator(t),o=this._setupHeadingManipulator(t),a=this._setupRotationManipulator(t),r=this._setupMeasureTypeManipulator(t,"direct"),l=this._setupMeasureTypeManipulator(t,"horizontal"),c=this._setupMeasureTypeManipulator(t,"vertical"),u=new ft({start:e,end:i,offset:n,heading:o,rotation:a,direct:r,horizontal:l,vertical:c});this._setupComputationToManipulatorsSync(t,u),this._computationManipulators.set(t,u),this.manipulators.addMany(u.values());const d=(0,s.vE)(u.values().map(t=>t.events.on("focus-changed",()=>{u.values().some(t=>t.focused)&&this._resetSnappingState()})));return{manipulators:u,remove:()=>{d.remove(),this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const t of u.values())this.manipulators.remove(t)}}}_setupComputationToManipulatorsSync(t,e){this._computationHandles.add([(0,h.wB)(()=>t.geometry,()=>this._updateManipulators(t,e),{...h.pc,equals:Bt.aI})],t)}_setupPointManipulator(t,e){const{view:i}=this,{dimension:n}=t,s=new _t(i,{metadata:n}),o=function(t,e){let{isStart:i,createSnappingPipelineStep:n,dimension:s,onUpdate:o,view:a}=e;const r=i?"startPoint":"endPoint",l=(0,vt.Xt)(t,(t,e,i,l)=>{const c=(0,ut.z7)(t),{snappingStep:u,cancelSnapping:d}=n(l);i=i.next(c).next((0,vt.VG)(s,[r,"measureType","orientation"])).next(d),e.next(c).next((0,ut.xk)(a)).next(...u).next(t=>{const e=(0,P.EL)(t.mapEnd,new C.A);o("startPoint"===r?{startPoint:e}:{endPoint:e})})});return[l]}(s,{isStart:e.isStart,createSnappingPipelineStep:t=>(0,se.L)({snappingContext:this._getSnappingContext(t),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:n,onUpdate:e=>this._applyPointUpdate(t,e),view:i});return this._computationHandles.add(o,t),s}_setupOffsetManipulator(t){const{view:e}=this,i=function(t,e){const i=[(0,w.fA)(-.5,0,0),(0,w.fA)(.5,0,0)],n=(0,mt.Z8)(e.unfocusedMaterial,i.map(t=>(0,M.h)((0,w.vt)(),t,.5))),s=n.instantiate({material:e.focusedMaterial});return new rt.q({view:t,renderObjects:[new ct.M(n,9|kt),new ct.M(s,2|kt)],collisionType:{type:"line",paths:[i]},radius:Zt(e.lineSizePt)/2,metadata:e.metadata,available:!1,...lt.MO})}(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:t.dimension}),n=function(t,e){let{computation:i,view:n}=e;return[(0,vt.Xt)(t,(t,e,s)=>{if(!U(i)||!t.selected)return;const{geometry:o,dimension:a}=i,r=(0,ut.z7)(t);e.next(r).next(bt(n,a,o.dimensionSegment,o.primaryOffsetAxis)),s.next(r).next((0,vt.VG)(a,["offset"]))})]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupHeadingManipulator(t){const{view:e}=this,i=new yt(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=function(t,e){let{computation:i,view:n}=e;return[(0,vt.Xt)(t,(t,e,s)=>{Ct({cancel:s,computation:i,settingHeading:!0,steps:e,view:n})})]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupRotationManipulator(t){const{view:e}=this,i=new yt(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=wt(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupMeasureTypeManipulator(t,e){const{view:i}=this,n=function(t,e){const i=[(0,w.fA)(-.5,0,0),(0,w.fA)(.5,0,0)],n=(0,mt.Z8)(e.thinOffsetManipulatorMaterial,i),s=(0,mt.Z8)(e.unfocusedMaterial,i.map(t=>(0,M.h)((0,w.vt)(),t,.5))),o=s.instantiate({material:e.focusedMaterial});return new rt.q({view:t,renderObjects:[new ct.M(s,1|kt),new ct.M(o,2|kt),new ct.M(n,kt)],collisionType:{type:"line",paths:[i]},radius:Zt(e.lineSizePt)/2,available:!1,metadata:e.metadata,...lt.MO})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:t.dimension}),s=St(n,{computation:t,manipulatorMeasureType:e,view:i});return this._computationHandles.add(s,t),n}_updateManipulators(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:o}=i,{start:a,end:r,offset:l,heading:c,rotation:u}=e,d=s===t,h=U(t),{dimension:p}=t;for(const v of e.values()){const t=h&&null==n&&(null==o||v===o);v===l?(v.available=t,v.selected=d):v.available=t&&d}if(!h)return;null!=this._computeConstraint(t)?e.forEachMeasureTypeManipulator(t=>t.available=!1):e.manipulatorForMeasureType(p.measureType).available=!1;for(const v of[c,u])"direct"===p.measureType&&0!==p.offset||(v.available=!1);N(t)?u.available=!1:c.available=!1;const{geometry:m}=t;a.renderLocation=m.directSegment.startRenderSpace,r.renderLocation=m.directSegment.endRenderSpace;const{renderCoordsHelper:g}=this.view;xt(l,m,g),c.available&&function(t,e,i){Dt(t,e,i,{forHeading:!0})}(c,t,g),u.available&&function(t,e,i){Dt(t,e,i,{forHeading:!1})}(u,t,g),e.forEachMeasureTypeManipulator((e,i)=>{e.available&&function(t,e,i,n){const{geometry:s}=e,o=Z(Nt,i,e,n),a=G(Ht,{measureType:i,directSegment:s.directSegment,renderCoordsHelper:n}),r=(0,M.a)(Gt,o.endRenderSpace,o.startRenderSpace),l=(0,lt.wQ)(r,a,w.uY,Et),c=(0,M.b)(r);(0,_.hs)(l,l,(0,M.j)(Gt,c,c,c)),t.modelTransform=l,t.renderLocation=o.eval(.5,Gt)}(e,t,i,g)})}_updateManipulatorStyle(t){const e=function(t){return(0,tt.Lz)(t)+4}(t),i=Zt(t),n={lineSizePt:t,material:this._orientationManipulatorMaterial};for(const{offset:s,heading:o,rotation:a}of this._computationManipulators.values())s.radius=i/2,o.update(n),a.update(n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(t,e){const{view:i}=this,n=z(t);"startPoint"in e&&(n.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(n.elevationAlignedEndPoint=e.endPoint);const s=I(n,i.renderCoordsHelper);if(null==s)return;const o=this._computeConstraint({...n,geometry:s});Ft(t,e,{...n,constraint:o,unconstrainedGeometry:s,view:i}),t===this._stagedComputation&&this._updateStagedDimensionOffset(t)}_updateStagedDimensionOffset(t){if(null==t.geometry)return;t.geometry.directSegment.eval(.5,ce);const{state:e,renderCoordsHelper:i}=this.view,n=e.camera.computeScreenPixelSizeAt(ce);t.dimension.offset=50*n*i.unitInMeters}_computeConstraint(t){return function(t,e){if(F(t))return 2;if(!t.enabled)return null;const{geometry:i}=t;if(null==i||(0,M.q)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{camera:n}=e.state,s=V(S.rq.get(),i,e.renderCoordsHelper),o=B(S.rq.get(),i),a=(0,M.h)(S.rq.get(),s,(0,M.f)(o,s)),r=(0,M.e)(S.rq.get(),o,a),l=(0,M.m)(r),c=(0,M.m)(a),{startRenderSpace:u,endRenderSpace:d}=i.directSegment,h=Math.max(10*n.computeScreenPixelSizeAt(u),10*n.computeScreenPixelSizeAt(d))**2;return l<h?1:c<h?0:null}(function(t,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,geometry:t.geometry}}(t,this._ensureSnappingManager().options),this.view)}_createOffsetManipulatorMaterial(t){return new gt.W({width:1,renderOccluded:4,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0},t.state.isGlobal)}get test(){}};(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],le.prototype,"analysis",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],le.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],le.prototype,"manipulators",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],le.prototype,"parentTool",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],le.prototype,"view",void 0),(0,n.Cg)([(0,l.MZ)({readOnly:!0})],le.prototype,"updating",null),(0,n.Cg)([(0,l.MZ)()],le.prototype,"firstGrabbedManipulator",null),(0,n.Cg)([(0,l.MZ)()],le.prototype,"hasGrabbedManipulators",null),(0,n.Cg)([(0,l.MZ)()],le.prototype,"snappingOptions",null),(0,n.Cg)([(0,l.MZ)()],le.prototype,"_stagedDimension",void 0),(0,n.Cg)([(0,l.MZ)()],le.prototype,"_snappingManager",null),(0,n.Cg)([(0,l.MZ)()],le.prototype,"_activeComputation",null),(0,n.Cg)([(0,l.MZ)()],le.prototype,"_stagedComputation",null),(0,n.Cg)([(0,l.MZ)()],le.prototype,"_snappingManagerResult",void 0),le=(0,n.Cg)([(0,c.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],le);const ce=(0,w.vt)();var ue=i(5109),de=i(82307),he=i(46576),pe=i(11500);let me=class extends ue.k{constructor(t){super(t),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._placementMode=ge,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,he.T)(this.view.state.viewingMode),this._lengthDimensionSubTool=new le({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,s.DQ)(this._lengthDimensionSubTool),(0,s.hA)(()=>this._clearPointerMoveTimeout()),(0,h.z7)(()=>"created"===this.state,()=>this.finishToolCreation(),h.pc),(0,h.z7)(()=>this.firstGrabbedManipulator,t=>{this.selectedDimension=t.metadata},h.pc),(0,h.wB)(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),h.pc)])}get state(){return this.analysis.dimensions.some(t=>"length"===t.type)?null!=this._activeSubTool?"creating":"created":"ready"}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(t){this.analysisViewData.selectedDimension=t}place(t){this.selectedDimension=null,this._placementMode=t}onInputEvent(t){switch(t.type){case"immediate-click":this._clickHandler(t);break;case"immediate-double-click":this._doubleClickHandler(t);break;case"pointer-move":this._pointerMoveHandler(t);break;case"key-down":this._keyDownHandler(t)}}onActivate(){this._placementMode=ge,this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){this._activeSubTool?.onDeactivate(),this._activeSubTool=null}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(t){if(this.hasFocusedManipulators)return void t.stopPropagation();if(null==this._activeSubTool)return;const e=this._intersectScreen(t);null!=e&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:t.pointerType}),this.selectedDimension&&"single"===this._placementMode&&(this.view.activeTool=null),t.stopPropagation())}_doubleClickHandler(t){this.active&&(this.view.activeTool=null,t.stopPropagation())}_pointerMoveHandler(t){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const e=this._intersectScreen(t);null!=e&&this._activeSubTool.onPointerMove({mapPoint:e,pointerType:t.pointerType})}_keyDownHandler(t){de.NE.cancel===t.key?(this._activeSubTool?.removeStaged()&&"multiple"===this._placementMode&&t.stopPropagation(),this.active||(this.selectedDimension=null)):de.NE.delete.includes(t.key)&&(this._activeSubTool?.removeStaged(),this._removeSelected())}_intersectScreen(t){const e=(0,pe.sC)(t);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const i=this._intersector.results.min,n=S.rq.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,new C.A({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,r.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(t=>t.manipulator.state|=kt),this._prevPointerMoveTimeout=X.p.setTimeout(()=>{this.manipulators.forEach(t=>t.manipulator.state&=~kt)},this._pointerMoveTimerMs)}get test(){}};(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],me.prototype,"view",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],me.prototype,"analysis",void 0),(0,n.Cg)([(0,l.MZ)({readOnly:!0})],me.prototype,"state",null),(0,n.Cg)([(0,l.MZ)({readOnly:!0})],me.prototype,"updating",null),(0,n.Cg)([(0,l.MZ)({readOnly:!0})],me.prototype,"cursor",null),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],me.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,l.MZ)()],me.prototype,"selectedDimension",null),(0,n.Cg)([(0,l.MZ)()],me.prototype,"automaticManipulatorSelection",void 0),(0,n.Cg)([(0,l.MZ)()],me.prototype,"_activeSubTool",void 0),(0,n.Cg)([(0,l.MZ)()],me.prototype,"_lengthDimensionSubTool",void 0),(0,n.Cg)([(0,l.MZ)()],me.prototype,"_placementMode",void 0),me=(0,n.Cg)([(0,c.$)("esri.views.3d.analysis.Dimension.DimensionTool")],me);const ge="multiple";i(11265);var ve=i(11113),fe=i(66747),_e=i(28608),ye=i(32314),Me=i(70667),we=i(97349);class Ce extends ye.X{constructor(t,e){super(t),this._hasExternalMaterial=!1,this._renderOccluded=4,this._width=1,this._color=(0,_e.fA)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=e,this._hasExternalMaterial=null!=e,this.applyProperties(t)}setGeometryFromSegment(t,e){const i=t.endRenderSpace;this.transform=(0,_.kN)(Se,i),this._normal=e;const{points:n}=t.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return this._material?.parameters.renderOccluded??this._renderOccluded}set renderOccluded(t){this._renderOccluded=t,this._material?.setParameters({renderOccluded:t})}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get normal(){return this._normal}set normal(t){this._normal=t,this.recreateGeometry()}get width(){return this._material?.parameters.width??this._width}set width(t){this._width=t,this._material?.setParameters({width:t})}get color(){return this._material?.parameters.color??this._color}set color(t){this._color=(0,_e.o8)(t),this._material?.setParameters({color:this._color})}get placement(){return this._material?.parameters.placement??this._placement}set placement(t){this._placement=t,this._material?.setParameters({placement:this._placement})}get markerPrimitive(){return this._material?.parameters.markerPrimitive??this._markerPrimitive}set markerPrimitive(t){this._markerPrimitive=t,this._material?.setParameters({markerPrimitive:t})}createExternalResources(){this._hasExternalMaterial||(this._material=new we.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration},this.view.state.isGlobal))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(t){for(const e of(0,Me.zh)(this.geometry,this.normal)){const i=(0,Me.te)(this._material,e);t.addGeometry(i)}}forEachMaterial(t){this._hasExternalMaterial||t(this._material)}}const Se=(0,y.vt)();class be{set visible(t){for(const e of this._visualElements.values())e.attached=t}constructor(t){this.destroyed=!1,this._handles=new Vt.A,this._messages=null,this._labelSegment=new x.C;const{analysis:e,computation:i,view:n,messages:s,isDecoration:o}=t;this.analysis=e,this.computation=i,this.view=n,this._messages=s;const a=t.visible,r={view:n,attached:a,isDecoration:o},{fontSize:l,textColor:c,textBackgroundColor:u}=e.style;this._visualElements=new Oe({marker:new Ce(r,t.markerMaterial),dimension:new Xt.t(r,t.dimensionLineMaterial),startOffset:new Xt.t(r,t.offsetLineMaterial),endOffset:new Xt.t(r,t.offsetLineMaterial),dimensionSmall:new Xt.t(r,t.smallDimensionLineMaterial),startOffsetSmall:new Xt.t(r,t.smallOffsetLineMaterial),endOffsetSmall:new Xt.t(r,t.smallOffsetLineMaterial),label:new fe.N({view:n,attached:a,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,tt.Lz)(l),textColor:c.clone(),backgroundColor:u.clone(),isDecoration:o})}),this._handles.add([(0,h.wB)(()=>i.geometry,t=>{this.updateCameraDependentElements(n.state.camera,t,e.style),null!=i.geometry&&this._updateLines(i.geometry)},{...h.Vh,equals:Bt.aI}),(0,h.wB)(()=>i.length,t=>this._updateLabelContent(t),h.Vh)])}destroy(){this.destroyed=!0,this._handles=(0,r.pR)(this._handles);for(const t of this._visualElements.values())t.destroy()}get testInfo(){}_updateLines(t){const e=R(Pe,0,t.directSegment,t.dimensionSegment),i=R(xe,1,t.directSegment,t.dimensionSegment),n=this._visualElements;n.marker.setGeometryFromSegment(t.dimensionSegment,t.primaryOffsetAxis),n.dimension.setGeometryFromSegment(t.dimensionSegment),n.startOffset.setGeometryFromSegment(e),n.endOffset.setGeometryFromSegment(i),n.dimensionSmall.setGeometryFromSegment(t.dimensionSegment),n.startOffsetSmall.setGeometryFromSegment(e),n.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(t,e,i){const n=this._visualElements;if(null==e){for(const t of n.values())t.visible=!1;return}const s=t.computeScreenPixelSizeAt(e.dimensionSegment.eval(.5,De)),o=function(t,e){return(0,M.m)(Y(q,t))/e**2}(e,s),a=o<(2*(0,tt.Lz)(i.lineSize))**2,r=!a;n.marker.visible=r,n.dimension.visible=r,n.startOffset.visible=r,n.endOffset.visible=r,n.dimensionSmall.visible=a,n.startOffsetSmall.visible=a,n.endOffsetSmall.visible=a;const l=5*(0,tt.Lz)(i.fontSize),{label:c}=n;if(c.visible=o>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=e,{offset:h}=this.computation.dimension,p=(Math.sign(h)>=0?1:-1)*function(t){return 1.5*(0,tt.Lz)(t.fontSize)+20+(0,tt.Lz)(t.lineSize/2)}(i)*s;(function(t,e,i,n){(0,M.c)(t.startRenderSpace,e.startRenderSpace,i,n),(0,M.c)(t.endRenderSpace,e.endRenderSpace,i,n)})(this._labelSegment,u,d,p),c.updateLabelPosition()}updateLabelStyle(t){const{label:e}=this._visualElements;e.fontSize=(0,tt.Lz)(t.fontSize),e.textColor=t.textColor,e.backgroundColor=t.textBackgroundColor}updateUnitsMessages(t){this._messages=t;const{length:e}=this.computation;this._updateLabelContent(e)}_updateLabelContent(t){const{label:e}=this._visualElements;null!=t&&null!=this._messages?e.text=(0,ve.zJ)(this._messages,t,t.unit):e.text=""}}const Pe=new x.C,xe=new x.C,De=(0,w.vt)();class Oe{constructor(t){this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Te=i(38042),Ae=i(63860);let ze=class extends d.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(t){super(t),this.loadingMessages=!1,this._messages=null}initialize(){const t=this.isDecoration;this._markerMaterial=new we.i({width:1,anchor:1,color:et.uY,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:4,markerPrimitive:"triangle",isDecoration:t},this.view.state.isGlobal),this._dimensionLineMaterial=new gt.W({width:1,color:et.uY,renderOccluded:4,markerParameters:this._markerMaterial.parameters,isDecoration:t},this.view.state.isGlobal),this._offsetLineMaterial=new gt.W({width:1,color:et.uY,renderOccluded:4,stipplePattern:(0,Kt.wk)(5),isDecoration:t},this.view.state.isGlobal),this._smallDimensionLineMaterial=new gt.W({width:1,color:et.uY,renderOccluded:4,isDecoration:t},this.view.state.isGlobal),this._smallOffsetLineMaterial=new gt.W({width:1,color:et.uY,renderOccluded:4,stipplePattern:(0,Kt.wk)(5),isDecoration:t},this.view.state.isGlobal);const e=(0,a.L)(()=>this.analysisViewData.computations,t=>{let{computation:e}=t;return this._createVisualization(e)});this._dimensionVisualizations=e,this.addHandles([(0,s.DQ)(e),(0,h.wB)(()=>Q.A.toUnitRGBA(this.analysis.style.color),t=>{for(const e of this._lineMaterials())e.setParameters({color:t})},h.pc),(0,h.wB)(()=>this.analysis.style.lineSize,t=>{const e=(0,tt.Lz)(t);this._markerMaterial.setParameters({width:.8*e}),this._dimensionLineMaterial.setParameters({width:e,markerParameters:this._markerMaterial.parameters});const i=Math.max(.25*e,1);this._offsetLineMaterial.setParameters({width:i})},h.pc),(0,h.wB)(()=>({camera:this.view.state.camera,style:Ie(this.analysis)}),t=>{let{camera:e,style:i}=t;for(const{visualization:n}of this._dimensionVisualizations)n.updateCameraDependentElements(e,n.computation.geometry,i),n.updateLabelStyle(i)}),(0,h.wB)(()=>this.visible,t=>{for(const{visualization:e}of this._dimensionVisualizations)e.visible=t})]),this.addHandles([(0,Te.oQ)(()=>this._updateMessageBundle()),(0,h.z7)(()=>!this.loadingMessages,()=>{for(const{visualization:t}of this._dimensionVisualizations)t.updateUnitsMessages(this._messages)},h.OH)]),this._updateMessageBundle()}get testInfo(){}_createVisualization(t){const e=new be({analysis:this.analysis,computation:t,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:e,remove:()=>e.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,Ae.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Ie(t){const{fontSize:e,lineSize:i,textColor:n,textBackgroundColor:s}=t.style;return{fontSize:e,lineSize:i,textBackgroundColor:s.clone(),textColor:n.clone()}}(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],ze.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],ze.prototype,"view",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],ze.prototype,"isDecoration",void 0),(0,n.Cg)([(0,l.MZ)()],ze.prototype,"analysis",null),(0,n.Cg)([(0,l.MZ)()],ze.prototype,"visible",null),(0,n.Cg)([(0,l.MZ)()],ze.prototype,"loadingMessages",void 0),ze=(0,n.Cg)([(0,c.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],ze);let Re=class extends d.A{constructor(t){super(t),this.dimension=null,this.length=null}};(0,n.Cg)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Re.prototype,"dimension",void 0),(0,n.Cg)([(0,l.MZ)()],Re.prototype,"length",void 0),Re=(0,n.Cg)([(0,c.$)("esri.views.analysis.LengthDimensionResult")],Re);let Ze=class extends d.A{constructor(t){super(t),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(t){const{dimension:e,...i}=t;return{result:new Re({dimension:e}),...i}}initialize(){this.addHandles([(0,h.wB)(()=>this.dimension.startPoint,t=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(t),h.pc),(0,h.wB)(()=>this.dimension.endPoint,t=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(t),h.pc)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,n.Cg)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ze.prototype,"result",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ze.prototype,"projectAndAlignPoint",void 0),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"dimension",null),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"length",null),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"geometry",void 0),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"unconstrainedGeometry",void 0),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"elevationAlignedStartPoint",void 0),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"elevationAlignedEndPoint",void 0),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"preConstraintProperties",void 0),(0,n.Cg)([(0,l.MZ)()],Ze.prototype,"previousConstraint",void 0),Ze=(0,n.Cg)([(0,c.$)("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],Ze);var Le=i(17430),ke=i(10260),He=i(68655);let Ge=class extends u.P{constructor(t){super(t),this.type="dimension-view-3d",this.analysis=null,this.tool=null,this.selectedDimension=null,this.userOperation=null,this._dimensionsToComputations=new Map,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=t=>{if(null==t)return null;const{spatialReference:e,elevationProvider:i}=this.view,n=(0,Le.B)(t,e,i);return null==n&&(0,Le.V)(this.analysis,t.spatialReference,o.A.getLogger(this)),n};const t=(0,a.L)(()=>this.analysis.dimensions,t=>this._createComputation(t));this.computations=t,this.addHandles([(0,ke.Hd)(this,me),(0,s.DQ)(t)]),this._analysisVisualization=new ze({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this.addResolvingPromise((0,He.f)().then(t=>{this._analysisController=new $({analysisViewData:this,view:this.view,automaticLengthMeasurementUtils:t})}))}destroy(){this.userOperation=(0,r.DC)(this.userOperation),(0,ke.aS)(this),this._analysisVisualization=(0,r.pR)(this._analysisVisualization)}get visible(){return super.visible}set visible(t){super.visible=t}get interactive(){return super.interactive}set interactive(t){super.interactive=t}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map(t=>this._dimensionsToComputations.get(t).result)}get selectedComputation(){const{selectedDimension:t}=this;return null==t?null:this._dimensionsToComputations.get(t)}get testInfo(){}async createLengthDimensions(t){this.selectedDimension=null,await(0,ke.ZX)(this,{placementOptions:t,onToolActivated:t=>t.place("multiple")})}place(t){return this.selectedDimension=null,(0,ke.ZX)(this,{placementOptions:t,onToolActivated:t=>t.place("single")})}_createComputation(t){const{_dimensionsToComputations:e}=this,i=new Ze({dimension:t,projectAndAlignPoint:this._projectAndAlignPoint});return e.set(t,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(t){const{dimension:e}=t;e===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(e),t.destroy()}};(0,n.Cg)([(0,l.MZ)({readOnly:!0})],Ge.prototype,"type",void 0),(0,n.Cg)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ge.prototype,"analysis",void 0),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"tool",void 0),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"updating",null),(0,n.Cg)([(0,l.MZ)({readOnly:!0})],Ge.prototype,"results",null),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"computations",void 0),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"selectedDimension",void 0),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"selectedComputation",null),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"userOperation",void 0),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"_analysisVisualization",void 0),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"_analysisController",void 0),(0,n.Cg)([(0,l.MZ)()],Ge.prototype,"_dimensionsToComputations",void 0),Ge=(0,n.Cg)([(0,c.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],Ge);const Ee=Ge},85937:(t,e,i)=>{i.d(e,{I:()=>p});var n=i(20664),s=i(9392),o=i(43047),a=i(55855),r=i(32314),l=i(49296),c=i(44815),u=i(67425);var d=i(72017),h=i(50115);class p extends r.X{constructor(t){super(t),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=(0,a.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,a.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(t){this._vertices=t,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(t){this._spatialReference=t,this.recreateGeometry()}get color(){return this._color}set color(t){(0,o.a)(t,this._color)||((0,o.d)(this._color,t),this._updateMaterial())}get size(){return this._size}set size(t){t!==this._size&&(this._size=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){(0,o.a)(t,this._outlineColor)||((0,o.d)(this._outlineColor,t),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const t=this.vertices;if(null==t||0===t.length)return[];const e=function(t,e,i,n,s){const o=(0,c.jh)(3*t.length),a=(0,c.jh)(o.length);t.forEach((t,e)=>{o[3*e]=t[0],o[3*e+1]=t[1],o[3*e+2]=t.length>2?t[2]:0});const r=(0,u.au)(o,e,0,a,0,o,0,o.length/3,i,n,s),l=null!=r;return{numVertices:t.length,position:o,mapPositions:a,projectionSuccess:l,sampledElevation:r}}(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,l.F.fromElevationInfo(this.elevationInfo)),i=[],s=e.numVertices,o=e.position;for(let a=0;a<s;++a){const t=(0,n.j)(m,o[3*a],o[3*a+1],o[3*a+2]),e=g(this._vertexMaterial,.5,t),s=g(this._vertexOutlineMaterial,.5,t);i.push({vertexGeometry:e,vertexOutlineGeometry:s})}return i}createGeometries(t){const e=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of e)t.addGeometry(i),t.addGeometry(n)}createExternalResources(){this._vertexMaterial=new h.A({...this._vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new h.A({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachMaterial(t){t(this._vertexMaterial),t(this._vertexOutlineMaterial)}}const m=(0,s.vt)();function g(t,e,i){return(0,d.CM)(t,e,16,16,{offset:i})}}}]);
//# sourceMappingURL=76609.5021d1f0.chunk.js.map